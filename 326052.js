!function(t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else{if("function"==typeof define&&define.amd)return define([],t);this.CodeMirror=t()}}(function(){"use strict";function t(e,i){if(!(this instanceof t))return new t(e,i);this.options=i=i?Ur(i):{},Ur(Jn,i,!1),h(i);var r=i.value;"string"==typeof r&&(r=new To(r,i.mode,null,i.lineSeparator)),this.doc=r;var n=new t.inputStyles[i.inputStyle](this),s=this.display=new function(t,e,i){var r=this;this.input=i,r.scrollbarFiller=_r("div",null,"CodeMirror-scrollbar-filler"),r.scrollbarFiller.setAttribute("cm-not-content","true"),r.gutterFiller=_r("div",null,"CodeMirror-gutter-filler"),r.gutterFiller.setAttribute("cm-not-content","true"),r.lineDiv=_r("div",null,"CodeMirror-code"),r.selectionDiv=_r("div",null,null,"position: relative; z-index: 1"),r.cursorDiv=_r("div",null,"CodeMirror-cursors"),r.measure=_r("div",null,"CodeMirror-measure"),r.lineMeasure=_r("div",null,"CodeMirror-measure"),r.lineSpace=_r("div",[r.measure,r.lineMeasure,r.selectionDiv,r.cursorDiv,r.lineDiv],null,"position: relative; outline: none"),r.mover=_r("div",[_r("div",[r.lineSpace],"CodeMirror-lines")],null,"position: relative"),r.sizer=_r("div",[r.mover],"CodeMirror-sizer"),r.sizerWidth=null,r.heightForcer=_r("div",null,null,"position: absolute; height: "+Ro+"px; width: 1px;"),r.gutters=_r("div",null,"CodeMirror-gutters"),r.lineGutter=null,r.scroller=_r("div",[r.sizer,r.heightForcer,r.gutters],"CodeMirror-scroll"),r.scroller.setAttribute("tabIndex","-1"),r.wrapper=_r("div",[r.scrollbarFiller,r.gutterFiller,r.scroller],"CodeMirror"),yn&&8>wn&&(r.gutters.style.zIndex=-1,r.scroller.style.paddingRight=0),kn||mn&&Nn||(r.scroller.draggable=!0),t&&(t.appendChild?t.appendChild(r.wrapper):t(r.wrapper)),r.viewFrom=r.viewTo=e.first,r.reportedViewFrom=r.reportedViewTo=e.first,r.view=[],r.renderedView=null,r.externalMeasured=null,r.viewOffset=0,r.lastWrapHeight=r.lastWrapWidth=0,r.updateLineNumbers=null,r.nativeBarWidth=r.barHeight=r.barWidth=0,r.scrollbarsClipped=!1,r.lineNumWidth=r.lineNumInnerWidth=r.lineNumChars=null,r.alignWidgets=!1,r.cachedCharWidth=r.cachedTextHeight=r.cachedPaddingH=null,r.maxLine=null,r.maxLineLength=0,r.maxLineChanged=!1,r.wheelDX=r.wheelDY=r.wheelStartX=r.wheelStartY=null,r.shift=!1,r.selForContextMenu=null,r.activeTouch=null,i.init(r)}(e,r,n);s.wrapper.CodeMirror=this,a(this),o(this),i.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),i.autofocus&&!Nn&&s.input.focus(),g(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,selectingText:!1,draggingText:!1,highlight:new Rr,keySeq:null,specialChars:null};var l=this;for(var c in yn&&11>wn&&setTimeout(function(){l.display.input.reset(!0)},20),function(t){function e(){r.activeTouch&&(n=setTimeout(function(){r.activeTouch=null},1e3),(o=r.activeTouch).end=+new Date)}function i(t,e){if(null==e.left)return!0;var i=e.left-t.left,r=e.top-t.top;return i*i+r*r>400}var r=t.display;Mo(r.scroller,"mousedown",pe(t,Ae)),Mo(r.scroller,"dblclick",yn&&11>wn?pe(t,function(e){if(!Or(t,e)){var i=Le(t,e);if(i&&!Ne(t,e)&&!Se(t.display,e)){Ao(e);var r=t.findWordAt(i);pt(t.doc,r.anchor,r.head)}}}):function(e){Or(t,e)||Ao(e)}),In||Mo(r.scroller,"contextmenu",function(e){Ke(t,e)});var n,o={end:0};Mo(r.scroller,"touchstart",function(t){if(!function(t){if(1!=t.touches.length)return!1;var e=t.touches[0];return e.radiusX<=1&&e.radiusY<=1}(t)){clearTimeout(n);var e=+new Date;r.activeTouch={start:e,moved:!1,prev:e-o.end<=300?o:null},1==t.touches.length&&(r.activeTouch.left=t.touches[0].pageX,r.activeTouch.top=t.touches[0].pageY)}}),Mo(r.scroller,"touchmove",function(){r.activeTouch&&(r.activeTouch.moved=!0)}),Mo(r.scroller,"touchend",function(n){var o=r.activeTouch;if(o&&!Se(r,n)&&null!=o.left&&!o.moved&&new Date-o.start<300){var s,a=t.coordsChar(r.activeTouch,"page");s=!o.prev||i(o,o.prev)?new st(a,a):!o.prev.prev||i(o,o.prev.prev)?t.findWordAt(a):new st(Bn(a.line,0),dt(t.doc,Bn(a.line+1,0))),t.setSelection(s.anchor,s.head),t.focus(),Ao(n)}e()}),Mo(r.scroller,"touchcancel",e),Mo(r.scroller,"scroll",function(){r.scroller.clientHeight&&(De(t,r.scroller.scrollTop),He(t,r.scroller.scrollLeft,!0),Ho(t,"scroll",t))}),Mo(r.scroller,"mousewheel",function(e){Ie(t,e)}),Mo(r.scroller,"DOMMouseScroll",function(e){Ie(t,e)}),Mo(r.wrapper,"scroll",function(){r.wrapper.scrollTop=r.wrapper.scrollLeft=0}),r.dragFunctions={enter:function(e){Or(t,e)||No(e)},over:function(e){Or(t,e)||(function(t,e){var i=Le(t,e);if(i){var r=document.createDocumentFragment();Lt(t,i,r),t.display.dragCursor||(t.display.dragCursor=_r("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),t.display.lineSpace.insertBefore(t.display.dragCursor,t.display.cursorDiv)),Xr(t.display.dragCursor,r)}}(t,e),No(e))},start:function(e){!function(t,e){if(yn&&(!t.state.draggingText||+new Date-jn<100))return void No(e);if(!Or(t,e)&&!Se(t.display,e)&&(e.dataTransfer.setData("Text",t.getSelection()),e.dataTransfer.setDragImage&&!Sn)){var i=_r("img",null,null,"position: fixed; left: 0; top: 0;");i.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",Tn&&(i.width=i.height=1,t.display.wrapper.appendChild(i),i._top=i.offsetTop),e.dataTransfer.setDragImage(i,0,0),Tn&&i.parentNode.removeChild(i)}}(t,e)},drop:pe(t,Me),leave:function(){Oe(t)}};var s=r.input.getField();Mo(s,"keyup",function(e){Fe.call(t,e)}),Mo(s,"keydown",pe(t,Pe)),Mo(s,"keypress",pe(t,We)),Mo(s,"focus",Kr(ze,t)),Mo(s,"blur",Kr(Ue,t))}(this),function(){Jo||(Mo(window,"resize",function(){null==t&&(t=setTimeout(function(){t=null,Jr(Te)},100))}),Mo(window,"blur",function(){Jr(Ue)}),Jo=!0);var t}(),oe(this),this.curOp.forceUpdate=!0,or(this,r),i.autofocus&&!Nn||l.hasFocus()?setTimeout(Kr(ze,this),20):Ue(this),to)to.hasOwnProperty(c)&&to[c](this,i[c],eo);w(this),i.finishInit&&i.finishInit(this);for(var d=0;d<oo.length;++d)oo[d](this);se(this),kn&&i.lineWrapping&&"optimizelegibility"==getComputedStyle(s.lineDiv).textRendering&&(s.lineDiv.style.textRendering="auto")}function e(e){e.doc.mode=t.getMode(e.options,e.doc.modeOption),i(e)}function i(t){t.doc.iter(function(t){t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null)}),t.doc.frontier=t.doc.first,Nt(t,100),t.state.modeGen++,t.curOp&&be(t)}function r(t){var e=re(t.display),i=t.options.lineWrapping,r=i&&Math.max(5,t.display.scroller.clientWidth/ne(t.display)-3);return function(n){if(Ii(t.doc,n))return 0;var o=0;if(n.widgets)for(var s=0;s<n.widgets.length;s++)n.widgets[s].height&&(o+=n.widgets[s].height);return i?o+(Math.ceil(n.text.length/r)||1)*e:o+e}}function n(t){var e=t.doc,i=r(t);e.iter(function(t){var e=i(t);e!=t.height&&cr(t,e)})}function o(t){t.display.wrapper.className=t.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+t.options.theme.replace(/(^|\s)\s*/g," cm-s-"),jt(t)}function s(t){a(t),be(t),setTimeout(function(){y(t)},20)}function a(t){var e=t.display.gutters,i=t.options.gutters;Vr(e);for(var r=0;r<i.length;++r){var n=i[r],o=e.appendChild(_r("div",null,"CodeMirror-gutter "+n));"CodeMirror-linenumbers"==n&&(t.display.lineGutter=o,o.style.width=(t.display.lineNumWidth||1)+"px")}e.style.display=r?"":"none",l(t)}function l(t){var e=t.display.gutters.offsetWidth;t.display.sizer.style.marginLeft=e+"px"}function c(t){if(0==t.height)return 0;for(var e,i=t.text.length,r=t;e=Ei(r);){r=(n=e.find(0,!0)).from.line,i+=n.from.ch-n.to.ch}for(r=t;e=Ni(r);){var n=e.find(0,!0);i-=r.text.length-n.from.ch,i+=(r=n.to.line).text.length-n.to.ch}return i}function d(t){var e=t.display,i=t.doc;e.maxLine=sr(i,i.first),e.maxLineLength=c(e.maxLine),e.maxLineChanged=!0,i.iter(function(t){var i=c(t);i>e.maxLineLength&&(e.maxLineLength=i,e.maxLine=t)})}function h(t){var e=Pr(t.gutters,"CodeMirror-linenumbers");-1==e&&t.lineNumbers?t.gutters=t.gutters.concat(["CodeMirror-linenumbers"]):e>-1&&!t.lineNumbers&&(t.gutters=t.gutters.slice(0),t.gutters.splice(e,1))}function u(t){var e=t.display,i=e.gutters.offsetWidth,r=Math.round(t.doc.height+Ht(t.display));return{clientHeight:e.scroller.clientHeight,viewHeight:e.wrapper.clientHeight,scrollWidth:e.scroller.scrollWidth,clientWidth:e.scroller.clientWidth,viewWidth:e.wrapper.clientWidth,barLeft:t.options.fixedGutter?i:0,docHeight:r,scrollHeight:r+Rt(t)+e.barHeight,nativeBarWidth:e.nativeBarWidth,gutterWidth:i}}function p(t,e,i){this.cm=i;var r=this.vert=_r("div",[_r("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),n=this.horiz=_r("div",[_r("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");t(r),t(n),Mo(r,"scroll",function(){r.clientHeight&&e(r.scrollTop,"vertical")}),Mo(n,"scroll",function(){n.clientWidth&&e(n.scrollLeft,"horizontal")}),this.checkedOverlay=!1,yn&&8>wn&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")}function f(){}function g(e){e.display.scrollbars&&(e.display.scrollbars.clear(),e.display.scrollbars.addClass&&Qo(e.display.wrapper,e.display.scrollbars.addClass)),e.display.scrollbars=new t.scrollbarModel[e.options.scrollbarStyle](function(t){e.display.wrapper.insertBefore(t,e.display.scrollbarFiller),Mo(t,"mousedown",function(){e.state.focused&&setTimeout(function(){e.display.input.focus()},0)}),t.setAttribute("cm-not-content","true")},function(t,i){"horizontal"==i?He(e,t):De(e,t)},e),e.display.scrollbars.addClass&&Zo(e.display.wrapper,e.display.scrollbars.addClass)}function m(t,e){e||(e=u(t));var i=t.display.barWidth,r=t.display.barHeight;v(t,e);for(var n=0;4>n&&i!=t.display.barWidth||r!=t.display.barHeight;n++)i!=t.display.barWidth&&t.options.lineWrapping&&E(t),v(t,u(t)),i=t.display.barWidth,r=t.display.barHeight}function v(t,e){var i=t.display,r=i.scrollbars.update(e);i.sizer.style.paddingRight=(i.barWidth=r.right)+"px",i.sizer.style.paddingBottom=(i.barHeight=r.bottom)+"px",r.right&&r.bottom?(i.scrollbarFiller.style.display="block",i.scrollbarFiller.style.height=r.bottom+"px",i.scrollbarFiller.style.width=r.right+"px"):i.scrollbarFiller.style.display="",r.bottom&&t.options.coverGutterNextToScrollbar&&t.options.fixedGutter?(i.gutterFiller.style.display="block",i.gutterFiller.style.height=r.bottom+"px",i.gutterFiller.style.width=e.gutterWidth+"px"):i.gutterFiller.style.display=""}function b(t,e,i){var r=i&&null!=i.top?Math.max(0,i.top):t.scroller.scrollTop;r=Math.floor(r-Dt(t));var n=i&&null!=i.bottom?i.bottom:r+t.wrapper.clientHeight,o=hr(e,r),s=hr(e,n);if(i&&i.ensure){var a=i.ensure.from.line,l=i.ensure.to.line;o>a?(o=a,s=hr(e,ur(sr(e,a))+t.wrapper.clientHeight)):Math.min(l,e.lastLine())>=s&&(o=hr(e,ur(sr(e,l))-t.wrapper.clientHeight),s=l)}return{from:o,to:Math.max(s,o+1)}}function y(t){var e=t.display,i=e.view;if(e.alignWidgets||e.gutters.firstChild&&t.options.fixedGutter){for(var r=x(e)-e.scroller.scrollLeft+t.doc.scrollLeft,n=e.gutters.offsetWidth,o=r+"px",s=0;s<i.length;s++)if(!i[s].hidden){t.options.fixedGutter&&i[s].gutter&&(i[s].gutter.style.left=o);var a=i[s].alignable;if(a)for(var l=0;l<a.length;l++)a[l].style.left=o}t.options.fixedGutter&&(e.gutters.style.left=r+n+"px")}}function w(t){if(!t.options.lineNumbers)return!1;var e=t.doc,i=k(t.options,e.first+e.size-1),r=t.display;if(i.length!=r.lineNumChars){var n=r.measure.appendChild(_r("div",[_r("div",i)],"CodeMirror-linenumber CodeMirror-gutter-elt")),o=n.firstChild.offsetWidth,s=n.offsetWidth-o;return r.lineGutter.style.width="",r.lineNumInnerWidth=Math.max(o,r.lineGutter.offsetWidth-s)+1,r.lineNumWidth=r.lineNumInnerWidth+s,r.lineNumChars=r.lineNumInnerWidth?i.length:-1,r.lineGutter.style.width=r.lineNumWidth+"px",l(t),!0}return!1}function k(t,e){return String(t.lineNumberFormatter(e+t.firstLineNumber))}function x(t){return t.scroller.getBoundingClientRect().left-t.sizer.getBoundingClientRect().left}function C(t,e,i){var r=t.display;this.viewport=e,this.visible=b(r,t.doc,e),this.editorIsHidden=!r.wrapper.offsetWidth,this.wrapperHeight=r.wrapper.clientHeight,this.wrapperWidth=r.wrapper.clientWidth,this.oldDisplayWidth=$t(t),this.force=i,this.dims=M(t),this.events=[]}function T(t,e){var i=t.display,r=t.doc;if(e.editorIsHidden)return we(t),!1;if(!e.force&&e.visible.from>=i.viewFrom&&e.visible.to<=i.viewTo&&(null==i.updateLineNumbers||i.updateLineNumbers>=i.viewTo)&&i.renderedView==i.view&&0==Ce(t))return!1;w(t)&&(we(t),e.dims=M(t));var n=r.first+r.size,o=Math.max(e.visible.from-t.options.viewportMargin,r.first),s=Math.min(n,e.visible.to+t.options.viewportMargin);i.viewFrom<o&&o-i.viewFrom<20&&(o=Math.max(r.first,i.viewFrom)),i.viewTo>s&&i.viewTo-s<20&&(s=Math.min(n,i.viewTo)),$n&&(o=Di(t.doc,o),s=Hi(t.doc,s));var a=o!=i.viewFrom||s!=i.viewTo||i.lastWrapHeight!=e.wrapperHeight||i.lastWrapWidth!=e.wrapperWidth;(function(t,e,i){var r=t.display;0==r.view.length||e>=r.viewTo||i<=r.viewFrom?(r.view=ve(t,e,i),r.viewFrom=e):(r.viewFrom>e?r.view=ve(t,e,r.viewFrom).concat(r.view):r.viewFrom<e&&(r.view=r.view.slice(ke(t,e))),r.viewFrom=e,r.viewTo<i?r.view=r.view.concat(ve(t,r.viewTo,i)):r.viewTo>i&&(r.view=r.view.slice(0,ke(t,i)))),r.viewTo=i})(t,o,s),i.viewOffset=ur(sr(t.doc,i.viewFrom)),t.display.mover.style.top=i.viewOffset+"px";var l=Ce(t);if(!a&&0==l&&!e.force&&i.renderedView==i.view&&(null==i.updateLineNumbers||i.updateLineNumbers>=i.viewTo))return!1;var c=Yr();return l>4&&(i.lineDiv.style.display="none"),function(t,e,i){function r(e){var i=e.nextSibling;return kn&&Mn&&t.display.currentWheelTarget==e?e.style.display="none":e.parentNode.removeChild(e),i}for(var n=t.display,o=t.options.lineNumbers,s=n.lineDiv,a=s.firstChild,l=n.view,c=n.viewFrom,d=0;d<l.length;d++){var h=l[d];if(h.hidden);else if(h.node&&h.node.parentNode==s){for(;a!=h.node;)a=r(a);var u=o&&null!=e&&c>=e&&h.lineNumber;h.changes&&(Pr(h.changes,"gutter")>-1&&(u=!1),O(t,h,c,i)),u&&(Vr(h.lineNumber),h.lineNumber.appendChild(document.createTextNode(k(t.options,c)))),a=h.node.nextSibling}else{var p=P(t,h,c,i);s.insertBefore(p,a)}c+=h.size}for(;a;)a=r(a)}(t,i.updateLineNumbers,e.dims),l>4&&(i.lineDiv.style.display=""),i.renderedView=i.view,c&&Yr()!=c&&c.offsetHeight&&c.focus(),Vr(i.cursorDiv),Vr(i.selectionDiv),i.gutters.style.height=i.sizer.style.minHeight=0,a&&(i.lastWrapHeight=e.wrapperHeight,i.lastWrapWidth=e.wrapperWidth,Nt(t,400)),i.updateLineNumbers=null,!0}function S(t,e){for(var i=e.viewport,r=!0;(r&&t.options.lineWrapping&&e.oldDisplayWidth!=$t(t)||(i&&null!=i.top&&(i={top:Math.min(t.doc.height+Ht(t.display)-Bt(t),i.top)}),e.visible=b(t.display,t.doc,i),!(e.visible.from>=t.display.viewFrom&&e.visible.to<=t.display.viewTo)))&&T(t,e);r=!1){E(t);var n=u(t);Tt(t),A(t,n),m(t,n)}e.signal(t,"update",t),(t.display.viewFrom!=t.display.reportedViewFrom||t.display.viewTo!=t.display.reportedViewTo)&&(e.signal(t,"viewportChange",t,t.display.viewFrom,t.display.viewTo),t.display.reportedViewFrom=t.display.viewFrom,t.display.reportedViewTo=t.display.viewTo)}function L(t,e){var i=new C(t,e);if(T(t,i)){E(t),S(t,i);var r=u(t);Tt(t),A(t,r),m(t,r),i.finish()}}function A(t,e){t.display.sizer.style.minHeight=e.docHeight+"px";var i=e.docHeight+t.display.barHeight;t.display.heightForcer.style.top=i+"px",t.display.gutters.style.height=Math.max(i+Rt(t),e.clientHeight)+"px"}function E(t){for(var e=t.display,i=e.lineDiv.offsetTop,r=0;r<e.view.length;r++){var n,o=e.view[r];if(!o.hidden){if(yn&&8>wn){var s=o.node.offsetTop+o.node.offsetHeight;n=s-i,i=s}else{var a=o.node.getBoundingClientRect();n=a.bottom-a.top}var l=o.line.height-n;if(2>n&&(n=re(e)),(l>.001||-.001>l)&&(cr(o.line,n),N(o.line),o.rest))for(var c=0;c<o.rest.length;c++)N(o.rest[c])}}}function N(t){if(t.widgets)for(var e=0;e<t.widgets.length;++e)t.widgets[e].height=t.widgets[e].node.offsetHeight}function M(t){for(var e=t.display,i={},r={},n=e.gutters.clientLeft,o=e.gutters.firstChild,s=0;o;o=o.nextSibling,++s)i[t.options.gutters[s]]=o.offsetLeft+o.clientLeft+n,r[t.options.gutters[s]]=o.clientWidth;return{fixedPos:x(e),gutterTotalWidth:e.gutters.offsetWidth,gutterLeft:i,gutterWidth:r,wrapperWidth:e.wrapper.clientWidth}}function O(t,e,i,r){for(var n=0;n<e.changes.length;n++){var o=e.changes[n];"text"==o?I(t,e):"gutter"==o?$(t,e,i,r):"class"==o?R(e):"widget"==o&&B(t,e,r)}e.changes=null}function D(t){return t.node==t.text&&(t.node=_r("div",null,null,"position: relative"),t.text.parentNode&&t.text.parentNode.replaceChild(t.node,t.text),t.node.appendChild(t.text),yn&&8>wn&&(t.node.style.zIndex=2)),t.node}function H(t,e){var i=t.display.externalMeasured;return i&&i.line==e.line?(t.display.externalMeasured=null,e.measure=i.measure,i.built):Vi(t,e)}function I(t,e){var i=e.text.className,r=H(t,e);e.text==e.node&&(e.node=r.pre),e.text.parentNode.replaceChild(r.pre,e.text),e.text=r.pre,r.bgClass!=e.bgClass||r.textClass!=e.textClass?(e.bgClass=r.bgClass,e.textClass=r.textClass,R(e)):i&&(e.text.className=i)}function R(t){(function(t){var e=t.bgClass?t.bgClass+" "+(t.line.bgClass||""):t.line.bgClass;if(e&&(e+=" CodeMirror-linebackground"),t.background)e?t.background.className=e:(t.background.parentNode.removeChild(t.background),t.background=null);else if(e){var i=D(t);t.background=i.insertBefore(_r("div",null,e),i.firstChild)}})(t),t.line.wrapClass?D(t).className=t.line.wrapClass:t.node!=t.text&&(t.node.className="");var e=t.textClass?t.textClass+" "+(t.line.textClass||""):t.line.textClass;t.text.className=e||""}function $(t,e,i,r){if(e.gutter&&(e.node.removeChild(e.gutter),e.gutter=null),e.gutterBackground&&(e.node.removeChild(e.gutterBackground),e.gutterBackground=null),e.line.gutterClass){var n=D(e);e.gutterBackground=_r("div",null,"CodeMirror-gutter-background "+e.line.gutterClass,"left: "+(t.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth)+"px; width: "+r.gutterTotalWidth+"px"),n.insertBefore(e.gutterBackground,e.text)}var o=e.line.gutterMarkers;if(t.options.lineNumbers||o){n=D(e);var s=e.gutter=_r("div",null,"CodeMirror-gutter-wrapper","left: "+(t.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth)+"px");if(t.display.input.setUneditable(s),n.insertBefore(s,e.text),e.line.gutterClass&&(s.className+=" "+e.line.gutterClass),!t.options.lineNumbers||o&&o["CodeMirror-linenumbers"]||(e.lineNumber=s.appendChild(_r("div",k(t.options,i),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+r.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+t.display.lineNumInnerWidth+"px"))),o)for(var a=0;a<t.options.gutters.length;++a){var l=t.options.gutters[a],c=o.hasOwnProperty(l)&&o[l];c&&s.appendChild(_r("div",[c],"CodeMirror-gutter-elt","left: "+r.gutterLeft[l]+"px; width: "+r.gutterWidth[l]+"px"))}}}function B(t,e,i){e.alignable&&(e.alignable=null);for(var r=e.node.firstChild;r;r=n){var n=r.nextSibling;"CodeMirror-linewidget"==r.className&&e.node.removeChild(r)}F(t,e,i)}function P(t,e,i,r){var n=H(t,e);return e.text=e.node=n.pre,n.bgClass&&(e.bgClass=n.bgClass),n.textClass&&(e.textClass=n.textClass),R(e),$(t,e,i,r),F(t,e,r),e.node}function F(t,e,i){if(W(t,e.line,e,i,!0),e.rest)for(var r=0;r<e.rest.length;r++)W(t,e.rest[r],e,i,!1)}function W(t,e,i,r,n){if(e.widgets)for(var o=D(i),s=0,a=e.widgets;s<a.length;++s){var l=a[s],c=_r("div",[l.node],"CodeMirror-linewidget");l.handleMouseEvents||c.setAttribute("cm-ignore-events","true"),z(l,c,i,r),t.display.input.setUneditable(c),n&&l.above?o.insertBefore(c,i.gutter||i.text):o.appendChild(c),Nr(l,"redraw")}}function z(t,e,i,r){if(t.noHScroll){(i.alignable||(i.alignable=[])).push(e);var n=r.wrapperWidth;e.style.left=r.fixedPos+"px",t.coverGutter||(n-=r.gutterTotalWidth,e.style.paddingLeft=r.gutterTotalWidth+"px"),e.style.width=n+"px"}t.coverGutter&&(e.style.zIndex=5,e.style.position="relative",t.noHScroll||(e.style.marginLeft=-r.gutterTotalWidth+"px"))}function U(t){return Bn(t.line,t.ch)}function K(t,e){return Pn(t,e)<0?e:t}function q(t,e){return Pn(t,e)<0?t:e}function G(t){t.state.focused||(t.display.input.focus(),ze(t))}function j(t){return t.options.readOnly||t.doc.cantEdit}function _(t,e,i,r,n){var o=t.doc;t.display.shift=!1,r||(r=o.sel);var s=t.state.pasteIncoming||"paste"==n,a=o.splitLines(e),l=null;if(s&&r.ranges.length>1)if(Fn&&Fn.join("\n")==e){if(r.ranges.length%Fn.length==0){l=[];for(var c=0;c<Fn.length;c++)l.push(o.splitLines(Fn[c]))}}else a.length==r.ranges.length&&(l=Fr(a,function(t){return[t]}));for(c=r.ranges.length-1;c>=0;c--){var d=r.ranges[c],h=d.from(),u=d.to();d.empty()&&(i&&i>0?h=Bn(h.line,h.ch-i):t.state.overwrite&&!s&&(u=Bn(u.line,Math.min(sr(o,u.line).text.length,u.ch+Br(a).length))));var p=t.curOp.updateInput,f={from:h,to:u,text:l?l[c%l.length]:a,origin:n||(s?"paste":t.state.cutIncoming?"cut":"+input")};Ve(t.doc,f),Nr(t,"inputRead",t,f)}e&&!s&&X(t,e),ri(t),t.curOp.updateInput=p,t.curOp.typing=!0,t.state.pasteIncoming=t.state.cutIncoming=!1}function V(t,e){var i=t.clipboardData&&t.clipboardData.getData("text/plain");return i?(t.preventDefault(),j(e)||e.options.disableInput||ue(e,function(){_(e,i,0,null,"paste")}),!0):void 0}function X(t,e){if(t.options.electricChars&&t.options.smartIndent)for(var i=t.doc.sel,r=i.ranges.length-1;r>=0;r--){var n=i.ranges[r];if(!(n.head.ch>100||r&&i.ranges[r-1].head.line==n.head.line)){var o=t.getModeAt(n.head),s=!1;if(o.electricChars){for(var a=0;a<o.electricChars.length;a++)if(e.indexOf(o.electricChars.charAt(a))>-1){s=oi(t,n.head.line,"smart");break}}else o.electricInput&&o.electricInput.test(sr(t.doc,n.head.line).text.slice(0,n.head.ch))&&(s=oi(t,n.head.line,"smart"));s&&Nr(t,"electricInput",t,n.head.line)}}}function Y(t){for(var e=[],i=[],r=0;r<t.doc.sel.ranges.length;r++){var n=t.doc.sel.ranges[r].head.line,o={anchor:Bn(n,0),head:Bn(n+1,0)};i.push(o),e.push(t.getRange(o.anchor,o.head))}return{text:e,ranges:i}}function Q(t){t.setAttribute("autocorrect","off"),t.setAttribute("autocapitalize","off"),t.setAttribute("spellcheck","false")}function Z(t){this.cm=t,this.prevInput="",this.pollingFast=!1,this.polling=new Rr,this.inaccurateSelection=!1,this.hasSelection=!1,this.composing=null}function J(){var t=_r("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none"),e=_r("div",[t],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return kn?t.style.width="1000px":t.setAttribute("wrap","off"),En&&(t.style.border="1px solid black"),Q(t),e}function tt(t){this.cm=t,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new Rr,this.gracePeriod=!1}function et(t,e){var i=Wt(t,e.line);if(!i||i.hidden)return null;var r=sr(t.doc,e.line),n=Pt(i,r,e.line),o=pr(r),s="left";o&&(s=dn(o,e.ch)%2?"right":"left");var a=Kt(n.map,e.ch,s);return a.offset="right"==a.collapse?a.end:a.start,a}function it(t,e){return e&&(t.bad=!0),t}function rt(t,e,i){var r;if(e==t.display.lineDiv){if(!(r=t.display.lineDiv.childNodes[i]))return it(t.clipPos(Bn(t.display.viewTo-1)),!0);e=null,i=0}else for(r=e;;r=r.parentNode){if(!r||r==t.display.lineDiv)return null;if(r.parentNode&&r.parentNode==t.display.lineDiv)break}for(var n=0;n<t.display.view.length;n++){var o=t.display.view[n];if(o.node==r)return nt(o,e,i)}}function nt(t,e,i){function r(e,i,r){for(var n=-1;n<(d?d.length:0);n++)for(var o=0>n?c.map:d[n],s=0;s<o.length;s+=3){var a=o[s+2];if(a==e||a==i){var l=dr(0>n?t.line:t.rest[n]),h=o[s]+r;return(0>r||a!=e)&&(h=o[s+(r?1:0)]),Bn(l,h)}}}var n=t.text.firstChild,o=!1;if(!e||!Vo(n,e))return it(Bn(dr(t.line),0),!0);if(e==n&&(o=!0,e=n.childNodes[i],i=0,!e)){var s=t.rest?Br(t.rest):t.line;return it(Bn(dr(s),s.text.length),o)}var a=3==e.nodeType?e:null,l=e;for(a||1!=e.childNodes.length||3!=e.firstChild.nodeType||(a=e.firstChild,i&&(i=a.nodeValue.length));l.parentNode!=n;)l=l.parentNode;var c=t.measure,d=c.maps,h=r(a,l,i);if(h)return it(h,o);for(var u=l.nextSibling,p=a?a.nodeValue.length-i:0;u;u=u.nextSibling){if(h=r(u,u.firstChild,0))return it(Bn(h.line,h.ch-p),o);p+=u.textContent.length}var f=l.previousSibling;for(p=i;f;f=f.previousSibling){if(h=r(f,f.firstChild,-1))return it(Bn(h.line,h.ch+p),o);p+=u.textContent.length}}function ot(t,e){this.ranges=t,this.primIndex=e}function st(t,e){this.anchor=t,this.head=e}function at(t,e){var i=t[e];t.sort(function(t,e){return Pn(t.from(),e.from())}),e=Pr(t,i);for(var r=1;r<t.length;r++){var n=t[r],o=t[r-1];if(Pn(o.to(),n.from())>=0){var s=q(o.from(),n.from()),a=K(o.to(),n.to()),l=o.empty()?n.from()==n.head:o.from()==o.head;e>=r&&--e,t.splice(--r,2,new st(l?a:s,l?s:a))}}return new ot(t,e)}function lt(t,e){return new ot([new st(t,e||t)],0)}function ct(t,e){return Math.max(t.first,Math.min(e,t.first+t.size-1))}function dt(t,e){if(e.line<t.first)return Bn(t.first,0);var i=t.first+t.size-1;return e.line>i?Bn(i,sr(t,i).text.length):function(t,e){var i=t.ch;return null==i||i>e?Bn(t.line,e):0>i?Bn(t.line,0):t}(e,sr(t,e.line).text.length)}function ht(t,e){return e>=t.first&&e<t.first+t.size}function ut(t,e,i,r){if(t.cm&&t.cm.display.shift||t.extend){var n=e.anchor;if(r){var o=Pn(i,n)<0;o!=Pn(r,n)<0?(n=i,i=r):o!=Pn(i,r)<0&&(i=r)}return new st(n,i)}return new st(r||i,i)}function pt(t,e,i,r){bt(t,new ot([ut(t,t.sel.primary(),e,i)],0),r)}function ft(t,e,i){for(var r=[],n=0;n<t.sel.ranges.length;n++)r[n]=ut(t,t.sel.ranges[n],e[n],null);bt(t,at(r,t.sel.primIndex),i)}function gt(t,e,i,r){var n=t.sel.ranges.slice(0);n[e]=i,bt(t,at(n,t.sel.primIndex),r)}function mt(t,e,i,r){bt(t,lt(e,i),r)}function vt(t,e,i){var r=t.history.done,n=Br(r);n&&n.ranges?(r[r.length-1]=e,yt(t,e,i)):bt(t,e,i)}function bt(t,e,i){yt(t,e,i),function(t,e,i,r){var n=t.history,o=r&&r.origin;i==n.lastSelOp||o&&n.lastSelOrigin==o&&(n.lastModTime==n.lastSelTime&&n.lastOrigin==o||function(t,e,i,r){var n=e.charAt(0);return"*"==n||"+"==n&&i.ranges.length==r.ranges.length&&i.somethingSelected()==r.somethingSelected()&&new Date-t.history.lastSelTime<=(t.cm?t.cm.options.historyEventDelay:500)}(t,o,Br(n.done),e))?n.done[n.done.length-1]=e:br(e,n.done),n.lastSelTime=+new Date,n.lastSelOrigin=o,n.lastSelOp=i,r&&!1!==r.clearRedo&&mr(n.undone)}(t,t.sel,t.cm?t.cm.curOp.id:NaN,i)}function yt(t,e,i){(Hr(t,"beforeSelectionChange")||t.cm&&Hr(t.cm,"beforeSelectionChange"))&&(e=function(t,e){var i={ranges:e.ranges,update:function(e){this.ranges=[];for(var i=0;i<e.length;i++)this.ranges[i]=new st(dt(t,e[i].anchor),dt(t,e[i].head))}};return Ho(t,"beforeSelectionChange",t,i),t.cm&&Ho(t.cm,"beforeSelectionChange",t.cm,i),i.ranges!=e.ranges?at(i.ranges,i.ranges.length-1):e}(t,e)),wt(t,xt(t,e,i&&i.bias||(Pn(e.primary().head,t.sel.primary().head)<0?-1:1),!0)),i&&!1===i.scroll||!t.cm||ri(t.cm)}function wt(t,e){e.equals(t.sel)||(t.sel=e,t.cm&&(t.cm.curOp.updateInput=t.cm.curOp.selectionChanged=!0,Dr(t.cm)),Nr(t,"cursorActivity",t))}function kt(t){wt(t,xt(t,t.sel,null,!1))}function xt(t,e,i,r){for(var n,o=0;o<e.ranges.length;o++){var s=e.ranges[o],a=Ct(t,s.anchor,i,r),l=Ct(t,s.head,i,r);(n||a!=s.anchor||l!=s.head)&&(n||(n=e.ranges.slice(0,o)),n[o]=new st(a,l))}return n?at(n,e.primIndex):e}function Ct(t,e,i,r){var n=!1,o=e,s=i||1;t.cantEdit=!1;t:for(;;){var a=sr(t,o.line);if(a.markedSpans)for(var l=0;l<a.markedSpans.length;++l){var c=a.markedSpans[l],d=c.marker;if((null==c.from||(d.inclusiveLeft?c.from<=o.ch:c.from<o.ch))&&(null==c.to||(d.inclusiveRight?c.to>=o.ch:c.to>o.ch))){if(r&&(Ho(d,"beforeCursorEnter"),d.explicitlyCleared)){if(a.markedSpans){--l;continue}break}if(!d.atomic)continue;var h=d.find(0>s?-1:1);if(0==Pn(h,o)&&(h.ch+=s,h.ch<0?h=h.line>t.first?dt(t,Bn(h.line-1)):null:h.ch>a.text.length&&(h=h.line<t.first+t.size-1?Bn(h.line+1,0):null),!h)){if(n)return r?(t.cantEdit=!0,Bn(t.first,0)):Ct(t,e,i,!0);n=!0,h=e,s=-s}o=h;continue t}}return o}}function Tt(t){t.display.input.showSelection(t.display.input.prepareSelection())}function St(t,e){for(var i=t.doc,r={},n=r.cursors=document.createDocumentFragment(),o=r.selection=document.createDocumentFragment(),s=0;s<i.sel.ranges.length;s++)if(!1!==e||s!=i.sel.primIndex){var a=i.sel.ranges[s],l=a.empty();(l||t.options.showCursorWhenSelecting)&&Lt(t,a.head,n),l||At(t,a,o)}return r}function Lt(t,e,i){var r=Zt(t,e,"div",null,null,!t.options.singleCursorHeightPerLine),n=i.appendChild(_r("div"," ","CodeMirror-cursor"));if(n.style.left=r.left+"px",n.style.top=r.top+"px",n.style.height=Math.max(0,r.bottom-r.top)*t.options.cursorHeight+"px",r.other){var o=i.appendChild(_r("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));o.style.display="",o.style.left=r.other.left+"px",o.style.top=r.other.top+"px",o.style.height=.85*(r.other.bottom-r.other.top)+"px"}}function At(t,e,i){function r(t,e,i,r){0>e&&(e=0),e=Math.round(e),r=Math.round(r),a.appendChild(_r("div",null,"CodeMirror-selected","position: absolute; left: "+t+"px; top: "+e+"px; width: "+(null==i?d-t:i)+"px; height: "+(r-e)+"px"))}function n(e,i,n){function o(i,r){return Qt(t,Bn(e,i),"div",h,r)}var a,l,h=sr(s,e),u=h.text.length;return function(t,e,i,r){if(!t)return r(e,i,"ltr");for(var n=!1,o=0;o<t.length;++o){var s=t[o];(s.from<i&&s.to>e||e==i&&s.to==e)&&(r(Math.max(s.from,e),Math.min(s.to,i),1==s.level?"rtl":"ltr"),n=!0)}n||r(e,i,"ltr")}(pr(h),i||0,null==n?u:n,function(t,e,s){var h,p,f,g=o(t,"left");if(t==e)h=g,p=f=g.left;else{if(h=o(e-1,"right"),"rtl"==s){var m=g;g=h,h=m}p=g.left,f=h.right}null==i&&0==t&&(p=c),h.top-g.top>3&&(r(p,g.top,null,g.bottom),p=c,g.bottom<h.top&&r(p,g.bottom,null,h.top)),null==n&&e==u&&(f=d),(!a||g.top<a.top||g.top==a.top&&g.left<a.left)&&(a=g),(!l||h.bottom>l.bottom||h.bottom==l.bottom&&h.right>l.right)&&(l=h),c+1>p&&(p=c),r(p,h.top,f-p,h.bottom)}),{start:a,end:l}}var o=t.display,s=t.doc,a=document.createDocumentFragment(),l=It(t.display),c=l.left,d=Math.max(o.sizerWidth,$t(t)-o.sizer.offsetLeft)-l.right,h=e.from(),u=e.to();if(h.line==u.line)n(h.line,h.ch,u.ch);else{var p=sr(s,h.line),f=sr(s,u.line),g=Oi(p)==Oi(f),m=n(h.line,h.ch,g?p.text.length+1:null).end,v=n(u.line,g?0:null,u.ch).start;g&&(m.top<v.top-2?(r(m.right,m.top,null,m.bottom),r(c,v.top,v.left,v.bottom)):r(m.right,m.top,v.left-m.right,m.bottom)),m.bottom<v.top&&r(c,m.bottom,null,v.top)}i.appendChild(a)}function Et(t){if(t.state.focused){var e=t.display;clearInterval(e.blinker);var i=!0;e.cursorDiv.style.visibility="",t.options.cursorBlinkRate>0?e.blinker=setInterval(function(){e.cursorDiv.style.visibility=(i=!i)?"":"hidden"},t.options.cursorBlinkRate):t.options.cursorBlinkRate<0&&(e.cursorDiv.style.visibility="hidden")}}function Nt(t,e){t.doc.mode.startState&&t.doc.frontier<t.display.viewTo&&t.state.highlight.set(e,Kr(Mt,t))}function Mt(t){var e=t.doc;if(e.frontier<e.first&&(e.frontier=e.first),!(e.frontier>=t.display.viewTo)){var i=+new Date+t.options.workTime,r=ao(e.mode,Ot(t,e.frontier)),n=[];e.iter(e.frontier,Math.min(e.first+e.size,t.display.viewTo+500),function(o){if(e.frontier>=t.display.viewFrom){var s=o.styles,a=o.text.length>t.options.maxHighlightLength,l=qi(t,o,a?ao(e.mode,r):r,!0);o.styles=l.styles;var c=o.styleClasses,d=l.classes;d?o.styleClasses=d:c&&(o.styleClasses=null);for(var h=!s||s.length!=o.styles.length||c!=d&&(!c||!d||c.bgClass!=d.bgClass||c.textClass!=d.textClass),u=0;!h&&u<s.length;++u)h=s[u]!=o.styles[u];h&&n.push(e.frontier),o.stateAfter=a?r:ao(e.mode,r)}else o.text.length<=t.options.maxHighlightLength&&ji(t,o.text,r),o.stateAfter=e.frontier%5==0?ao(e.mode,r):null;return++e.frontier,+new Date>i?(Nt(t,t.options.workDelay),!0):void 0}),n.length&&ue(t,function(){for(var e=0;e<n.length;e++)ye(t,n[e],"text")})}}function Ot(t,e,i){var r=t.doc,n=t.display;if(!r.mode.startState)return!0;var o=function(t,e,i){for(var r,n,o=t.doc,s=i?-1:e-(t.doc.mode.innerMode?1e3:100),a=e;a>s;--a){if(a<=o.first)return o.first;var l=sr(o,a-1);if(l.stateAfter&&(!i||a<=o.frontier))return a;var c=Wo(l.text,null,t.options.tabSize);(null==n||r>c)&&(n=a-1,r=c)}return n}(t,e,i),s=o>r.first&&sr(r,o-1).stateAfter;return s=s?ao(r.mode,s):lo(r.mode),r.iter(o,e,function(i){ji(t,i.text,s);var a=o==e-1||o%5==0||o>=n.viewFrom&&o<n.viewTo;i.stateAfter=a?ao(r.mode,s):null,++o}),i&&(r.frontier=o),s}function Dt(t){return t.lineSpace.offsetTop}function Ht(t){return t.mover.offsetHeight-t.lineSpace.offsetHeight}function It(t){if(t.cachedPaddingH)return t.cachedPaddingH;var e=Xr(t.measure,_r("pre","x")),i=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle,r={left:parseInt(i.paddingLeft),right:parseInt(i.paddingRight)};return isNaN(r.left)||isNaN(r.right)||(t.cachedPaddingH=r),r}function Rt(t){return Ro-t.display.nativeBarWidth}function $t(t){return t.display.scroller.clientWidth-Rt(t)-t.display.barWidth}function Bt(t){return t.display.scroller.clientHeight-Rt(t)-t.display.barHeight}function Pt(t,e,i){if(t.line==e)return{map:t.measure.map,cache:t.measure.cache};for(var r=0;r<t.rest.length;r++)if(t.rest[r]==e)return{map:t.measure.maps[r],cache:t.measure.caches[r]};for(r=0;r<t.rest.length;r++)if(dr(t.rest[r])>i)return{map:t.measure.maps[r],cache:t.measure.caches[r],before:!0}}function Ft(t,e,i,r){return Ut(t,zt(t,e),i,r)}function Wt(t,e){if(e>=t.display.viewFrom&&e<t.display.viewTo)return t.display.view[ke(t,e)];var i=t.display.externalMeasured;return i&&e>=i.lineN&&e<i.lineN+i.size?i:void 0}function zt(t,e){var i=dr(e),r=Wt(t,i);r&&!r.text?r=null:r&&r.changes&&(O(t,r,i,M(t)),t.curOp.forceUpdate=!0),r||(r=function(t,e){var i=dr(e=Oi(e)),r=t.display.externalMeasured=new me(t.doc,e,i);r.lineN=i;var n=r.built=Vi(t,r);return r.text=n.pre,Xr(t.display.lineMeasure,n.pre),r}(t,e));var n=Pt(r,e,i);return{line:e,view:r,rect:null,map:n.map,cache:n.cache,before:n.before,hasHeights:!1}}function Ut(t,e,i,r,n){e.before&&(i=-1);var o,s=i+(r||"");return e.cache.hasOwnProperty(s)?o=e.cache[s]:(e.rect||(e.rect=e.view.text.getBoundingClientRect()),e.hasHeights||(function(t,e,i){var r=t.options.lineWrapping,n=r&&$t(t);if(!e.measure.heights||r&&e.measure.width!=n){var o=e.measure.heights=[];if(r){e.measure.width=n;for(var s=e.text.firstChild.getClientRects(),a=0;a<s.length-1;a++){var l=s[a],c=s[a+1];Math.abs(l.bottom-c.bottom)>2&&o.push((l.bottom+c.top)/2-i.top)}}o.push(i.bottom-i.top)}}(t,e.view,e.rect),e.hasHeights=!0),(o=function(t,e,i,r){var n,o=Kt(e.map,i,r),s=o.node,a=o.start,l=o.end,c=o.collapse;if(3==s.nodeType){for(var d=0;4>d;d++){for(;a&&jr(e.line.text.charAt(o.coverStart+a));)--a;for(;o.coverStart+l<o.coverEnd&&jr(e.line.text.charAt(o.coverStart+l));)++l;if(yn&&9>wn&&0==a&&l==o.coverEnd-o.coverStart)n=s.parentNode.getBoundingClientRect();else if(yn&&t.options.lineWrapping){var h=qo(s,a,l).getClientRects();n=h.length?h["right"==r?h.length-1:0]:Kn}else n=qo(s,a,l).getBoundingClientRect()||Kn;if(n.left||n.right||0==a)break;l=a,a-=1,c="right"}yn&&11>wn&&(n=function(t,e){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!function(t){if(null!=ns)return ns;var e=Xr(t,_r("span","x")),i=e.getBoundingClientRect(),r=qo(e,0,1).getBoundingClientRect();return ns=Math.abs(i.left-r.left)>1}(t))return e;var i=screen.logicalXDPI/screen.deviceXDPI,r=screen.logicalYDPI/screen.deviceYDPI;return{left:e.left*i,right:e.right*i,top:e.top*r,bottom:e.bottom*r}}(t.display.measure,n))}else{a>0&&(c=r="right"),n=t.options.lineWrapping&&(h=s.getClientRects()).length>1?h["right"==r?h.length-1:0]:s.getBoundingClientRect()}if(yn&&9>wn&&!a&&(!n||!n.left&&!n.right)){var u=s.parentNode.getClientRects()[0];n=u?{left:u.left,right:u.left+ne(t.display),top:u.top,bottom:u.bottom}:Kn}for(var p=n.top-e.rect.top,f=n.bottom-e.rect.top,g=(p+f)/2,m=e.view.measure.heights,d=0;d<m.length-1&&!(g<m[d]);d++);var v=d?m[d-1]:0,b=m[d],y={left:("right"==c?n.right:n.left)-e.rect.left,right:("left"==c?n.left:n.right)-e.rect.left,top:v,bottom:b};return n.left||n.right||(y.bogus=!0),t.options.singleCursorHeightPerLine||(y.rtop=p,y.rbottom=f),y}(t,e,i,r)).bogus||(e.cache[s]=o)),{left:o.left,right:o.right,top:n?o.rtop:o.top,bottom:n?o.rbottom:o.bottom}}function Kt(t,e,i){for(var r,n,o,s,a=0;a<t.length;a+=3){var l=t[a],c=t[a+1];if(l>e?(n=0,o=1,s="left"):c>e?o=(n=e-l)+1:(a==t.length-3||e==c&&t[a+3]>e)&&(n=(o=c-l)-1,e>=c&&(s="right")),null!=n){if(r=t[a+2],l==c&&i==(r.insertLeft?"left":"right")&&(s=i),"left"==i&&0==n)for(;a&&t[a-2]==t[a-3]&&t[a-1].insertLeft;)r=t[2+(a-=3)],s="left";if("right"==i&&n==c-l)for(;a<t.length-3&&t[a+3]==t[a+4]&&!t[a+5].insertLeft;)r=t[(a+=3)+2],s="right";break}}return{node:r,start:n,end:o,collapse:s,coverStart:l,coverEnd:c}}function qt(t){if(t.measure&&(t.measure.cache={},t.measure.heights=null,t.rest))for(var e=0;e<t.rest.length;e++)t.measure.caches[e]={}}function Gt(t){t.display.externalMeasure=null,Vr(t.display.lineMeasure);for(var e=0;e<t.display.view.length;e++)qt(t.display.view[e])}function jt(t){Gt(t),t.display.cachedCharWidth=t.display.cachedTextHeight=t.display.cachedPaddingH=null,t.options.lineWrapping||(t.display.maxLineChanged=!0),t.display.lineNumChars=null}function _t(){return window.pageXOffset||(document.documentElement||document.body).scrollLeft}function Vt(){return window.pageYOffset||(document.documentElement||document.body).scrollTop}function Xt(t,e,i,r){if(e.widgets)for(var n=0;n<e.widgets.length;++n)if(e.widgets[n].above){var o=Bi(e.widgets[n]);i.top+=o,i.bottom+=o}if("line"==r)return i;r||(r="local");var s=ur(e);if("local"==r?s+=Dt(t.display):s-=t.display.viewOffset,"page"==r||"window"==r){var a=t.display.lineSpace.getBoundingClientRect();s+=a.top+("window"==r?0:Vt());var l=a.left+("window"==r?0:_t());i.left+=l,i.right+=l}return i.top+=s,i.bottom+=s,i}function Yt(t,e,i){if("div"==i)return e;var r=e.left,n=e.top;if("page"==i)r-=_t(),n-=Vt();else if("local"==i||!i){var o=t.display.sizer.getBoundingClientRect();r+=o.left,n+=o.top}var s=t.display.lineSpace.getBoundingClientRect();return{left:r-s.left,top:n-s.top}}function Qt(t,e,i,r,n){return r||(r=sr(t.doc,e.line)),Xt(t,r,Ft(t,r,e.ch,n),i)}function Zt(t,e,i,r,n,o){function s(e,s){var a=Ut(t,n,e,s?"right":"left",o);return s?a.left=a.right:a.right=a.left,Xt(t,r,a,i)}function a(t,e){var i=l[e],r=i.level%2;return t==rn(i)&&e&&i.level<l[e-1].level?(t=nn(i=l[--e])-(i.level%2?0:1),r=!0):t==nn(i)&&e<l.length-1&&i.level<l[e+1].level&&(t=rn(i=l[++e])-i.level%2,r=!1),r&&t==i.to&&t>i.from?s(t-1):s(t,r)}r=r||sr(t.doc,e.line),n||(n=zt(t,r));var l=pr(r),c=e.ch;if(!l)return s(c);var d=a(c,dn(l,c));return null!=ss&&(d.other=a(c,ss)),d}function Jt(t,e){var i=0;e=dt(t.doc,e);t.options.lineWrapping||(i=ne(t.display)*e.ch);var r=sr(t.doc,e.line),n=ur(r)+Dt(t.display);return{left:i,right:i,top:n,bottom:n+r.height}}function te(t,e,i,r){var n=Bn(t,e);return n.xRel=r,i&&(n.outside=!0),n}function ee(t,e,i){var r=t.doc;if(0>(i+=t.display.viewOffset))return te(r.first,0,!0,-1);var n=hr(r,i),o=r.first+r.size-1;if(n>o)return te(r.first+r.size-1,sr(r,o).text.length,!0,1);0>e&&(e=0);for(var s=sr(r,n);;){var a=ie(t,s,n,e,i),l=Ni(s),c=l&&l.find(0,!0);if(!l||!(a.ch>c.from.ch||a.ch==c.from.ch&&a.xRel>0))return a;n=dr(s=c.to.line)}}function ie(t,e,i,r,n){function o(r){var n=Zt(t,Bn(i,r),"line",e,c);return a=!0,s>n.bottom?n.left-l:s<n.top?n.left+l:(a=!1,n.left)}var s=n-ur(e),a=!1,l=2*t.display.wrapper.clientWidth,c=zt(t,e),d=pr(e),h=e.text.length,u=on(e),p=sn(e),f=o(u),g=a,m=o(p),v=a;if(r>m)return te(i,p,v,1);for(;;){if(d?p==u||p==un(e,u,1):1>=p-u){for(var b=f>r||m-r>=r-f?u:p,y=r-(b==u?f:m);jr(e.text.charAt(b));)++b;return te(i,b,b==u?g:v,-1>y?-1:y>1?1:0)}var w=Math.ceil(h/2),k=u+w;if(d){k=u;for(var x=0;w>x;++x)k=un(e,k,1)}var C=o(k);C>r?(p=k,m=C,(v=a)&&(m+=1e3),h=w):(u=k,f=C,g=a,h-=w)}}function re(t){if(null!=t.cachedTextHeight)return t.cachedTextHeight;if(null==Wn){Wn=_r("pre");for(var e=0;49>e;++e)Wn.appendChild(document.createTextNode("x")),Wn.appendChild(_r("br"));Wn.appendChild(document.createTextNode("x"))}Xr(t.measure,Wn);var i=Wn.offsetHeight/50;return i>3&&(t.cachedTextHeight=i),Vr(t.measure),i||1}function ne(t){if(null!=t.cachedCharWidth)return t.cachedCharWidth;var e=_r("span","xxxxxxxxxx"),i=_r("pre",[e]);Xr(t.measure,i);var r=e.getBoundingClientRect(),n=(r.right-r.left)/10;return n>2&&(t.cachedCharWidth=n),n||10}function oe(t){t.curOp={cm:t,viewChanged:!1,startHeight:t.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++Gn},qn?qn.ops.push(t.curOp):t.curOp.ownsGroup=qn={ops:[t.curOp],delayedCallbacks:[]}}function se(t){var e=t.curOp.ownsGroup;if(e)try{!function(t){var e=t.delayedCallbacks,i=0;do{for(;i<e.length;i++)e[i].call(null);for(var r=0;r<t.ops.length;r++){var n=t.ops[r];if(n.cursorActivityHandlers)for(;n.cursorActivityCalled<n.cursorActivityHandlers.length;)n.cursorActivityHandlers[n.cursorActivityCalled++].call(null,n.cm)}}while(i<e.length)}(e)}finally{qn=null;for(var i=0;i<e.ops.length;i++)e.ops[i].cm.curOp=null;!function(t){for(var e=t.ops,i=0;i<e.length;i++)ae(e[i]);for(var i=0;i<e.length;i++)le(e[i]);for(var i=0;i<e.length;i++)ce(e[i]);for(var i=0;i<e.length;i++)de(e[i]);for(var i=0;i<e.length;i++)he(e[i])}(e)}}function ae(t){var e=t.cm,i=e.display;(function(t){var e=t.display;!e.scrollbarsClipped&&e.scroller.offsetWidth&&(e.nativeBarWidth=e.scroller.offsetWidth-e.scroller.clientWidth,e.heightForcer.style.height=Rt(t)+"px",e.sizer.style.marginBottom=-e.nativeBarWidth+"px",e.sizer.style.borderRightWidth=Rt(t)+"px",e.scrollbarsClipped=!0)})(e),t.updateMaxLine&&d(e),t.mustUpdate=t.viewChanged||t.forceUpdate||null!=t.scrollTop||t.scrollToPos&&(t.scrollToPos.from.line<i.viewFrom||t.scrollToPos.to.line>=i.viewTo)||i.maxLineChanged&&e.options.lineWrapping,t.update=t.mustUpdate&&new C(e,t.mustUpdate&&{top:t.scrollTop,ensure:t.scrollToPos},t.forceUpdate)}function le(t){t.updatedDisplay=t.mustUpdate&&T(t.cm,t.update)}function ce(t){var e=t.cm,i=e.display;t.updatedDisplay&&E(e),t.barMeasure=u(e),i.maxLineChanged&&!e.options.lineWrapping&&(t.adjustWidthTo=Ft(e,i.maxLine,i.maxLine.text.length).left+3,e.display.sizerWidth=t.adjustWidthTo,t.barMeasure.scrollWidth=Math.max(i.scroller.clientWidth,i.sizer.offsetLeft+t.adjustWidthTo+Rt(e)+e.display.barWidth),t.maxScrollLeft=Math.max(0,i.sizer.offsetLeft+t.adjustWidthTo-$t(e))),(t.updatedDisplay||t.selectionChanged)&&(t.preparedSelection=i.input.prepareSelection())}function de(t){var e=t.cm;null!=t.adjustWidthTo&&(e.display.sizer.style.minWidth=t.adjustWidthTo+"px",t.maxScrollLeft<e.doc.scrollLeft&&He(e,Math.min(e.display.scroller.scrollLeft,t.maxScrollLeft),!0),e.display.maxLineChanged=!1),t.preparedSelection&&e.display.input.showSelection(t.preparedSelection),t.updatedDisplay&&A(e,t.barMeasure),(t.updatedDisplay||t.startHeight!=e.doc.height)&&m(e,t.barMeasure),t.selectionChanged&&Et(e),e.state.focused&&t.updateInput&&e.display.input.reset(t.typing),t.focus&&t.focus==Yr()&&G(t.cm)}function he(t){var e=t.cm,i=e.display,r=e.doc;if(t.updatedDisplay&&S(e,t.update),null==i.wheelStartX||null==t.scrollTop&&null==t.scrollLeft&&!t.scrollToPos||(i.wheelStartX=i.wheelStartY=null),null==t.scrollTop||i.scroller.scrollTop==t.scrollTop&&!t.forceScroll||(r.scrollTop=Math.max(0,Math.min(i.scroller.scrollHeight-i.scroller.clientHeight,t.scrollTop)),i.scrollbars.setScrollTop(r.scrollTop),i.scroller.scrollTop=r.scrollTop),null==t.scrollLeft||i.scroller.scrollLeft==t.scrollLeft&&!t.forceScroll||(r.scrollLeft=Math.max(0,Math.min(i.scroller.scrollWidth-$t(e),t.scrollLeft)),i.scrollbars.setScrollLeft(r.scrollLeft),i.scroller.scrollLeft=r.scrollLeft,y(e)),t.scrollToPos){var n=function(t,e,i,r){null==r&&(r=0);for(var n=0;5>n;n++){var o=!1,s=Zt(t,e),a=i&&i!=e?Zt(t,i):s,l=ei(t,Math.min(s.left,a.left),Math.min(s.top,a.top)-r,Math.max(s.left,a.left),Math.max(s.bottom,a.bottom)+r),c=t.doc.scrollTop,d=t.doc.scrollLeft;if(null!=l.scrollTop&&(De(t,l.scrollTop),Math.abs(t.doc.scrollTop-c)>1&&(o=!0)),null!=l.scrollLeft&&(He(t,l.scrollLeft),Math.abs(t.doc.scrollLeft-d)>1&&(o=!0)),!o)break}return s}(e,dt(r,t.scrollToPos.from),dt(r,t.scrollToPos.to),t.scrollToPos.margin);t.scrollToPos.isCursor&&e.state.focused&&function(t,e){if(!Or(t,"scrollCursorIntoView")){var i=t.display,r=i.sizer.getBoundingClientRect(),n=null;if(e.top+r.top<0?n=!0:e.bottom+r.top>(window.innerHeight||document.documentElement.clientHeight)&&(n=!1),null!=n&&!An){var o=_r("div","​",null,"position: absolute; top: "+(e.top-i.viewOffset-Dt(t.display))+"px; height: "+(e.bottom-e.top+Rt(t)+i.barHeight)+"px; left: "+e.left+"px; width: 2px;");t.display.lineSpace.appendChild(o),o.scrollIntoView(n),t.display.lineSpace.removeChild(o)}}}(e,n)}var o=t.maybeHiddenMarkers,s=t.maybeUnhiddenMarkers;if(o)for(var a=0;a<o.length;++a)o[a].lines.length||Ho(o[a],"hide");if(s)for(a=0;a<s.length;++a)s[a].lines.length&&Ho(s[a],"unhide");i.wrapper.offsetHeight&&(r.scrollTop=e.display.scroller.scrollTop),t.changeObjs&&Ho(e,"changes",e,t.changeObjs),t.update&&t.update.finish()}function ue(t,e){if(t.curOp)return e();oe(t);try{return e()}finally{se(t)}}function pe(t,e){return function(){if(t.curOp)return e.apply(t,arguments);oe(t);try{return e.apply(t,arguments)}finally{se(t)}}}function fe(t){return function(){if(this.curOp)return t.apply(this,arguments);oe(this);try{return t.apply(this,arguments)}finally{se(this)}}}function ge(t){return function(){var e=this.cm;if(!e||e.curOp)return t.apply(this,arguments);oe(e);try{return t.apply(this,arguments)}finally{se(e)}}}function me(t,e,i){this.line=e,this.rest=function(t){for(var e,i;e=Ni(t);)t=e.find(1,!0).line,(i||(i=[])).push(t);return i}(e),this.size=this.rest?dr(Br(this.rest))-i+1:1,this.node=this.text=null,this.hidden=Ii(t,e)}function ve(t,e,i){for(var r,n=[],o=e;i>o;o=r){var s=new me(t.doc,sr(t.doc,o),o);r=o+s.size,n.push(s)}return n}function be(t,e,i,r){null==e&&(e=t.doc.first),null==i&&(i=t.doc.first+t.doc.size),r||(r=0);var n=t.display;if(r&&i<n.viewTo&&(null==n.updateLineNumbers||n.updateLineNumbers>e)&&(n.updateLineNumbers=e),t.curOp.viewChanged=!0,e>=n.viewTo)$n&&Di(t.doc,e)<n.viewTo&&we(t);else if(i<=n.viewFrom)$n&&Hi(t.doc,i+r)>n.viewFrom?we(t):(n.viewFrom+=r,n.viewTo+=r);else if(e<=n.viewFrom&&i>=n.viewTo)we(t);else if(e<=n.viewFrom){(o=xe(t,i,i+r,1))?(n.view=n.view.slice(o.index),n.viewFrom=o.lineN,n.viewTo+=r):we(t)}else if(i>=n.viewTo){var o;(o=xe(t,e,e,-1))?(n.view=n.view.slice(0,o.index),n.viewTo=o.lineN):we(t)}else{var s=xe(t,e,e,-1),a=xe(t,i,i+r,1);s&&a?(n.view=n.view.slice(0,s.index).concat(ve(t,s.lineN,a.lineN)).concat(n.view.slice(a.index)),n.viewTo+=r):we(t)}var l=n.externalMeasured;l&&(i<l.lineN?l.lineN+=r:e<l.lineN+l.size&&(n.externalMeasured=null))}function ye(t,e,i){t.curOp.viewChanged=!0;var r=t.display,n=t.display.externalMeasured;if(n&&e>=n.lineN&&e<n.lineN+n.size&&(r.externalMeasured=null),!(e<r.viewFrom||e>=r.viewTo)){var o=r.view[ke(t,e)];if(null!=o.node){var s=o.changes||(o.changes=[]);-1==Pr(s,i)&&s.push(i)}}}function we(t){t.display.viewFrom=t.display.viewTo=t.doc.first,t.display.view=[],t.display.viewOffset=0}function ke(t,e){if(e>=t.display.viewTo)return null;if(0>(e-=t.display.viewFrom))return null;for(var i=t.display.view,r=0;r<i.length;r++)if(0>(e-=i[r].size))return r}function xe(t,e,i,r){var n,o=ke(t,e),s=t.display.view;if(!$n||i==t.doc.first+t.doc.size)return{index:o,lineN:i};for(var a=0,l=t.display.viewFrom;o>a;a++)l+=s[a].size;if(l!=e){if(r>0){if(o==s.length-1)return null;n=l+s[o].size-e,o++}else n=l-e;e+=n,i+=n}for(;Di(t.doc,i)!=i;){if(o==(0>r?0:s.length-1))return null;i+=r*s[o-(0>r?1:0)].size,o+=r}return{index:o,lineN:i}}function Ce(t){for(var e=t.display.view,i=0,r=0;r<e.length;r++){var n=e[r];n.hidden||n.node&&!n.changes||++i}return i}function Te(t){var e=t.display;(e.lastWrapHeight!=e.wrapper.clientHeight||e.lastWrapWidth!=e.wrapper.clientWidth)&&(e.cachedCharWidth=e.cachedTextHeight=e.cachedPaddingH=null,e.scrollbarsClipped=!1,t.setSize())}function Se(t,e){for(var i=Lr(e);i!=t.wrapper;i=i.parentNode)if(!i||1==i.nodeType&&"true"==i.getAttribute("cm-ignore-events")||i.parentNode==t.sizer&&i!=t.mover)return!0}function Le(t,e,i,r){var n=t.display;if(!i&&"true"==Lr(e).getAttribute("cm-not-content"))return null;var o,s,a=n.lineSpace.getBoundingClientRect();try{o=e.clientX-a.left,s=e.clientY-a.top}catch(e){return null}var l,c=ee(t,o,s);if(r&&1==c.xRel&&(l=sr(t.doc,c.line).text).length==c.ch){var d=Wo(l,l.length,t.options.tabSize)-l.length;c=Bn(c.line,Math.max(0,Math.round((o-It(t.display).left)/ne(t.display))-d))}return c}function Ae(t){var e=this,i=e.display;if(!(i.activeTouch&&i.input.supportsTouch()||Or(e,t))){if(i.shift=t.shiftKey,Se(i,t))return void(kn||(i.scroller.draggable=!1,setTimeout(function(){i.scroller.draggable=!0},100)));if(!Ne(e,t)){var r=Le(e,t);switch(window.focus(),Ar(t)){case 1:e.state.selectingText?e.state.selectingText(t):r?function(t,e,i){yn?setTimeout(Kr(G,t),0):t.curOp.focus=Yr();var r,n=+new Date;Un&&Un.time>n-400&&0==Pn(Un.pos,i)?r="triple":zn&&zn.time>n-400&&0==Pn(zn.pos,i)?(r="double",Un={time:n,pos:i}):(r="single",zn={time:n,pos:i});var o,s=t.doc.sel,a=Mn?e.metaKey:e.ctrlKey;t.options.dragDrop&&ts&&!j(t)&&"single"==r&&(o=s.contains(i))>-1&&(Pn((o=s.ranges[o]).from(),i)<0||i.xRel>0)&&(Pn(o.to(),i)>0||i.xRel<0)?function(t,e,i,r){var n=t.display,o=+new Date,s=pe(t,function(a){kn&&(n.scroller.draggable=!1),t.state.draggingText=!1,Do(document,"mouseup",s),Do(n.scroller,"drop",s),Math.abs(e.clientX-a.clientX)+Math.abs(e.clientY-a.clientY)<10&&(Ao(a),!r&&+new Date-200<o&&pt(t.doc,i),kn||yn&&9==wn?setTimeout(function(){document.body.focus(),n.input.focus()},20):n.input.focus())});kn&&(n.scroller.draggable=!0),t.state.draggingText=s,n.scroller.dragDrop&&n.scroller.dragDrop(),Mo(document,"mouseup",s),Mo(n.scroller,"drop",s)}(t,e,i,a):function(t,e,i,r,n){function o(e){if(0!=Pn(m,e))if(m=e,"rect"==r){for(var n=[],o=t.options.tabSize,s=Wo(sr(c,i.line).text,i.ch,o),a=Wo(sr(c,e.line).text,e.ch,o),l=Math.min(s,a),p=Math.max(s,a),f=Math.min(i.line,e.line),g=Math.min(t.lastLine(),Math.max(i.line,e.line));g>=f;f++){var v=sr(c,f).text,b=zo(v,l,o);l==p?n.push(new st(Bn(f,b),Bn(f,b))):v.length>b&&n.push(new st(Bn(f,b),Bn(f,zo(v,p,o))))}n.length||n.push(new st(i,i)),bt(c,at(u.ranges.slice(0,h).concat(n),h),{origin:"*mouse",scroll:!1}),t.scrollIntoView(e)}else{var y=d,w=y.anchor,k=e;if("single"!=r){if("double"==r)var x=t.findWordAt(e);else var x=new st(Bn(e.line,0),dt(c,Bn(e.line+1,0)));Pn(x.anchor,w)>0?(k=x.head,w=q(y.from(),x.anchor)):(k=x.anchor,w=K(y.to(),x.head))}var n=u.ranges.slice(0);n[h]=new st(dt(c,w),k),bt(c,at(n,h),Po)}}function s(e){var i=++y,n=Le(t,e,!0,"rect"==r);if(n)if(0!=Pn(n,m)){t.curOp.focus=Yr(),o(n);var a=b(l,c);(n.line>=a.to||n.line<a.from)&&setTimeout(pe(t,function(){y==i&&s(e)}),150)}else{var d=e.clientY<v.top?-20:e.clientY>v.bottom?20:0;d&&setTimeout(pe(t,function(){y==i&&(l.scroller.scrollTop+=d,s(e))}),50)}}function a(e){t.state.selectingText=!1,y=1/0,Ao(e),l.input.focus(),Do(document,"mousemove",w),Do(document,"mouseup",k),c.history.lastSelOrigin=null}var l=t.display,c=t.doc;Ao(e);var d,h,u=c.sel,p=u.ranges;if(n&&!e.shiftKey?(h=c.sel.contains(i),d=h>-1?p[h]:new st(i,i)):(d=c.sel.primary(),h=c.sel.primIndex),e.altKey)r="rect",n||(d=new st(i,i)),i=Le(t,e,!0,!0),h=-1;else if("double"==r){var f=t.findWordAt(i);d=t.display.shift||c.extend?ut(c,d,f.anchor,f.head):f}else if("triple"==r){var g=new st(Bn(i.line,0),dt(c,Bn(i.line+1,0)));d=t.display.shift||c.extend?ut(c,d,g.anchor,g.head):g}else d=ut(c,d,i);n?-1==h?(h=p.length,bt(c,at(p.concat([d]),h),{scroll:!1,origin:"*mouse"})):p.length>1&&p[h].empty()&&"single"==r&&!e.shiftKey?(bt(c,at(p.slice(0,h).concat(p.slice(h+1)),0),{scroll:!1,origin:"*mouse"}),u=c.sel):gt(c,h,d,Po):(h=0,bt(c,new ot([d],0),Po),u=c.sel);var m=i,v=l.wrapper.getBoundingClientRect(),y=0,w=pe(t,function(t){Ar(t)?s(t):a(t)}),k=pe(t,a);t.state.selectingText=k,Mo(document,"mousemove",w),Mo(document,"mouseup",k)}(t,e,i,r,a)}(e,t,r):Lr(t)==i.scroller&&Ao(t);break;case 2:kn&&(e.state.lastMiddleDown=+new Date),r&&pt(e.doc,r),setTimeout(function(){i.input.focus()},20),Ao(t);break;case 3:In?Ke(e,t):function(t){t.state.delayingBlurEvent=!0,setTimeout(function(){t.state.delayingBlurEvent&&(t.state.delayingBlurEvent=!1,Ue(t))},100)}(e)}}}}function Ee(t,e,i,r,n){try{var o=e.clientX,s=e.clientY}catch(e){return!1}if(o>=Math.floor(t.display.gutters.getBoundingClientRect().right))return!1;r&&Ao(e);var a=t.display,l=a.lineDiv.getBoundingClientRect();if(s>l.bottom||!Hr(t,i))return Sr(e);s-=l.top-a.viewOffset;for(var c=0;c<t.options.gutters.length;++c){var d=a.gutters.childNodes[c];if(d&&d.getBoundingClientRect().right>=o)return n(t,i,t,hr(t.doc,s),t.options.gutters[c],e),Sr(e)}}function Ne(t,e){return Ee(t,e,"gutterClick",!0,Nr)}function Me(t){var e=this;if(Oe(e),!Or(e,t)&&!Se(e.display,t)){Ao(t),yn&&(jn=+new Date);var i=Le(e,t,!0),r=t.dataTransfer.files;if(i&&!j(e))if(r&&r.length&&window.FileReader&&window.File)for(var n=r.length,o=Array(n),s=0,a=function(t,r){if(!e.options.allowDropFileTypes||-1!=Pr(e.options.allowDropFileTypes,t.type)){var a=new FileReader;a.onload=pe(e,function(){var t=a.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(t)&&(t=""),o[r]=t,++s==n){var l={from:i=dt(e.doc,i),to:i,text:e.doc.splitLines(o.join(e.doc.lineSeparator())),origin:"paste"};Ve(e.doc,l),vt(e.doc,lt(i,Zn(l)))}}),a.readAsText(t)}},l=0;n>l;++l)a(r[l],l);else{if(e.state.draggingText&&e.doc.sel.contains(i)>-1)return e.state.draggingText(t),void setTimeout(function(){e.display.input.focus()},20);try{if(o=t.dataTransfer.getData("Text")){if(e.state.draggingText&&!(Mn?t.altKey:t.ctrlKey))var c=e.listSelections();if(yt(e.doc,lt(i,i)),c)for(l=0;l<c.length;++l)ti(e.doc,"",c[l].anchor,c[l].head,"drag");e.replaceSelection(o,"around","paste"),e.display.input.focus()}}catch(t){}}}}function Oe(t){t.display.dragCursor&&(t.display.lineSpace.removeChild(t.display.dragCursor),t.display.dragCursor=null)}function De(t,e){Math.abs(t.doc.scrollTop-e)<2||(t.doc.scrollTop=e,mn||L(t,{top:e}),t.display.scroller.scrollTop!=e&&(t.display.scroller.scrollTop=e),t.display.scrollbars.setScrollTop(e),mn&&L(t),Nt(t,100))}function He(t,e,i){(i?e==t.doc.scrollLeft:Math.abs(t.doc.scrollLeft-e)<2)||(e=Math.min(e,t.display.scroller.scrollWidth-t.display.scroller.clientWidth),t.doc.scrollLeft=e,y(t),t.display.scroller.scrollLeft!=e&&(t.display.scroller.scrollLeft=e),t.display.scrollbars.setScrollLeft(e))}function Ie(t,e){var i=Xn(e),r=i.x,n=i.y,o=t.display,s=o.scroller,a=s.scrollWidth>s.clientWidth,l=s.scrollHeight>s.clientHeight;if(r&&a||n&&l){if(n&&Mn&&kn)t:for(var c=e.target,d=o.view;c!=s;c=c.parentNode)for(var h=0;h<d.length;h++)if(d[h].node==c){t.display.currentWheelTarget=c;break t}if(r&&!mn&&!Tn&&null!=Vn)return n&&l&&De(t,Math.max(0,Math.min(s.scrollTop+n*Vn,s.scrollHeight-s.clientHeight))),He(t,Math.max(0,Math.min(s.scrollLeft+r*Vn,s.scrollWidth-s.clientWidth))),(!n||n&&l)&&Ao(e),void(o.wheelStartX=null);if(n&&null!=Vn){var u=n*Vn,p=t.doc.scrollTop,f=p+o.wrapper.clientHeight;0>u?p=Math.max(0,p+u-50):f=Math.min(t.doc.height,f+u+50),L(t,{top:p,bottom:f})}20>_n&&(null==o.wheelStartX?(o.wheelStartX=s.scrollLeft,o.wheelStartY=s.scrollTop,o.wheelDX=r,o.wheelDY=n,setTimeout(function(){if(null!=o.wheelStartX){var t=s.scrollLeft-o.wheelStartX,e=s.scrollTop-o.wheelStartY,i=e&&o.wheelDY&&e/o.wheelDY||t&&o.wheelDX&&t/o.wheelDX;o.wheelStartX=o.wheelStartY=null,i&&(Vn=(Vn*_n+i)/(_n+1),++_n)}},200)):(o.wheelDX+=r,o.wheelDY+=n))}}function Re(t,e,i){if("string"==typeof e&&!(e=co[e]))return!1;t.display.input.ensurePolled();var r=t.display.shift,n=!1;try{j(t)&&(t.state.suppressEdits=!0),i&&(t.display.shift=!1),n=e(t)!=$o}finally{t.display.shift=r,t.state.suppressEdits=!1}return n}function $e(t,e,i,r){var n=t.state.keySeq;if(n){if(po(e))return"handled";Yn.set(50,function(){t.state.keySeq==n&&(t.state.keySeq=null,t.display.input.reset())}),e=n+" "+e}var o=function(t,e,i){for(var r=0;r<t.state.keyMaps.length;r++){var n=uo(e,t.state.keyMaps[r],i,t);if(n)return n}return t.options.extraKeys&&uo(e,t.options.extraKeys,i,t)||uo(e,t.options.keyMap,i,t)}(t,e,r);return"multi"==o&&(t.state.keySeq=e),"handled"==o&&Nr(t,"keyHandled",t,e,i),("handled"==o||"multi"==o)&&(Ao(i),Et(t)),n&&!o&&/\'$/.test(e)?(Ao(i),!0):!!o}function Be(t,e){var i=fo(e,!0);return!!i&&(e.shiftKey&&!t.state.keySeq?$e(t,"Shift-"+i,e,function(e){return Re(t,e,!0)})||$e(t,i,e,function(e){return("string"==typeof e?/^go[A-Z]/.test(e):e.motion)?Re(t,e):void 0}):$e(t,i,e,function(e){return Re(t,e)}))}function Pe(t){var e=this;if(e.curOp.focus=Yr(),!Or(e,t)){yn&&11>wn&&27==t.keyCode&&(t.returnValue=!1);var i=t.keyCode;e.display.shift=16==i||t.shiftKey;var r=Be(e,t);Tn&&(Qn=r?i:null,!r&&88==i&&!rs&&(Mn?t.metaKey:t.ctrlKey)&&e.replaceSelection("",null,"cut")),18!=i||/\bCodeMirror-crosshair\b/.test(e.display.lineDiv.className)||function(t){function e(t){18!=t.keyCode&&t.altKey||(Qo(i,"CodeMirror-crosshair"),Do(document,"keyup",e),Do(document,"mouseover",e))}var i=t.display.lineDiv;Zo(i,"CodeMirror-crosshair"),Mo(document,"keyup",e),Mo(document,"mouseover",e)}(e)}}function Fe(t){16==t.keyCode&&(this.doc.sel.shift=!1),Or(this,t)}function We(t){var e=this;if(!(Se(e.display,t)||Or(e,t)||t.ctrlKey&&!t.altKey||Mn&&t.metaKey)){var i=t.keyCode,r=t.charCode;if(Tn&&i==Qn)return Qn=null,void Ao(t);if(!Tn||t.which&&!(t.which<10)||!Be(e,t))(function(t,e,i){return $e(t,"'"+i+"'",e,function(e){return Re(t,e,!0)})})(e,t,String.fromCharCode(null==r?i:r))||e.display.input.onKeyPress(t)}}function ze(t){t.state.delayingBlurEvent&&(t.state.delayingBlurEvent=!1),"nocursor"!=t.options.readOnly&&(t.state.focused||(Ho(t,"focus",t),t.state.focused=!0,Zo(t.display.wrapper,"CodeMirror-focused"),t.curOp||t.display.selForContextMenu==t.doc.sel||(t.display.input.reset(),kn&&setTimeout(function(){t.display.input.reset(!0)},20)),t.display.input.receivedFocus()),Et(t))}function Ue(t){t.state.delayingBlurEvent||(t.state.focused&&(Ho(t,"blur",t),t.state.focused=!1,Qo(t.display.wrapper,"CodeMirror-focused")),clearInterval(t.display.blinker),setTimeout(function(){t.state.focused||(t.display.shift=!1)},150))}function Ke(t,e){Se(t.display,e)||function(t,e){return!!Hr(t,"gutterContextMenu")&&Ee(t,e,"gutterContextMenu",!1,Ho)}(t,e)||Or(t,e,"contextmenu")||t.display.input.onContextMenu(e)}function qe(t,e){if(Pn(t,e.from)<0)return t;if(Pn(t,e.to)<=0)return Zn(e);var i=t.line+e.text.length-(e.to.line-e.from.line)-1,r=t.ch;return t.line==e.to.line&&(r+=Zn(e).ch-e.to.ch),Bn(i,r)}function Ge(t,e){for(var i=[],r=0;r<t.sel.ranges.length;r++){var n=t.sel.ranges[r];i.push(new st(qe(n.anchor,e),qe(n.head,e)))}return at(i,t.sel.primIndex)}function je(t,e,i){return t.line==e.line?Bn(i.line,t.ch-e.ch+i.ch):Bn(i.line+(t.line-e.line),t.ch)}function _e(t,e,i){var r={canceled:!1,from:e.from,to:e.to,text:e.text,origin:e.origin,cancel:function(){this.canceled=!0}};return i&&(r.update=function(e,i,r,n){e&&(this.from=dt(t,e)),i&&(this.to=dt(t,i)),r&&(this.text=r),void 0!==n&&(this.origin=n)}),Ho(t,"beforeChange",t,r),t.cm&&Ho(t.cm,"beforeChange",t.cm,r),r.canceled?null:{from:r.from,to:r.to,text:r.text,origin:r.origin}}function Ve(t,e,i){if(t.cm){if(!t.cm.curOp)return pe(t.cm,Ve)(t,e,i);if(t.cm.state.suppressEdits)return}if(!(Hr(t,"beforeChange")||t.cm&&Hr(t.cm,"beforeChange"))||(e=_e(t,e,!0))){var r=Rn&&!i&&function(t,e,i){var r=null;if(t.iter(e.line,i.line+1,function(t){if(t.markedSpans)for(var e=0;e<t.markedSpans.length;++e){var i=t.markedSpans[e].marker;!i.readOnly||r&&-1!=Pr(r,i)||(r||(r=[])).push(i)}}),!r)return null;for(var n=[{from:e,to:i}],o=0;o<r.length;++o)for(var s=r[o],a=s.find(0),l=0;l<n.length;++l){var c=n[l];if(!(Pn(c.to,a.from)<0||Pn(c.from,a.to)>0)){var d=[l,1],h=Pn(c.from,a.from),u=Pn(c.to,a.to);(0>h||!s.inclusiveLeft&&!h)&&d.push({from:c.from,to:a.from}),(u>0||!s.inclusiveRight&&!u)&&d.push({from:a.to,to:c.to}),n.splice.apply(n,d),l+=d.length-1}}return n}(t,e.from,e.to);if(r)for(var n=r.length-1;n>=0;--n)Xe(t,{from:r[n].from,to:r[n].to,text:n?[""]:e.text});else Xe(t,e)}}function Xe(t,e){if(1!=e.text.length||""!=e.text[0]||0!=Pn(e.from,e.to)){var i=Ge(t,e);vr(t,e,i,t.cm?t.cm.curOp.id:NaN),Ze(t,e,i,yi(t,e));var r=[];nr(t,function(t,i){i||-1!=Pr(r,t.history)||(Tr(t.history,e),r.push(t.history)),Ze(t,e,null,yi(t,e))})}}function Ye(t,e,i){if(!t.cm||!t.cm.state.suppressEdits){for(var r,n=t.history,o=t.sel,s="undo"==e?n.done:n.undone,a="undo"==e?n.undone:n.done,l=0;l<s.length&&(r=s[l],i?!r.ranges||r.equals(t.sel):r.ranges);l++);if(l!=s.length){for(n.lastOrigin=n.lastSelOrigin=null;(r=s.pop()).ranges;){if(br(r,a),i&&!r.equals(t.sel))return void bt(t,r,{clearRedo:!1});o=r}var c=[];br(o,a),a.push({changes:c,generation:n.generation}),n.generation=r.generation||++n.maxGeneration;var d=Hr(t,"beforeChange")||t.cm&&Hr(t.cm,"beforeChange");for(l=r.changes.length-1;l>=0;--l){var h=r.changes[l];if(h.origin=e,d&&!_e(t,h,!1))return void(s.length=0);c.push(gr(t,h));var u=l?Ge(t,h):Br(s);Ze(t,h,u,ki(t,h)),!l&&t.cm&&t.cm.scrollIntoView({from:h.from,to:Zn(h)});var p=[];nr(t,function(t,e){e||-1!=Pr(p,t.history)||(Tr(t.history,h),p.push(t.history)),Ze(t,h,null,ki(t,h))})}}}}function Qe(t,e){if(0!=e&&(t.first+=e,t.sel=new ot(Fr(t.sel.ranges,function(t){return new st(Bn(t.anchor.line+e,t.anchor.ch),Bn(t.head.line+e,t.head.ch))}),t.sel.primIndex),t.cm)){be(t.cm,t.first,t.first-e,e);for(var i=t.cm.display,r=i.viewFrom;r<i.viewTo;r++)ye(t.cm,r,"gutter")}}function Ze(t,e,i,r){if(t.cm&&!t.cm.curOp)return pe(t.cm,Ze)(t,e,i,r);if(e.to.line<t.first)Qe(t,e.text.length-1-(e.to.line-e.from.line));else if(!(e.from.line>t.lastLine())){if(e.from.line<t.first){var n=e.text.length-1-(t.first-e.from.line);Qe(t,n),e={from:Bn(t.first,0),to:Bn(e.to.line+n,e.to.ch),text:[Br(e.text)],origin:e.origin}}var o=t.lastLine();e.to.line>o&&(e={from:e.from,to:Bn(o,sr(t,o).text.length),text:[e.text[0]],origin:e.origin}),e.removed=ar(t,e.from,e.to),i||(i=Ge(t,e)),t.cm?Je(t.cm,e,r):er(t,e,r),yt(t,i,Bo)}}function Je(t,e,i){var n=t.doc,o=t.display,s=e.from,a=e.to,l=!1,d=s.line;t.options.lineWrapping||(d=dr(Oi(sr(n,s.line))),n.iter(d,a.line+1,function(t){return t==o.maxLine?(l=!0,!0):void 0})),n.sel.contains(e.from,e.to)>-1&&Dr(t),er(n,e,i,r(t)),t.options.lineWrapping||(n.iter(d,s.line+e.text.length,function(t){var e=c(t);e>o.maxLineLength&&(o.maxLine=t,o.maxLineLength=e,o.maxLineChanged=!0,l=!1)}),l&&(t.curOp.updateMaxLine=!0)),n.frontier=Math.min(n.frontier,s.line),Nt(t,400);var h=e.text.length-(a.line-s.line)-1;e.full?be(t):s.line!=a.line||1!=e.text.length||tr(t.doc,e)?be(t,s.line,a.line+1,h):ye(t,s.line,"text");var u=Hr(t,"changes"),p=Hr(t,"change");if(p||u){var f={from:s,to:a,text:e.text,removed:e.removed,origin:e.origin};p&&Nr(t,"change",t,f),u&&(t.curOp.changeObjs||(t.curOp.changeObjs=[])).push(f)}t.display.selForContextMenu=null}function ti(t,e,i,r,n){if(r||(r=i),Pn(r,i)<0){var o=r;r=i,i=o}"string"==typeof e&&(e=t.splitLines(e)),Ve(t,{from:i,to:r,text:e,origin:n})}function ei(t,e,i,r,n){var o=t.display,s=re(t.display);0>i&&(i=0);var a=t.curOp&&null!=t.curOp.scrollTop?t.curOp.scrollTop:o.scroller.scrollTop,l=Bt(t),c={};n-i>l&&(n=i+l);var d=t.doc.height+Ht(o),h=s>i,u=n>d-s;if(a>i)c.scrollTop=h?0:i;else if(n>a+l){var p=Math.min(i,(u?d:n)-l);p!=a&&(c.scrollTop=p)}var f=t.curOp&&null!=t.curOp.scrollLeft?t.curOp.scrollLeft:o.scroller.scrollLeft,g=$t(t)-(t.options.fixedGutter?o.gutters.offsetWidth:0),m=r-e>g;return m&&(r=e+g),10>e?c.scrollLeft=0:f>e?c.scrollLeft=Math.max(0,e-(m?0:10)):r>g+f-3&&(c.scrollLeft=r+(m?0:10)-g),c}function ii(t,e,i){(null!=e||null!=i)&&ni(t),null!=e&&(t.curOp.scrollLeft=(null==t.curOp.scrollLeft?t.doc.scrollLeft:t.curOp.scrollLeft)+e),null!=i&&(t.curOp.scrollTop=(null==t.curOp.scrollTop?t.doc.scrollTop:t.curOp.scrollTop)+i)}function ri(t){ni(t);var e=t.getCursor(),i=e,r=e;t.options.lineWrapping||(i=e.ch?Bn(e.line,e.ch-1):e,r=Bn(e.line,e.ch+1)),t.curOp.scrollToPos={from:i,to:r,margin:t.options.cursorScrollMargin,isCursor:!0}}function ni(t){var e=t.curOp.scrollToPos;if(e){t.curOp.scrollToPos=null;var i=Jt(t,e.from),r=Jt(t,e.to),n=ei(t,Math.min(i.left,r.left),Math.min(i.top,r.top)-e.margin,Math.max(i.right,r.right),Math.max(i.bottom,r.bottom)+e.margin);t.scrollTo(n.scrollLeft,n.scrollTop)}}function oi(t,e,i,r){var n,o=t.doc;null==i&&(i="add"),"smart"==i&&(o.mode.indent?n=Ot(t,e):i="prev");var s=t.options.tabSize,a=sr(o,e),l=Wo(a.text,null,s);a.stateAfter&&(a.stateAfter=null);var c,d=a.text.match(/^\s*/)[0];if(r||/\S/.test(a.text)){if("smart"==i&&((c=o.mode.indent(n,a.text.slice(d.length),a.text))==$o||c>150)){if(!r)return;i="prev"}}else c=0,i="not";"prev"==i?c=e>o.first?Wo(sr(o,e-1).text,null,s):0:"add"==i?c=l+t.options.indentUnit:"subtract"==i?c=l-t.options.indentUnit:"number"==typeof i&&(c=l+i),c=Math.max(0,c);var h="",u=0;if(t.options.indentWithTabs)for(var p=Math.floor(c/s);p;--p)u+=s,h+="\t";if(c>u&&(h+=$r(c-u)),h!=d)return ti(o,h,Bn(e,0),Bn(e,d.length),"+input"),a.stateAfter=null,!0;for(p=0;p<o.sel.ranges.length;p++){var f=o.sel.ranges[p];if(f.head.line==e&&f.head.ch<d.length){gt(o,p,new st(u=Bn(e,d.length),u));break}}}function si(t,e,i,r){var n=e,o=e;return"number"==typeof e?o=sr(t,ct(t,e)):n=dr(e),null==n?null:(r(o,n)&&t.cm&&ye(t.cm,n,i),o)}function ai(t,e){for(var i=t.doc.sel.ranges,r=[],n=0;n<i.length;n++){for(var o=e(i[n]);r.length&&Pn(o.from,Br(r).to)<=0;){var s=r.pop();if(Pn(s.from,o.from)<0){o.from=s.from;break}}r.push(o)}ue(t,function(){for(var e=r.length-1;e>=0;e--)ti(t.doc,"",r[e].from,r[e].to,"+delete");ri(t)})}function li(t,e,i,r,n){function o(){var e=a+i;return e<t.first||e>=t.first+t.size?h=!1:(a=e,d=sr(t,e))}function s(t){var e=(n?un:pn)(d,l,i,!0);if(null==e){if(t||!o())return h=!1;l=n?(0>i?sn:on)(d):0>i?d.text.length:0}else l=e;return!0}var a=e.line,l=e.ch,c=i,d=sr(t,a),h=!0;if("char"==r)s();else if("column"==r)s(!0);else if("word"==r||"group"==r)for(var u=null,p="group"==r,f=t.cm&&t.cm.getHelper(e,"wordChars"),g=!0;!(0>i)||s(!g);g=!1){var m=d.text.charAt(l)||"\n",v=qr(m,f)?"w":p&&"\n"==m?"n":!p||/\s/.test(m)?null:"p";if(!p||g||v||(v="s"),u&&u!=v){0>i&&(i=1,s());break}if(v&&(u=v),i>0&&!s(!g))break}var b=Ct(t,Bn(a,l),c,!0);return h||(b.hitSide=!0),b}function ci(t,e,i,r){var n,o=t.doc,s=e.left;if("page"==r){var a=Math.min(t.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);n=e.top+i*(a-(0>i?1.5:.5)*re(t.display))}else"line"==r&&(n=i>0?e.bottom+3:e.top-3);for(;;){var l=ee(t,s,n);if(!l.outside)break;if(0>i?0>=n:n>=o.height){l.hitSide=!0;break}n+=5*i}return l}function di(e,i,r,n){t.defaults[e]=i,r&&(to[e]=n?function(t,e,i){i!=eo&&r(t,e,i)}:r)}function hi(t){for(var e,i,r,n,o=t.split(/-(?!$)/),s=(t=o[o.length-1],0);s<o.length-1;s++){var a=o[s];if(/^(cmd|meta|m)$/i.test(a))n=!0;else if(/^a(lt)?$/i.test(a))e=!0;else if(/^(c|ctrl|control)$/i.test(a))i=!0;else{if(!/^s(hift)$/i.test(a))throw new Error("Unrecognized modifier name: "+a);r=!0}}return e&&(t="Alt-"+t),i&&(t="Ctrl-"+t),n&&(t="Cmd-"+t),r&&(t="Shift-"+t),t}function ui(t){return"string"==typeof t?ho[t]:t}function pi(t,e,i,r,n){if(r&&r.shared)return function(t,e,i,r,n){(r=Ur(r)).shared=!1;var o=[pi(t,e,i,r,n)],s=o[0],a=r.widgetNode;return nr(t,function(t){a&&(r.widgetNode=a.cloneNode(!0)),o.push(pi(t,dt(t,e),dt(t,i),r,n));for(var l=0;l<t.linked.length;++l)if(t.linked[l].isParent)return;s=Br(o)}),new bo(o,s)}(t,e,i,r,n);if(t.cm&&!t.cm.curOp)return pe(t.cm,pi)(t,e,i,r,n);var o=new vo(t,n),s=Pn(e,i);if(r&&Ur(r,o,!1),s>0||0==s&&!1!==o.clearWhenEmpty)return o;if(o.replacedWith&&(o.collapsed=!0,o.widgetNode=_r("span",[o.replacedWith],"CodeMirror-widget"),r.handleMouseEvents||o.widgetNode.setAttribute("cm-ignore-events","true"),r.insertLeft&&(o.widgetNode.insertLeft=!0)),o.collapsed){if(Mi(t,e.line,e,i,o)||e.line!=i.line&&Mi(t,i.line,e,i,o))throw new Error("Inserting collapsed marker partially overlapping an existing one");$n=!0}o.addToHistory&&vr(t,{from:e,to:i,origin:"markText"},t.sel,NaN);var a,l=e.line,c=t.cm;if(t.iter(l,i.line+1,function(t){c&&o.collapsed&&!c.options.lineWrapping&&Oi(t)==c.display.maxLine&&(a=!0),o.collapsed&&l!=e.line&&cr(t,0),function(t,e){t.markedSpans=t.markedSpans?t.markedSpans.concat([e]):[e],e.marker.attachLine(t)}(t,new mi(o,l==e.line?e.ch:null,l==i.line?i.ch:null)),++l}),o.collapsed&&t.iter(e.line,i.line+1,function(e){Ii(t,e)&&cr(e,0)}),o.clearOnEnter&&Mo(o,"beforeCursorEnter",function(){o.clear()}),o.readOnly&&(Rn=!0,(t.history.done.length||t.history.undone.length)&&t.clearHistory()),o.collapsed&&(o.id=++mo,o.atomic=!0),c){if(a&&(c.curOp.updateMaxLine=!0),o.collapsed)be(c,e.line,i.line+1);else if(o.className||o.title||o.startStyle||o.endStyle||o.css)for(var d=e.line;d<=i.line;d++)ye(c,d,"text");o.atomic&&kt(c.doc),Nr(c,"markerAdded",c,o)}return o}function fi(t){return t.findMarks(Bn(t.first,0),t.clipPos(Bn(t.lastLine())),function(t){return t.parent})}function gi(t){for(var e=0;e<t.length;e++){var i=t[e],r=[i.primary.doc];nr(i.primary.doc,function(t){r.push(t)});for(var n=0;n<i.markers.length;n++){var o=i.markers[n];-1==Pr(r,o.doc)&&(o.parent=null,i.markers.splice(n--,1))}}}function mi(t,e,i){this.marker=t,this.from=e,this.to=i}function vi(t,e){if(t)for(var i=0;i<t.length;++i){var r=t[i];if(r.marker==e)return r}}function bi(t,e){for(var i,r=0;r<t.length;++r)t[r]!=e&&(i||(i=[])).push(t[r]);return i}function yi(t,e){if(e.full)return null;var i=ht(t,e.from.line)&&sr(t,e.from.line).markedSpans,r=ht(t,e.to.line)&&sr(t,e.to.line).markedSpans;if(!i&&!r)return null;var n=e.from.ch,o=e.to.ch,s=0==Pn(e.from,e.to),a=function(t,e,i){if(t)for(var r,n=0;n<t.length;++n){var o=t[n],s=o.marker;if(null==o.from||(s.inclusiveLeft?o.from<=e:o.from<e)||o.from==e&&"bookmark"==s.type&&(!i||!o.marker.insertLeft)){var a=null==o.to||(s.inclusiveRight?o.to>=e:o.to>e);(r||(r=[])).push(new mi(s,o.from,a?null:o.to))}}return r}(i,n,s),l=function(t,e,i){if(t)for(var r,n=0;n<t.length;++n){var o=t[n],s=o.marker;if(null==o.to||(s.inclusiveRight?o.to>=e:o.to>e)||o.from==e&&"bookmark"==s.type&&(!i||o.marker.insertLeft)){var a=null==o.from||(s.inclusiveLeft?o.from<=e:o.from<e);(r||(r=[])).push(new mi(s,a?null:o.from-e,null==o.to?null:o.to-e))}}return r}(r,o,s),c=1==e.text.length,d=Br(e.text).length+(c?n:0);if(a)for(var h=0;h<a.length;++h){if(null==(u=a[h]).to)(p=vi(l,u.marker))?c&&(u.to=null==p.to?null:p.to+d):u.to=n}if(l)for(h=0;h<l.length;++h){var u,p;if(null!=(u=l[h]).to&&(u.to+=d),null==u.from)(p=vi(a,u.marker))||(u.from=d,c&&(a||(a=[])).push(u));else u.from+=d,c&&(a||(a=[])).push(u)}a&&(a=wi(a)),l&&l!=a&&(l=wi(l));var f=[a];if(!c){var g,m=e.text.length-2;if(m>0&&a)for(h=0;h<a.length;++h)null==a[h].to&&(g||(g=[])).push(new mi(a[h].marker,null,null));for(h=0;m>h;++h)f.push(g);f.push(l)}return f}function wi(t){for(var e=0;e<t.length;++e){var i=t[e];null!=i.from&&i.from==i.to&&!1!==i.marker.clearWhenEmpty&&t.splice(e--,1)}return t.length?t:null}function ki(t,e){var i=function(t,e){var i=e["spans_"+t.id];if(!i)return null;for(var r=0,n=[];r<e.text.length;++r)n.push(wr(i[r]));return n}(t,e),r=yi(t,e);if(!i)return r;if(!r)return i;for(var n=0;n<i.length;++n){var o=i[n],s=r[n];if(o&&s)t:for(var a=0;a<s.length;++a){for(var l=s[a],c=0;c<o.length;++c)if(o[c].marker==l.marker)continue t;o.push(l)}else s&&(i[n]=s)}return i}function xi(t){var e=t.markedSpans;if(e){for(var i=0;i<e.length;++i)e[i].marker.detachLine(t);t.markedSpans=null}}function Ci(t,e){if(e){for(var i=0;i<e.length;++i)e[i].marker.attachLine(t);t.markedSpans=e}}function Ti(t){return t.inclusiveLeft?-1:0}function Si(t){return t.inclusiveRight?1:0}function Li(t,e){var i=t.lines.length-e.lines.length;if(0!=i)return i;var r=t.find(),n=e.find(),o=Pn(r.from,n.from)||Ti(t)-Ti(e);if(o)return-o;var s=Pn(r.to,n.to)||Si(t)-Si(e);return s||e.id-t.id}function Ai(t,e){var i,r=$n&&t.markedSpans;if(r)for(var n,o=0;o<r.length;++o)(n=r[o]).marker.collapsed&&null==(e?n.from:n.to)&&(!i||Li(i,n.marker)<0)&&(i=n.marker);return i}function Ei(t){return Ai(t,!0)}function Ni(t){return Ai(t,!1)}function Mi(t,e,i,r,n){var o=sr(t,e),s=$n&&o.markedSpans;if(s)for(var a=0;a<s.length;++a){var l=s[a];if(l.marker.collapsed){var c=l.marker.find(0),d=Pn(c.from,i)||Ti(l.marker)-Ti(n),h=Pn(c.to,r)||Si(l.marker)-Si(n);if(!(d>=0&&0>=h||0>=d&&h>=0)&&(0>=d&&(Pn(c.to,i)>0||l.marker.inclusiveRight&&n.inclusiveLeft)||d>=0&&(Pn(c.from,r)<0||l.marker.inclusiveLeft&&n.inclusiveRight)))return!0}}}function Oi(t){for(var e;e=Ei(t);)t=e.find(-1,!0).line;return t}function Di(t,e){var i=sr(t,e),r=Oi(i);return i==r?e:dr(r)}function Hi(t,e){if(e>t.lastLine())return e;var i,r=sr(t,e);if(!Ii(t,r))return e;for(;i=Ni(r);)r=i.find(1,!0).line;return dr(r)+1}function Ii(t,e){var i=$n&&e.markedSpans;if(i)for(var r,n=0;n<i.length;++n)if((r=i[n]).marker.collapsed){if(null==r.from)return!0;if(!r.marker.widgetNode&&0==r.from&&r.marker.inclusiveLeft&&Ri(t,e,r))return!0}}function Ri(t,e,i){if(null==i.to){var r=i.marker.find(1,!0);return Ri(t,r.line,vi(r.line.markedSpans,i.marker))}if(i.marker.inclusiveRight&&i.to==e.text.length)return!0;for(var n,o=0;o<e.markedSpans.length;++o)if((n=e.markedSpans[o]).marker.collapsed&&!n.marker.widgetNode&&n.from==i.to&&(null==n.to||n.to!=i.from)&&(n.marker.inclusiveLeft||i.marker.inclusiveRight)&&Ri(t,e,n))return!0}function $i(t,e,i){ur(e)<(t.curOp&&t.curOp.scrollTop||t.doc.scrollTop)&&ii(t,null,i)}function Bi(t){if(null!=t.height)return t.height;var e=t.doc.cm;if(!e)return 0;if(!Vo(document.body,t.node)){var i="position: relative;";t.coverGutter&&(i+="margin-left: -"+e.display.gutters.offsetWidth+"px;"),t.noHScroll&&(i+="width: "+e.display.wrapper.clientWidth+"px;"),Xr(e.display.measure,_r("div",[t.node],null,i))}return t.height=t.node.offsetHeight}function Pi(t){t.parent=null,xi(t)}function Fi(t,e){if(t)for(;;){var i=t.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!i)break;t=t.slice(0,i.index)+t.slice(i.index+i[0].length);var r=i[1]?"bgClass":"textClass";null==e[r]?e[r]=i[2]:new RegExp("(?:^|s)"+i[2]+"(?:$|s)").test(e[r])||(e[r]+=" "+i[2])}return t}function Wi(e,i){if(e.blankLine)return e.blankLine(i);if(e.innerMode){var r=t.innerMode(e,i);return r.mode.blankLine?r.mode.blankLine(r.state):void 0}}function zi(e,i,r,n){for(var o=0;10>o;o++){n&&(n[0]=t.innerMode(e,r).mode);var s=e.token(i,r);if(i.pos>i.start)return s}throw new Error("Mode "+e.name+" failed to advance stream.")}function Ui(t,e,i,r){function n(t){return{start:h.start,end:h.pos,string:h.current(),type:o||null,state:t?ao(s.mode,d):d}}var o,s=t.doc,a=s.mode;e=dt(s,e);var l,c=sr(s,e.line),d=Ot(t,e.line,i),h=new go(c.text,t.options.tabSize);for(r&&(l=[]);(r||h.pos<e.ch)&&!h.eol();)h.start=h.pos,o=zi(a,h,d),r&&l.push(n(!0));return r?l:n()}function Ki(t,e,i,r,n,o,s){var a=i.flattenSpans;null==a&&(a=t.options.flattenSpans);var l,c=0,d=null,h=new go(e,t.options.tabSize),u=t.options.addModeClass&&[null];for(""==e&&Fi(Wi(i,r),o);!h.eol();){if(h.pos>t.options.maxHighlightLength?(a=!1,s&&ji(t,e,r,h.pos),h.pos=e.length,l=null):l=Fi(zi(i,h,r,u),o),u){var p=u[0].name;p&&(l="m-"+(l?p+" "+l:p))}if(!a||d!=l){for(;c<h.start;)n(c=Math.min(h.start,c+5e4),d);d=l}h.start=h.pos}for(;c<h.pos;){var f=Math.min(h.pos,c+5e4);n(f,d),c=f}}function qi(t,e,i,r){var n=[t.state.modeGen],o={};Ki(t,e.text,t.doc.mode,i,function(t,e){n.push(t,e)},o,r);for(var s=0;s<t.state.overlays.length;++s){var a=t.state.overlays[s],l=1,c=0;Ki(t,e.text,a.mode,!0,function(t,e){for(var i=l;t>c;){var r=n[l];r>t&&n.splice(l,1,t,n[l+1],r),l+=2,c=Math.min(t,r)}if(e)if(a.opaque)n.splice(i,l-i,t,"cm-overlay "+e),l=i+2;else for(;l>i;i+=2){var o=n[i+1];n[i+1]=(o?o+" ":"")+"cm-overlay "+e}},o)}return{styles:n,classes:o.bgClass||o.textClass?o:null}}function Gi(t,e,i){if(!e.styles||e.styles[0]!=t.state.modeGen){var r=Ot(t,dr(e)),n=qi(t,e,e.text.length>t.options.maxHighlightLength?ao(t.doc.mode,r):r);e.stateAfter=r,e.styles=n.styles,n.classes?e.styleClasses=n.classes:e.styleClasses&&(e.styleClasses=null),i===t.doc.frontier&&t.doc.frontier++}return e.styles}function ji(t,e,i,r){var n=t.doc.mode,o=new go(e,t.options.tabSize);for(o.start=o.pos=r||0,""==e&&Wi(n,i);!o.eol();)zi(n,o,i),o.start=o.pos}function _i(t,e){if(!t||/^\s*$/.test(t))return null;var i=e.addModeClass?xo:ko;return i[t]||(i[t]=t.replace(/\S+/g,"cm-$&"))}function Vi(t,e){var i=_r("span",null,null,kn?"padding-right: .1px":null),r={pre:_r("pre",[i],"CodeMirror-line"),content:i,col:0,pos:0,cm:t,splitSpaces:(yn||kn)&&t.getOption("lineWrapping")};e.measure={};for(var n=0;n<=(e.rest?e.rest.length:0);n++){var o,s=n?e.rest[n-1]:e.line;r.pos=0,r.addToken=Xi,en(t.display.measure)&&(o=pr(s))&&(r.addToken=Qi(r.addToken,o)),r.map=[],Ji(s,r,Gi(t,s,e!=t.display.externalMeasured&&dr(s))),s.styleClasses&&(s.styleClasses.bgClass&&(r.bgClass=Zr(s.styleClasses.bgClass,r.bgClass||"")),s.styleClasses.textClass&&(r.textClass=Zr(s.styleClasses.textClass,r.textClass||""))),0==r.map.length&&r.map.push(0,0,r.content.appendChild(tn(t.display.measure))),0==n?(e.measure.map=r.map,e.measure.cache={}):((e.measure.maps||(e.measure.maps=[])).push(r.map),(e.measure.caches||(e.measure.caches=[])).push({}))}return kn&&/\bcm-tab\b/.test(r.content.lastChild.className)&&(r.content.className="cm-tab-wrap-hack"),Ho(t,"renderLine",t,e.line,r.pre),r.pre.className&&(r.textClass=Zr(r.pre.className,r.textClass||"")),r}function Xi(t,e,i,r,n,o,s){if(e){var a=t.splitSpaces?e.replace(/ {3,}/g,Yi):e,l=t.cm.state.specialChars,c=!1;if(l.test(e))for(var d=document.createDocumentFragment(),h=0;;){l.lastIndex=h;var u=l.exec(e),p=u?u.index-h:e.length-h;if(p){var f=document.createTextNode(a.slice(h,h+p));d.appendChild(yn&&9>wn?_r("span",[f]):f),t.map.push(t.pos,t.pos+p,f),t.col+=p,t.pos+=p}if(!u)break;if(h+=p+1,"\t"==u[0]){var g=t.cm.options.tabSize,m=g-t.col%g;(f=d.appendChild(_r("span",$r(m),"cm-tab"))).setAttribute("role","presentation"),f.setAttribute("cm-text","\t"),t.col+=m}else if("\r"==u[0]||"\n"==u[0]){(f=d.appendChild(_r("span","\r"==u[0]?"␍":"␤","cm-invalidchar"))).setAttribute("cm-text",u[0]),t.col+=1}else{(f=t.cm.options.specialCharPlaceholder(u[0])).setAttribute("cm-text",u[0]),d.appendChild(yn&&9>wn?_r("span",[f]):f),t.col+=1}t.map.push(t.pos,t.pos+1,f),t.pos++}else{t.col+=e.length;d=document.createTextNode(a);t.map.push(t.pos,t.pos+e.length,d),yn&&9>wn&&(c=!0),t.pos+=e.length}if(i||r||n||c||s){var v=i||"";r&&(v+=r),n&&(v+=n);var b=_r("span",[d],v,s);return o&&(b.title=o),t.content.appendChild(b)}t.content.appendChild(d)}}function Yi(t){for(var e=" ",i=0;i<t.length-2;++i)e+=i%2?" ":" ";return e+" "}function Qi(t,e){return function(i,r,n,o,s,a,l){n=n?n+" cm-force-border":"cm-force-border";for(var c=i.pos,d=c+r.length;;){for(var h=0;h<e.length;h++){var u=e[h];if(u.to>c&&u.from<=c)break}if(u.to>=d)return t(i,r,n,o,s,a,l);t(i,r.slice(0,u.to-c),n,o,null,a,l),o=null,r=r.slice(u.to-c),c=u.to}}}function Zi(t,e,i,r){var n=!r&&i.widgetNode;n&&t.map.push(t.pos,t.pos+e,n),!r&&t.cm.display.input.needsContentAttribute&&(n||(n=t.content.appendChild(document.createElement("span"))),n.setAttribute("cm-marker",i.id)),n&&(t.cm.display.input.setUneditable(n),t.content.appendChild(n)),t.pos+=e}function Ji(t,e,i){var r=t.markedSpans,n=t.text,o=0;if(r)for(var s,a,l,c,d,h,u,p=n.length,f=0,g=1,m="",v=0;;){if(v==f){l=c=d=h=a="",u=null,v=1/0;for(var b=[],y=0;y<r.length;++y){var w=r[y],k=w.marker;"bookmark"==k.type&&w.from==f&&k.widgetNode?b.push(k):w.from<=f&&(null==w.to||w.to>f||k.collapsed&&w.to==f&&w.from==f)?(null!=w.to&&w.to!=f&&v>w.to&&(v=w.to,c=""),k.className&&(l+=" "+k.className),k.css&&(a=k.css),k.startStyle&&w.from==f&&(d+=" "+k.startStyle),k.endStyle&&w.to==v&&(c+=" "+k.endStyle),k.title&&!h&&(h=k.title),k.collapsed&&(!u||Li(u.marker,k)<0)&&(u=w)):w.from>f&&v>w.from&&(v=w.from)}if(u&&(u.from||0)==f){if(Zi(e,(null==u.to?p+1:u.to)-f,u.marker,null==u.from),null==u.to)return;u.to==f&&(u=!1)}if(!u&&b.length)for(y=0;y<b.length;++y)Zi(e,0,b[y])}if(f>=p)break;for(var x=Math.min(p,v);;){if(m){var C=f+m.length;if(!u){var T=C>x?m.slice(0,x-f):m;e.addToken(e,T,s?s+l:l,d,f+T.length==v?c:"",h,a)}if(C>=x){m=m.slice(x-f),f=x;break}f=C,d=""}m=n.slice(o,o=i[g++]),s=_i(i[g++],e.cm.options)}}else for(g=1;g<i.length;g+=2)e.addToken(e,n.slice(o,o=i[g]),_i(i[g+1],e.cm.options))}function tr(t,e){return 0==e.from.ch&&0==e.to.ch&&""==Br(e.text)&&(!t.cm||t.cm.options.wholeLineUpdateBefore)}function er(t,e,i,r){function n(t){return i?i[t]:null}function o(t,i,n){(function(t,e,i,r){t.text=e,t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null),null!=t.order&&(t.order=null),xi(t),Ci(t,i);var n=r?r(t):1;n!=t.height&&cr(t,n)})(t,i,n,r),Nr(t,"change",t,e)}function s(t,e){for(var i=t,o=[];e>i;++i)o.push(new wo(c[i],n(i),r));return o}var a=e.from,l=e.to,c=e.text,d=sr(t,a.line),h=sr(t,l.line),u=Br(c),p=n(c.length-1),f=l.line-a.line;if(e.full)t.insert(0,s(0,c.length)),t.remove(c.length,t.size-c.length);else if(tr(t,e)){var g=s(0,c.length-1);o(h,h.text,p),f&&t.remove(a.line,f),g.length&&t.insert(a.line,g)}else if(d==h)if(1==c.length)o(d,d.text.slice(0,a.ch)+u+d.text.slice(l.ch),p);else{(g=s(1,c.length-1)).push(new wo(u+d.text.slice(l.ch),p,r)),o(d,d.text.slice(0,a.ch)+c[0],n(0)),t.insert(a.line+1,g)}else if(1==c.length)o(d,d.text.slice(0,a.ch)+c[0]+h.text.slice(l.ch),n(0)),t.remove(a.line+1,f);else{o(d,d.text.slice(0,a.ch)+c[0],n(0)),o(h,u+h.text.slice(l.ch),p);g=s(1,c.length-1);f>1&&t.remove(a.line+1,f-1),t.insert(a.line+1,g)}Nr(t,"change",t,e)}function ir(t){this.lines=t,this.parent=null;for(var e=0,i=0;e<t.length;++e)t[e].parent=this,i+=t[e].height;this.height=i}function rr(t){this.children=t;for(var e=0,i=0,r=0;r<t.length;++r){var n=t[r];e+=n.chunkSize(),i+=n.height,n.parent=this}this.size=e,this.height=i,this.parent=null}function nr(t,e,i){!function t(r,n,o){if(r.linked)for(var s=0;s<r.linked.length;++s){var a=r.linked[s];if(a.doc!=n){var l=o&&a.sharedHist;(!i||l)&&(e(a.doc,l),t(a.doc,r,l))}}}(t,null,!0)}function or(t,i){if(i.cm)throw new Error("This document is already in use.");t.doc=i,i.cm=t,n(t),e(t),t.options.lineWrapping||d(t),t.options.mode=i.modeOption,be(t)}function sr(t,e){if(0>(e-=t.first)||e>=t.size)throw new Error("There is no line "+(e+t.first)+" in the document.");for(var i=t;!i.lines;)for(var r=0;;++r){var n=i.children[r],o=n.chunkSize();if(o>e){i=n;break}e-=o}return i.lines[e]}function ar(t,e,i){var r=[],n=e.line;return t.iter(e.line,i.line+1,function(t){var o=t.text;n==i.line&&(o=o.slice(0,i.ch)),n==e.line&&(o=o.slice(e.ch)),r.push(o),++n}),r}function lr(t,e,i){var r=[];return t.iter(e,i,function(t){r.push(t.text)}),r}function cr(t,e){var i=e-t.height;if(i)for(var r=t;r;r=r.parent)r.height+=i}function dr(t){if(null==t.parent)return null;for(var e=t.parent,i=Pr(e.lines,t),r=e.parent;r;e=r,r=r.parent)for(var n=0;r.children[n]!=e;++n)i+=r.children[n].chunkSize();return i+e.first}function hr(t,e){var i=t.first;t:do{for(var r=0;r<t.children.length;++r){var n=t.children[r],o=n.height;if(o>e){t=n;continue t}e-=o,i+=n.chunkSize()}return i}while(!t.lines);for(r=0;r<t.lines.length;++r){var s=t.lines[r].height;if(s>e)break;e-=s}return i+r}function ur(t){for(var e=0,i=(t=Oi(t)).parent,r=0;r<i.lines.length;++r){var n=i.lines[r];if(n==t)break;e+=n.height}for(var o=i.parent;o;o=(i=o).parent)for(r=0;r<o.children.length;++r){var s=o.children[r];if(s==i)break;e+=s.height}return e}function pr(t){var e=t.order;return null==e&&(e=t.order=as(t.text)),e}function fr(t){this.done=[],this.undone=[],this.undoDepth=1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=t||1}function gr(t,e){var i={from:U(e.from),to:Zn(e),text:ar(t,e.from,e.to)};return yr(t,i,e.from.line,e.to.line+1),nr(t,function(t){yr(t,i,e.from.line,e.to.line+1)},!0),i}function mr(t){for(;t.length;){if(!Br(t).ranges)break;t.pop()}}function vr(t,e,i,r){var n=t.history;n.undone.length=0;var o,s=+new Date;if((n.lastOp==r||n.lastOrigin==e.origin&&e.origin&&("+"==e.origin.charAt(0)&&t.cm&&n.lastModTime>s-t.cm.options.historyEventDelay||"*"==e.origin.charAt(0)))&&(o=function(t,e){return e?(mr(t.done),Br(t.done)):t.done.length&&!Br(t.done).ranges?Br(t.done):t.done.length>1&&!t.done[t.done.length-2].ranges?(t.done.pop(),Br(t.done)):void 0}(n,n.lastOp==r))){var a=Br(o.changes);0==Pn(e.from,e.to)&&0==Pn(e.from,a.to)?a.to=Zn(e):o.changes.push(gr(t,e))}else{var l=Br(n.done);for(l&&l.ranges||br(t.sel,n.done),o={changes:[gr(t,e)],generation:n.generation},n.done.push(o);n.done.length>n.undoDepth;)n.done.shift(),n.done[0].ranges||n.done.shift()}n.done.push(i),n.generation=++n.maxGeneration,n.lastModTime=n.lastSelTime=s,n.lastOp=n.lastSelOp=r,n.lastOrigin=n.lastSelOrigin=e.origin,a||Ho(t,"historyAdded")}function br(t,e){var i=Br(e);i&&i.ranges&&i.equals(t)||e.push(t)}function yr(t,e,i,r){var n=e["spans_"+t.id],o=0;t.iter(Math.max(t.first,i),Math.min(t.first+t.size,r),function(i){i.markedSpans&&((n||(n=e["spans_"+t.id]={}))[o]=i.markedSpans),++o})}function wr(t){if(!t)return null;for(var e,i=0;i<t.length;++i)t[i].marker.explicitlyCleared?e||(e=t.slice(0,i)):e&&e.push(t[i]);return e?e.length?e:null:t}function kr(t,e,i){for(var r=0,n=[];r<t.length;++r){var o=t[r];if(o.ranges)n.push(i?ot.prototype.deepCopy.call(o):o);else{var s=o.changes,a=[];n.push({changes:a});for(var l=0;l<s.length;++l){var c,d=s[l];if(a.push({from:d.from,to:d.to,text:d.text}),e)for(var h in d)(c=h.match(/^spans_(\d+)$/))&&Pr(e,Number(c[1]))>-1&&(Br(a)[h]=d[h],delete d[h])}}}return n}function xr(t,e,i,r){i<t.line?t.line+=r:e<t.line&&(t.line=e,t.ch=0)}function Cr(t,e,i,r){for(var n=0;n<t.length;++n){var o=t[n],s=!0;if(o.ranges){o.copied||((o=t[n]=o.deepCopy()).copied=!0);for(var a=0;a<o.ranges.length;a++)xr(o.ranges[a].anchor,e,i,r),xr(o.ranges[a].head,e,i,r)}else{for(a=0;a<o.changes.length;++a){var l=o.changes[a];if(i<l.from.line)l.from=Bn(l.from.line+r,l.from.ch),l.to=Bn(l.to.line+r,l.to.ch);else if(e<=l.to.line){s=!1;break}}s||(t.splice(0,n+1),n=0)}}}function Tr(t,e){var i=e.from.line,r=e.to.line,n=e.text.length-(r-i)-1;Cr(t.done,i,r,n),Cr(t.undone,i,r,n)}function Sr(t){return null!=t.defaultPrevented?t.defaultPrevented:0==t.returnValue}function Lr(t){return t.target||t.srcElement}function Ar(t){var e=t.which;return null==e&&(1&t.button?e=1:2&t.button?e=3:4&t.button&&(e=2)),Mn&&t.ctrlKey&&1==e&&(e=3),e}function Er(t,e,i){var r=t._handlers&&t._handlers[e];return i?r&&r.length>0?r.slice():Oo:r||Oo}function Nr(t,e){function i(t){return function(){t.apply(null,o)}}var r=Er(t,e,!1);if(r.length){var n,o=Array.prototype.slice.call(arguments,2);qn?n=qn.delayedCallbacks:Io?n=Io:(n=Io=[],setTimeout(Mr,0));for(var s=0;s<r.length;++s)n.push(i(r[s]))}}function Mr(){var t=Io;Io=null;for(var e=0;e<t.length;++e)t[e]()}function Or(t,e,i){return"string"==typeof e&&(e={type:e,preventDefault:function(){this.defaultPrevented=!0}}),Ho(t,i||e.type,t,e),Sr(e)||e.codemirrorIgnore}function Dr(t){var e=t._handlers&&t._handlers.cursorActivity;if(e)for(var i=t.curOp.cursorActivityHandlers||(t.curOp.cursorActivityHandlers=[]),r=0;r<e.length;++r)-1==Pr(i,e[r])&&i.push(e[r])}function Hr(t,e){return Er(t,e).length>0}function Ir(t){t.prototype.on=function(t,e){Mo(this,t,e)},t.prototype.off=function(t,e){Do(this,t,e)}}function Rr(){this.id=null}function $r(t){for(;Uo.length<=t;)Uo.push(Br(Uo)+" ");return Uo[t]}function Br(t){return t[t.length-1]}function Pr(t,e){for(var i=0;i<t.length;++i)if(t[i]==e)return i;return-1}function Fr(t,e){for(var i=[],r=0;r<t.length;r++)i[r]=e(t[r],r);return i}function Wr(){}function zr(t,e){var i;return Object.create?i=Object.create(t):(Wr.prototype=t,i=new Wr),e&&Ur(e,i),i}function Ur(t,e,i){for(var r in e||(e={}),t)!t.hasOwnProperty(r)||!1===i&&e.hasOwnProperty(r)||(e[r]=t[r]);return e}function Kr(t){var e=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,e)}}function qr(t,e){return e?!!(e.source.indexOf("\\w")>-1&&jo(t))||e.test(t):jo(t)}function Gr(t){for(var e in t)if(t.hasOwnProperty(e)&&t[e])return!1;return!0}function jr(t){return t.charCodeAt(0)>=768&&_o.test(t)}function _r(t,e,i,r){var n=document.createElement(t);if(i&&(n.className=i),r&&(n.style.cssText=r),"string"==typeof e)n.appendChild(document.createTextNode(e));else if(e)for(var o=0;o<e.length;++o)n.appendChild(e[o]);return n}function Vr(t){for(var e=t.childNodes.length;e>0;--e)t.removeChild(t.firstChild);return t}function Xr(t,e){return Vr(t).appendChild(e)}function Yr(){for(var t=document.activeElement;t&&t.root&&t.root.activeElement;)t=t.root.activeElement;return t}function Qr(t){return new RegExp("(^|\\s)"+t+"(?:$|\\s)\\s*")}function Zr(t,e){for(var i=t.split(" "),r=0;r<i.length;r++)i[r]&&!Qr(i[r]).test(e)&&(e+=" "+i[r]);return e}function Jr(t){if(document.body.getElementsByClassName)for(var e=document.body.getElementsByClassName("CodeMirror"),i=0;i<e.length;i++){var r=e[i].CodeMirror;r&&t(r)}}function tn(t){if(null==Xo){var e=_r("span","​");Xr(t,_r("span",[e,document.createTextNode("x")])),0!=t.firstChild.offsetHeight&&(Xo=e.offsetWidth<=1&&e.offsetHeight>2&&!(yn&&8>wn))}var i=Xo?_r("span","​"):_r("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");return i.setAttribute("cm-text",""),i}function en(t){if(null!=Yo)return Yo;var e=Xr(t,document.createTextNode("AخA")),i=qo(e,0,1).getBoundingClientRect();if(!i||i.left==i.right)return!1;var r=qo(e,1,2).getBoundingClientRect();return Yo=r.right-i.right<3}function rn(t){return t.level%2?t.to:t.from}function nn(t){return t.level%2?t.from:t.to}function on(t){var e=pr(t);return e?rn(e[0]):0}function sn(t){var e=pr(t);return e?nn(Br(e)):t.text.length}function an(t,e){var i=sr(t.doc,e),r=Oi(i);r!=i&&(e=dr(r));var n=pr(r),o=n?n[0].level%2?sn(r):on(r):0;return Bn(e,o)}function ln(t,e){var i=an(t,e.line),r=sr(t.doc,i.line),n=pr(r);if(!n||0==n[0].level){var o=Math.max(0,r.text.search(/\S/)),s=e.line==i.line&&e.ch<=o&&e.ch;return Bn(i.line,s?0:o)}return i}function cn(t,e,i){var r=t[0].level;return e==r||i!=r&&i>e}function dn(t,e){ss=null;for(var i,r=0;r<t.length;++r){var n=t[r];if(n.from<e&&n.to>e)return r;if(n.from==e||n.to==e){if(null!=i)return cn(t,n.level,t[i].level)?(n.from!=n.to&&(ss=i),r):(n.from!=n.to&&(ss=r),i);i=r}}return i}function hn(t,e,i,r){if(!r)return e+i;do{e+=i}while(e>0&&jr(t.text.charAt(e)));return e}function un(t,e,i,r){var n=pr(t);if(!n)return pn(t,e,i,r);for(var o=dn(n,e),s=n[o],a=hn(t,e,s.level%2?-i:i,r);;){if(a>s.from&&a<s.to)return a;if(a==s.from||a==s.to)return dn(n,a)==o?a:i>0==(s=n[o+=i]).level%2?s.to:s.from;if(!(s=n[o+=i]))return null;a=i>0==s.level%2?hn(t,s.to,-1,r):hn(t,s.from,1,r)}}function pn(t,e,i,r){var n=e+i;if(r)for(;n>0&&jr(t.text.charAt(n));)n+=i;return 0>n||n>t.text.length?null:n}var fn=navigator.userAgent,gn=navigator.platform,mn=/gecko\/\d/i.test(fn),vn=/MSIE \d/.test(fn),bn=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(fn),yn=vn||bn,wn=yn&&(vn?document.documentMode||6:bn[1]),kn=/WebKit\//.test(fn),xn=kn&&/Qt\/\d+\.\d+/.test(fn),Cn=/Chrome\//.test(fn),Tn=/Opera\//.test(fn),Sn=/Apple Computer/.test(navigator.vendor),Ln=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(fn),An=/PhantomJS/.test(fn),En=/AppleWebKit/.test(fn)&&/Mobile\/\w+/.test(fn),Nn=En||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(fn),Mn=En||/Mac/.test(gn),On=/win/i.test(gn),Dn=Tn&&fn.match(/Version\/(\d*\.\d*)/);Dn&&(Dn=Number(Dn[1])),Dn&&Dn>=15&&(Tn=!1,kn=!0);var Hn=Mn&&(xn||Tn&&(null==Dn||12.11>Dn)),In=mn||yn&&wn>=9,Rn=!1,$n=!1;p.prototype=Ur({update:function(t){var e=t.scrollWidth>t.clientWidth+1,i=t.scrollHeight>t.clientHeight+1,r=t.nativeBarWidth;if(i){this.vert.style.display="block",this.vert.style.bottom=e?r+"px":"0";var n=t.viewHeight-(e?r:0);this.vert.firstChild.style.height=Math.max(0,t.scrollHeight-t.clientHeight+n)+"px"}else this.vert.style.display="",this.vert.firstChild.style.height="0";if(e){this.horiz.style.display="block",this.horiz.style.right=i?r+"px":"0",this.horiz.style.left=t.barLeft+"px";var o=t.viewWidth-t.barLeft-(i?r:0);this.horiz.firstChild.style.width=t.scrollWidth-t.clientWidth+o+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedOverlay&&t.clientHeight>0&&(0==r&&this.overlayHack(),this.checkedOverlay=!0),{right:i?r:0,bottom:e?r:0}},setScrollLeft:function(t){this.horiz.scrollLeft!=t&&(this.horiz.scrollLeft=t)},setScrollTop:function(t){this.vert.scrollTop!=t&&(this.vert.scrollTop=t)},overlayHack:function(){var t=Mn&&!Ln?"12px":"18px";this.horiz.style.minHeight=this.vert.style.minWidth=t;var e=this,i=function(t){Lr(t)!=e.vert&&Lr(t)!=e.horiz&&pe(e.cm,Ae)(t)};Mo(this.vert,"mousedown",i),Mo(this.horiz,"mousedown",i)},clear:function(){var t=this.horiz.parentNode;t.removeChild(this.horiz),t.removeChild(this.vert)}},p.prototype),f.prototype=Ur({update:function(){return{bottom:0,right:0}},setScrollLeft:function(){},setScrollTop:function(){},clear:function(){}},f.prototype),t.scrollbarModel={native:p,null:f},C.prototype.signal=function(t,e){Hr(t,e)&&this.events.push(arguments)},C.prototype.finish=function(){for(var t=0;t<this.events.length;t++)Ho.apply(null,this.events[t])};var Bn=t.Pos=function(t,e){return this instanceof Bn?(this.line=t,void(this.ch=e)):new Bn(t,e)},Pn=t.cmpPos=function(t,e){return t.line-e.line||t.ch-e.ch},Fn=null;Z.prototype=Ur({init:function(t){function e(t){if(r.somethingSelected())Fn=r.getSelections(),i.inaccurateSelection&&(i.prevInput="",i.inaccurateSelection=!1,o.value=Fn.join("\n"),Ko(o));else{if(!r.options.lineWiseCopyCut)return;var e=Y(r);Fn=e.text,"cut"==t.type?r.setSelections(e.ranges,null,Bo):(i.prevInput="",o.value=e.text.join("\n"),Ko(o))}"cut"==t.type&&(r.state.cutIncoming=!0)}var i=this,r=this.cm,n=this.wrapper=J(),o=this.textarea=n.firstChild;t.wrapper.insertBefore(n,t.wrapper.firstChild),En&&(o.style.width="0px"),Mo(o,"input",function(){yn&&wn>=9&&i.hasSelection&&(i.hasSelection=null),i.poll()}),Mo(o,"paste",function(t){return!!V(t,r)||(r.state.pasteIncoming=!0,void i.fastPoll())}),Mo(o,"cut",e),Mo(o,"copy",e),Mo(t.scroller,"paste",function(e){Se(t,e)||(r.state.pasteIncoming=!0,i.focus())}),Mo(t.lineSpace,"selectstart",function(e){Se(t,e)||Ao(e)}),Mo(o,"compositionstart",function(){var t=r.getCursor("from");i.composing&&i.composing.range.clear(),i.composing={start:t,range:r.markText(t,r.getCursor("to"),{className:"CodeMirror-composing"})}}),Mo(o,"compositionend",function(){i.composing&&(i.poll(),i.composing.range.clear(),i.composing=null)})},prepareSelection:function(){var t=this.cm,e=t.display,i=t.doc,r=St(t);if(t.options.moveInputWithCursor){var n=Zt(t,i.sel.primary().head,"div"),o=e.wrapper.getBoundingClientRect(),s=e.lineDiv.getBoundingClientRect();r.teTop=Math.max(0,Math.min(e.wrapper.clientHeight-10,n.top+s.top-o.top)),r.teLeft=Math.max(0,Math.min(e.wrapper.clientWidth-10,n.left+s.left-o.left))}return r},showSelection:function(t){var e=this.cm.display;Xr(e.cursorDiv,t.cursors),Xr(e.selectionDiv,t.selection),null!=t.teTop&&(this.wrapper.style.top=t.teTop+"px",this.wrapper.style.left=t.teLeft+"px")},reset:function(t){if(!this.contextMenuPending){var e,i,r=this.cm,n=r.doc;if(r.somethingSelected()){this.prevInput="";var o=n.sel.primary(),s=(e=rs&&(o.to().line-o.from().line>100||(i=r.getSelection()).length>1e3))?"-":i||r.getSelection();this.textarea.value=s,r.state.focused&&Ko(this.textarea),yn&&wn>=9&&(this.hasSelection=s)}else t||(this.prevInput=this.textarea.value="",yn&&wn>=9&&(this.hasSelection=null));this.inaccurateSelection=e}},getField:function(){return this.textarea},supportsTouch:function(){return!1},focus:function(){if("nocursor"!=this.cm.options.readOnly&&(!Nn||Yr()!=this.textarea))try{this.textarea.focus()}catch(t){}},blur:function(){this.textarea.blur()},resetPosition:function(){this.wrapper.style.top=this.wrapper.style.left=0},receivedFocus:function(){this.slowPoll()},slowPoll:function(){var t=this;t.pollingFast||t.polling.set(this.cm.options.pollInterval,function(){t.poll(),t.cm.state.focused&&t.slowPoll()})},fastPoll:function(){var t=!1,e=this;e.pollingFast=!0,e.polling.set(20,function i(){e.poll()||t?(e.pollingFast=!1,e.slowPoll()):(t=!0,e.polling.set(60,i))})},poll:function(){var t=this.cm,e=this.textarea,i=this.prevInput;if(this.contextMenuPending||!t.state.focused||is(e)&&!i&&!this.composing||j(t)||t.options.disableInput||t.state.keySeq)return!1;var r=e.value;if(r==i&&!t.somethingSelected())return!1;if(yn&&wn>=9&&this.hasSelection===r||Mn&&/[\uf700-\uf7ff]/.test(r))return t.display.input.reset(),!1;if(t.doc.sel==t.display.selForContextMenu){var n=r.charCodeAt(0);if(8203!=n||i||(i="​"),8666==n)return this.reset(),this.cm.execCommand("undo")}for(var o=0,s=Math.min(i.length,r.length);s>o&&i.charCodeAt(o)==r.charCodeAt(o);)++o;var a=this;return ue(t,function(){_(t,r.slice(o),i.length-o,null,a.composing?"*compose":null),r.length>1e3||r.indexOf("\n")>-1?e.value=a.prevInput="":a.prevInput=r,a.composing&&(a.composing.range.clear(),a.composing.range=t.markText(a.composing.start,t.getCursor("to"),{className:"CodeMirror-composing"}))}),!0},ensurePolled:function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},onKeyPress:function(){yn&&wn>=9&&(this.hasSelection=null),this.fastPoll()},onContextMenu:function(t){function e(){if(null!=s.selectionStart){var t=n.somethingSelected(),e="​"+(t?s.value:"");s.value="⇚",s.value=e,r.prevInput=t?"":"​",s.selectionStart=1,s.selectionEnd=e.length,o.selForContextMenu=n.doc.sel}}function i(){if(r.contextMenuPending=!1,r.wrapper.style.position="relative",s.style.cssText=c,yn&&9>wn&&o.scrollbars.setScrollTop(o.scroller.scrollTop=l),null!=s.selectionStart){(!yn||yn&&9>wn)&&e();var t=0,i=function(){o.selForContextMenu==n.doc.sel&&0==s.selectionStart&&s.selectionEnd>0&&"​"==r.prevInput?pe(n,co.selectAll)(n):t++<10?o.detectingSelectAll=setTimeout(i,500):o.input.reset()};o.detectingSelectAll=setTimeout(i,200)}}var r=this,n=r.cm,o=n.display,s=r.textarea,a=Le(n,t),l=o.scroller.scrollTop;if(a&&!Tn){n.options.resetSelectionOnContextMenu&&-1==n.doc.sel.contains(a)&&pe(n,bt)(n.doc,lt(a),Bo);var c=s.style.cssText;if(r.wrapper.style.position="absolute",s.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(t.clientY-5)+"px; left: "+(t.clientX-5)+"px; z-index: 1000; background: "+(yn?"rgba(255, 255, 255, .05)":"transparent")+"; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",kn)var d=window.scrollY;if(o.input.focus(),kn&&window.scrollTo(null,d),o.input.reset(),n.somethingSelected()||(s.value=r.prevInput=" "),r.contextMenuPending=!0,o.selForContextMenu=n.doc.sel,clearTimeout(o.detectingSelectAll),yn&&wn>=9&&e(),In){No(t);var h=function(){Do(window,"mouseup",h),setTimeout(i,20)};Mo(window,"mouseup",h)}else setTimeout(i,50)}},readOnlyChanged:function(t){t||this.reset()},setUneditable:Wr,needsContentAttribute:!1},Z.prototype),tt.prototype=Ur({init:function(t){function e(t){if(r.somethingSelected())Fn=r.getSelections(),"cut"==t.type&&r.replaceSelection("",null,"cut");else{if(!r.options.lineWiseCopyCut)return;var e=Y(r);Fn=e.text,"cut"==t.type&&r.operation(function(){r.setSelections(e.ranges,0,Bo),r.replaceSelection("",null,"cut")})}if(t.clipboardData&&!En)t.preventDefault(),t.clipboardData.clearData(),t.clipboardData.setData("text/plain",Fn.join("\n"));else{var i=J(),n=i.firstChild;r.display.lineSpace.insertBefore(i,r.display.lineSpace.firstChild),n.value=Fn.join("\n");var o=document.activeElement;Ko(n),setTimeout(function(){r.display.lineSpace.removeChild(i),o.focus()},50)}}var i=this,r=i.cm,n=i.div=t.lineDiv;Q(n),Mo(n,"paste",function(t){V(t,r)}),Mo(n,"compositionstart",function(t){var e=t.data;if(i.composing={sel:r.doc.sel,data:e,startData:e},e){var n=r.doc.sel.primary(),o=r.getLine(n.head.line).indexOf(e,Math.max(0,n.head.ch-e.length));o>-1&&o<=n.head.ch&&(i.composing.sel=lt(Bn(n.head.line,o),Bn(n.head.line,o+e.length)))}}),Mo(n,"compositionupdate",function(t){i.composing.data=t.data}),Mo(n,"compositionend",function(t){var e=i.composing;e&&(t.data==e.startData||/\u200b/.test(t.data)||(e.data=t.data),setTimeout(function(){e.handled||i.applyComposition(e),i.composing==e&&(i.composing=null)},50))}),Mo(n,"touchstart",function(){i.forceCompositionEnd()}),Mo(n,"input",function(){i.composing||(j(r)||!i.pollContent())&&ue(i.cm,function(){be(r)})}),Mo(n,"copy",e),Mo(n,"cut",e)},prepareSelection:function(){var t=St(this.cm,!1);return t.focus=this.cm.state.focused,t},showSelection:function(t){t&&this.cm.display.view.length&&(t.focus&&this.showPrimarySelection(),this.showMultipleSelections(t))},showPrimarySelection:function(){var t=window.getSelection(),e=this.cm.doc.sel.primary(),i=rt(this.cm,t.anchorNode,t.anchorOffset),r=rt(this.cm,t.focusNode,t.focusOffset);if(!i||i.bad||!r||r.bad||0!=Pn(q(i,r),e.from())||0!=Pn(K(i,r),e.to())){var n=et(this.cm,e.from()),o=et(this.cm,e.to());if(n||o){var s=this.cm.display.view,a=t.rangeCount&&t.getRangeAt(0);if(n){if(!o){var l=s[s.length-1].measure,c=l.maps?l.maps[l.maps.length-1]:l.map;o={node:c[c.length-1],offset:c[c.length-2]-c[c.length-3]}}}else n={node:s[0].measure.map[2],offset:0};try{var d=qo(n.node,n.offset,o.offset,o.node)}catch(t){}d&&(t.removeAllRanges(),t.addRange(d),a&&null==t.anchorNode?t.addRange(a):mn&&this.startGracePeriod()),this.rememberSelection()}}},startGracePeriod:function(){var t=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(function(){t.gracePeriod=!1,t.selectionChanged()&&t.cm.operation(function(){t.cm.curOp.selectionChanged=!0})},20)},showMultipleSelections:function(t){Xr(this.cm.display.cursorDiv,t.cursors),Xr(this.cm.display.selectionDiv,t.selection)},rememberSelection:function(){var t=window.getSelection();this.lastAnchorNode=t.anchorNode,this.lastAnchorOffset=t.anchorOffset,this.lastFocusNode=t.focusNode,this.lastFocusOffset=t.focusOffset},selectionInEditor:function(){var t=window.getSelection();if(!t.rangeCount)return!1;var e=t.getRangeAt(0).commonAncestorContainer;return Vo(this.div,e)},focus:function(){"nocursor"!=this.cm.options.readOnly&&this.div.focus()},blur:function(){this.div.blur()},getField:function(){return this.div},supportsTouch:function(){return!0},receivedFocus:function(){var t=this;this.selectionInEditor()?this.pollSelection():ue(this.cm,function(){t.cm.curOp.selectionChanged=!0}),this.polling.set(this.cm.options.pollInterval,function e(){t.cm.state.focused&&(t.pollSelection(),t.polling.set(t.cm.options.pollInterval,e))})},selectionChanged:function(){var t=window.getSelection();return t.anchorNode!=this.lastAnchorNode||t.anchorOffset!=this.lastAnchorOffset||t.focusNode!=this.lastFocusNode||t.focusOffset!=this.lastFocusOffset},pollSelection:function(){if(!this.composing&&!this.gracePeriod&&this.selectionChanged()){var t=window.getSelection(),e=this.cm;this.rememberSelection();var i=rt(e,t.anchorNode,t.anchorOffset),r=rt(e,t.focusNode,t.focusOffset);i&&r&&ue(e,function(){bt(e.doc,lt(i,r),Bo),(i.bad||r.bad)&&(e.curOp.selectionChanged=!0)})}},pollContent:function(){var t,e=this.cm,i=e.display,r=e.doc.sel.primary(),n=r.from(),o=r.to();if(n.line<i.viewFrom||o.line>i.viewTo-1)return!1;if(n.line==i.viewFrom||0==(t=ke(e,n.line)))var s=dr(i.view[0].line),a=i.view[0].node;else s=dr(i.view[t].line),a=i.view[t-1].node.nextSibling;var l=ke(e,o.line);if(l==i.view.length-1)var c=i.viewTo-1,d=i.lineDiv.lastChild;else c=dr(i.view[l+1].line)-1,d=i.view[l+1].node.previousSibling;for(var h=e.doc.splitLines(function(t,e,i,r,n){function o(e){if(1==e.nodeType){var i=e.getAttribute("cm-text");if(null!=i)return""==i&&(i=e.textContent.replace(/\u200b/g,"")),void(s+=i);var c,d=e.getAttribute("cm-marker");if(d){var h=t.findMarks(Bn(r,0),Bn(n+1,0),function(t){return function(e){return e.id==t}}(+d));return void(h.length&&(c=h[0].find())&&(s+=ar(t.doc,c.from,c.to).join(l)))}if("false"==e.getAttribute("contenteditable"))return;for(var u=0;u<e.childNodes.length;u++)o(e.childNodes[u]);/^(pre|div|p)$/i.test(e.nodeName)&&(a=!0)}else if(3==e.nodeType){var p=e.nodeValue;if(!p)return;a&&(s+=l,a=!1),s+=p}}for(var s="",a=!1,l=t.doc.lineSeparator();o(e),e!=i;)e=e.nextSibling;return s}(e,a,d,s,c)),u=ar(e.doc,Bn(s,0),Bn(c,sr(e.doc,c).text.length));h.length>1&&u.length>1;)if(Br(h)==Br(u))h.pop(),u.pop(),c--;else{if(h[0]!=u[0])break;h.shift(),u.shift(),s++}for(var p=0,f=0,g=h[0],m=u[0],v=Math.min(g.length,m.length);v>p&&g.charCodeAt(p)==m.charCodeAt(p);)++p;for(var b=Br(h),y=Br(u),w=Math.min(b.length-(1==h.length?p:0),y.length-(1==u.length?p:0));w>f&&b.charCodeAt(b.length-f-1)==y.charCodeAt(y.length-f-1);)++f;h[h.length-1]=b.slice(0,b.length-f),h[0]=h[0].slice(p);var k=Bn(s,p),x=Bn(c,u.length?Br(u).length-f:0);return h.length>1||h[0]||Pn(k,x)?(ti(e.doc,h,k,x,"+input"),!0):void 0},ensurePolled:function(){this.forceCompositionEnd()},reset:function(){this.forceCompositionEnd()},forceCompositionEnd:function(){this.composing&&!this.composing.handled&&(this.applyComposition(this.composing),this.composing.handled=!0,this.div.blur(),this.div.focus())},applyComposition:function(t){j(this.cm)?pe(this.cm,be)(this.cm):t.data&&t.data!=t.startData&&pe(this.cm,_)(this.cm,t.data,0,t.sel)},setUneditable:function(t){t.contentEditable="false"},onKeyPress:function(t){t.preventDefault(),j(this.cm)||pe(this.cm,_)(this.cm,String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),0)},readOnlyChanged:function(t){this.div.contentEditable=String("nocursor"!=t)},onContextMenu:Wr,resetPosition:Wr,needsContentAttribute:!0},tt.prototype),t.inputStyles={textarea:Z,contenteditable:tt},ot.prototype={primary:function(){return this.ranges[this.primIndex]},equals:function(t){if(t==this)return!0;if(t.primIndex!=this.primIndex||t.ranges.length!=this.ranges.length)return!1;for(var e=0;e<this.ranges.length;e++){var i=this.ranges[e],r=t.ranges[e];if(0!=Pn(i.anchor,r.anchor)||0!=Pn(i.head,r.head))return!1}return!0},deepCopy:function(){for(var t=[],e=0;e<this.ranges.length;e++)t[e]=new st(U(this.ranges[e].anchor),U(this.ranges[e].head));return new ot(t,this.primIndex)},somethingSelected:function(){for(var t=0;t<this.ranges.length;t++)if(!this.ranges[t].empty())return!0;return!1},contains:function(t,e){e||(e=t);for(var i=0;i<this.ranges.length;i++){var r=this.ranges[i];if(Pn(e,r.from())>=0&&Pn(t,r.to())<=0)return i}return-1}},st.prototype={from:function(){return q(this.anchor,this.head)},to:function(){return K(this.anchor,this.head)},empty:function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch}};var Wn,zn,Un,Kn={left:0,right:0,top:0,bottom:0},qn=null,Gn=0,jn=0,_n=0,Vn=null;yn?Vn=-.53:mn?Vn=15:Cn?Vn=-.7:Sn&&(Vn=-1/3);var Xn=function(t){var e=t.wheelDeltaX,i=t.wheelDeltaY;return null==e&&t.detail&&t.axis==t.HORIZONTAL_AXIS&&(e=t.detail),null==i&&t.detail&&t.axis==t.VERTICAL_AXIS?i=t.detail:null==i&&(i=t.wheelDelta),{x:e,y:i}};t.wheelEventPixels=function(t){var e=Xn(t);return e.x*=Vn,e.y*=Vn,e};var Yn=new Rr,Qn=null,Zn=t.changeEnd=function(t){return t.text?Bn(t.from.line+t.text.length-1,Br(t.text).length+(1==t.text.length?t.from.ch:0)):t.to};t.prototype={constructor:t,focus:function(){window.focus(),this.display.input.focus()},setOption:function(t,e){var i=this.options,r=i[t];(i[t]!=e||"mode"==t)&&(i[t]=e,to.hasOwnProperty(t)&&pe(this,to[t])(this,e,r))},getOption:function(t){return this.options[t]},getDoc:function(){return this.doc},addKeyMap:function(t,e){this.state.keyMaps[e?"push":"unshift"](ui(t))},removeKeyMap:function(t){for(var e=this.state.keyMaps,i=0;i<e.length;++i)if(e[i]==t||e[i].name==t)return e.splice(i,1),!0},addOverlay:fe(function(e,i){var r=e.token?e:t.getMode(this.options,e);if(r.startState)throw new Error("Overlays may not be stateful.");this.state.overlays.push({mode:r,modeSpec:e,opaque:i&&i.opaque}),this.state.modeGen++,be(this)}),removeOverlay:fe(function(t){for(var e=this.state.overlays,i=0;i<e.length;++i){var r=e[i].modeSpec;if(r==t||"string"==typeof t&&r.name==t)return e.splice(i,1),this.state.modeGen++,void be(this)}}),indentLine:fe(function(t,e,i){"string"!=typeof e&&"number"!=typeof e&&(e=null==e?this.options.smartIndent?"smart":"prev":e?"add":"subtract"),ht(this.doc,t)&&oi(this,t,e,i)}),indentSelection:fe(function(t){for(var e=this.doc.sel.ranges,i=-1,r=0;r<e.length;r++){var n=e[r];if(n.empty())n.head.line>i&&(oi(this,n.head.line,t,!0),i=n.head.line,r==this.doc.sel.primIndex&&ri(this));else{var o=n.from(),s=n.to(),a=Math.max(i,o.line);i=Math.min(this.lastLine(),s.line-(s.ch?0:1))+1;for(var l=a;i>l;++l)oi(this,l,t);var c=this.doc.sel.ranges;0==o.ch&&e.length==c.length&&c[r].from().ch>0&&gt(this.doc,r,new st(o,c[r].to()),Bo)}}}),getTokenAt:function(t,e){return Ui(this,t,e)},getLineTokens:function(t,e){return Ui(this,Bn(t),e,!0)},getTokenTypeAt:function(t){t=dt(this.doc,t);var e,i=Gi(this,sr(this.doc,t.line)),r=0,n=(i.length-1)/2,o=t.ch;if(0==o)e=i[2];else for(;;){var s=r+n>>1;if((s?i[2*s-1]:0)>=o)n=s;else{if(!(i[2*s+1]<o)){e=i[2*s+2];break}r=s+1}}var a=e?e.indexOf("cm-overlay "):-1;return 0>a?e:0==a?null:e.slice(0,a-1)},getModeAt:function(e){var i=this.doc.mode;return i.innerMode?t.innerMode(i,this.getTokenAt(e).state).mode:i},getHelper:function(t,e){return this.getHelpers(t,e)[0]},getHelpers:function(t,e){var i=[];if(!so.hasOwnProperty(e))return i;var r=so[e],n=this.getModeAt(t);if("string"==typeof n[e])r[n[e]]&&i.push(r[n[e]]);else if(n[e])for(var o=0;o<n[e].length;o++){var s=r[n[e][o]];s&&i.push(s)}else n.helperType&&r[n.helperType]?i.push(r[n.helperType]):r[n.name]&&i.push(r[n.name]);for(o=0;o<r._global.length;o++){var a=r._global[o];a.pred(n,this)&&-1==Pr(i,a.val)&&i.push(a.val)}return i},getStateAfter:function(t,e){var i=this.doc;return Ot(this,(t=ct(i,null==t?i.first+i.size-1:t))+1,e)},cursorCoords:function(t,e){var i=this.doc.sel.primary();return Zt(this,null==t?i.head:"object"==typeof t?dt(this.doc,t):t?i.from():i.to(),e||"page")},charCoords:function(t,e){return Qt(this,dt(this.doc,t),e||"page")},coordsChar:function(t,e){return ee(this,(t=Yt(this,t,e||"page")).left,t.top)},lineAtHeight:function(t,e){return t=Yt(this,{top:t,left:0},e||"page").top,hr(this.doc,t+this.display.viewOffset)},heightAtLine:function(t,e){var i,r=!1;if("number"==typeof t){var n=this.doc.first+this.doc.size-1;t<this.doc.first?t=this.doc.first:t>n&&(t=n,r=!0),i=sr(this.doc,t)}else i=t;return Xt(this,i,{top:0,left:0},e||"page").top+(r?this.doc.height-ur(i):0)},defaultTextHeight:function(){return re(this.display)},defaultCharWidth:function(){return ne(this.display)},setGutterMarker:fe(function(t,e,i){return si(this.doc,t,"gutter",function(t){var r=t.gutterMarkers||(t.gutterMarkers={});return r[e]=i,!i&&Gr(r)&&(t.gutterMarkers=null),!0})}),clearGutter:fe(function(t){var e=this,i=e.doc,r=i.first;i.iter(function(i){i.gutterMarkers&&i.gutterMarkers[t]&&(i.gutterMarkers[t]=null,ye(e,r,"gutter"),Gr(i.gutterMarkers)&&(i.gutterMarkers=null)),++r})}),lineInfo:function(t){if("number"==typeof t){if(!ht(this.doc,t))return null;var e=t;if(!(t=sr(this.doc,t)))return null}else{if(null==(e=dr(t)))return null}return{line:e,handle:t,text:t.text,gutterMarkers:t.gutterMarkers,textClass:t.textClass,bgClass:t.bgClass,wrapClass:t.wrapClass,widgets:t.widgets}},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(t,e,i,r,n){var o=this.display,s=(t=Zt(this,dt(this.doc,t))).bottom,a=t.left;if(e.style.position="absolute",e.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(e),o.sizer.appendChild(e),"over"==r)s=t.top;else if("above"==r||"near"==r){var l=Math.max(o.wrapper.clientHeight,this.doc.height),c=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);("above"==r||t.bottom+e.offsetHeight>l)&&t.top>e.offsetHeight?s=t.top-e.offsetHeight:t.bottom+e.offsetHeight<=l&&(s=t.bottom),a+e.offsetWidth>c&&(a=c-e.offsetWidth)}e.style.top=s+"px",e.style.left=e.style.right="","right"==n?(a=o.sizer.clientWidth-e.offsetWidth,e.style.right="0px"):("left"==n?a=0:"middle"==n&&(a=(o.sizer.clientWidth-e.offsetWidth)/2),e.style.left=a+"px"),i&&function(t,e,i,r,n){var o=ei(t,e,i,r,n);null!=o.scrollTop&&De(t,o.scrollTop),null!=o.scrollLeft&&He(t,o.scrollLeft)}(this,a,s,a+e.offsetWidth,s+e.offsetHeight)},triggerOnKeyDown:fe(Pe),triggerOnKeyPress:fe(We),triggerOnKeyUp:Fe,execCommand:function(t){return co.hasOwnProperty(t)?co[t].call(null,this):void 0},triggerElectric:fe(function(t){X(this,t)}),findPosH:function(t,e,i,r){var n=1;0>e&&(n=-1,e=-e);for(var o=0,s=dt(this.doc,t);e>o&&!(s=li(this.doc,s,n,i,r)).hitSide;++o);return s},moveH:fe(function(t,e){var i=this;i.extendSelectionsBy(function(r){return i.display.shift||i.doc.extend||r.empty()?li(i.doc,r.head,t,e,i.options.rtlMoveVisually):0>t?r.from():r.to()},Fo)}),deleteH:fe(function(t,e){var i=this.doc.sel,r=this.doc;i.somethingSelected()?r.replaceSelection("",null,"+delete"):ai(this,function(i){var n=li(r,i.head,t,e,!1);return 0>t?{from:n,to:i.head}:{from:i.head,to:n}})}),findPosV:function(t,e,i,r){var n=1,o=r;0>e&&(n=-1,e=-e);for(var s=0,a=dt(this.doc,t);e>s;++s){var l=Zt(this,a,"div");if(null==o?o=l.left:l.left=o,(a=ci(this,l,n,i)).hitSide)break}return a},moveV:fe(function(t,e){var i=this,r=this.doc,n=[],o=!i.display.shift&&!r.extend&&r.sel.somethingSelected();if(r.extendSelectionsBy(function(s){if(o)return 0>t?s.from():s.to();var a=Zt(i,s.head,"div");null!=s.goalColumn&&(a.left=s.goalColumn),n.push(a.left);var l=ci(i,a,t,e);return"page"==e&&s==r.sel.primary()&&ii(i,null,Qt(i,l,"div").top-a.top),l},Fo),n.length)for(var s=0;s<r.sel.ranges.length;s++)r.sel.ranges[s].goalColumn=n[s]}),findWordAt:function(t){var e=sr(this.doc,t.line).text,i=t.ch,r=t.ch;if(e){var n=this.getHelper(t,"wordChars");(t.xRel<0||r==e.length)&&i?--i:++r;for(var o=e.charAt(i),s=qr(o,n)?function(t){return qr(t,n)}:/\s/.test(o)?function(t){return/\s/.test(t)}:function(t){return!/\s/.test(t)&&!qr(t)};i>0&&s(e.charAt(i-1));)--i;for(;r<e.length&&s(e.charAt(r));)++r}return new st(Bn(t.line,i),Bn(t.line,r))},toggleOverwrite:function(t){(null==t||t!=this.state.overwrite)&&((this.state.overwrite=!this.state.overwrite)?Zo(this.display.cursorDiv,"CodeMirror-overwrite"):Qo(this.display.cursorDiv,"CodeMirror-overwrite"),Ho(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==Yr()},scrollTo:fe(function(t,e){(null!=t||null!=e)&&ni(this),null!=t&&(this.curOp.scrollLeft=t),null!=e&&(this.curOp.scrollTop=e)}),getScrollInfo:function(){var t=this.display.scroller;return{left:t.scrollLeft,top:t.scrollTop,height:t.scrollHeight-Rt(this)-this.display.barHeight,width:t.scrollWidth-Rt(this)-this.display.barWidth,clientHeight:Bt(this),clientWidth:$t(this)}},scrollIntoView:fe(function(t,e){if(null==t?(t={from:this.doc.sel.primary().head,to:null},null==e&&(e=this.options.cursorScrollMargin)):"number"==typeof t?t={from:Bn(t,0),to:null}:null==t.from&&(t={from:t,to:null}),t.to||(t.to=t.from),t.margin=e||0,null!=t.from.line)ni(this),this.curOp.scrollToPos=t;else{var i=ei(this,Math.min(t.from.left,t.to.left),Math.min(t.from.top,t.to.top)-t.margin,Math.max(t.from.right,t.to.right),Math.max(t.from.bottom,t.to.bottom)+t.margin);this.scrollTo(i.scrollLeft,i.scrollTop)}}),setSize:fe(function(t,e){function i(t){return"number"==typeof t||/^\d+$/.test(String(t))?t+"px":t}var r=this;null!=t&&(r.display.wrapper.style.width=i(t)),null!=e&&(r.display.wrapper.style.height=i(e)),r.options.lineWrapping&&Gt(this);var n=r.display.viewFrom;r.doc.iter(n,r.display.viewTo,function(t){if(t.widgets)for(var e=0;e<t.widgets.length;e++)if(t.widgets[e].noHScroll){ye(r,n,"widget");break}++n}),r.curOp.forceUpdate=!0,Ho(r,"refresh",this)}),operation:function(t){return ue(this,t)},refresh:fe(function(){var t=this.display.cachedTextHeight;be(this),this.curOp.forceUpdate=!0,jt(this),this.scrollTo(this.doc.scrollLeft,this.doc.scrollTop),l(this),(null==t||Math.abs(t-re(this.display))>.5)&&n(this),Ho(this,"refresh",this)}),swapDoc:fe(function(t){var e=this.doc;return e.cm=null,or(this,t),jt(this),this.display.input.reset(),this.scrollTo(t.scrollLeft,t.scrollTop),this.curOp.forceScroll=!0,Nr(this,"swapDoc",this,e),e}),getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Ir(t);var Jn=t.defaults={},to=t.optionHandlers={},eo=t.Init={toString:function(){return"CodeMirror.Init"}};di("value","",function(t,e){t.setValue(e)},!0),di("mode",null,function(t,i){t.doc.modeOption=i,e(t)},!0),di("indentUnit",2,e,!0),di("indentWithTabs",!1),di("smartIndent",!0),di("tabSize",4,function(t){i(t),jt(t),be(t)},!0),di("lineSeparator",null,function(t,e){if(t.doc.lineSep=e,e){var i=[],r=t.doc.first;t.doc.iter(function(t){for(var n=0;;){var o=t.text.indexOf(e,n);if(-1==o)break;n=o+e.length,i.push(Bn(r,o))}r++});for(var n=i.length-1;n>=0;n--)ti(t.doc,e,i[n],Bn(i[n].line,i[n].ch+e.length))}}),di("specialChars",/[\t\u0000-\u0019\u00ad\u200b-\u200f\u2028\u2029\ufeff]/g,function(e,i,r){e.state.specialChars=new RegExp(i.source+(i.test("\t")?"":"|\t"),"g"),r!=t.Init&&e.refresh()}),di("specialCharPlaceholder",function(t){var e=_r("span","•","cm-invalidchar");return e.title="\\u"+t.charCodeAt(0).toString(16),e.setAttribute("aria-label",e.title),e},function(t){t.refresh()},!0),di("electricChars",!0),di("inputStyle",Nn?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),di("rtlMoveVisually",!On),di("wholeLineUpdateBefore",!0),di("theme","default",function(t){o(t),s(t)},!0),di("keyMap","default",function(e,i,r){var n=ui(i),o=r!=t.Init&&ui(r);o&&o.detach&&o.detach(e,n),n.attach&&n.attach(e,o||null)}),di("extraKeys",null),di("lineWrapping",!1,function(t){t.options.lineWrapping?(Zo(t.display.wrapper,"CodeMirror-wrap"),t.display.sizer.style.minWidth="",t.display.sizerWidth=null):(Qo(t.display.wrapper,"CodeMirror-wrap"),d(t)),n(t),be(t),jt(t),setTimeout(function(){m(t)},100)},!0),di("gutters",[],function(t){h(t.options),s(t)},!0),di("fixedGutter",!0,function(t,e){t.display.gutters.style.left=e?x(t.display)+"px":"0",t.refresh()},!0),di("coverGutterNextToScrollbar",!1,function(t){m(t)},!0),di("scrollbarStyle","native",function(t){g(t),m(t),t.display.scrollbars.setScrollTop(t.doc.scrollTop),t.display.scrollbars.setScrollLeft(t.doc.scrollLeft)},!0),di("lineNumbers",!1,function(t){h(t.options),s(t)},!0),di("firstLineNumber",1,s,!0),di("lineNumberFormatter",function(t){return t},s,!0),di("showCursorWhenSelecting",!1,Tt,!0),di("resetSelectionOnContextMenu",!0),di("lineWiseCopyCut",!0),di("readOnly",!1,function(t,e){"nocursor"==e?(Ue(t),t.display.input.blur(),t.display.disabled=!0):t.display.disabled=!1,t.display.input.readOnlyChanged(e)}),di("disableInput",!1,function(t,e){e||t.display.input.reset()},!0),di("dragDrop",!0,function(e,i,r){if(!i!=!(r&&r!=t.Init)){var n=e.display.dragFunctions,o=i?Mo:Do;o(e.display.scroller,"dragstart",n.start),o(e.display.scroller,"dragenter",n.enter),o(e.display.scroller,"dragover",n.over),o(e.display.scroller,"dragleave",n.leave),o(e.display.scroller,"drop",n.drop)}}),di("allowDropFileTypes",null),di("cursorBlinkRate",530),di("cursorScrollMargin",0),di("cursorHeight",1,Tt,!0),di("singleCursorHeightPerLine",!0,Tt,!0),di("workTime",100),di("workDelay",100),di("flattenSpans",!0,i,!0),di("addModeClass",!1,i,!0),di("pollInterval",100),di("undoDepth",200,function(t,e){t.doc.history.undoDepth=e}),di("historyEventDelay",1250),di("viewportMargin",10,function(t){t.refresh()},!0),di("maxHighlightLength",1e4,i,!0),di("moveInputWithCursor",!0,function(t,e){e||t.display.input.resetPosition()}),di("tabindex",null,function(t,e){t.display.input.getField().tabIndex=e||""}),di("autofocus",null);var io=t.modes={},ro=t.mimeModes={};t.defineMode=function(e,i){t.defaults.mode||"null"==e||(t.defaults.mode=e),arguments.length>2&&(i.dependencies=Array.prototype.slice.call(arguments,2)),io[e]=i},t.defineMIME=function(t,e){ro[t]=e},t.resolveMode=function(e){if("string"==typeof e&&ro.hasOwnProperty(e))e=ro[e];else if(e&&"string"==typeof e.name&&ro.hasOwnProperty(e.name)){var i=ro[e.name];"string"==typeof i&&(i={name:i}),(e=zr(i,e)).name=i.name}else if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return t.resolveMode("application/xml");return"string"==typeof e?{name:e}:e||{name:"null"}},t.getMode=function(e,i){i=t.resolveMode(i);var r=io[i.name];if(!r)return t.getMode(e,"text/plain");var n=r(e,i);if(no.hasOwnProperty(i.name)){var o=no[i.name];for(var s in o)o.hasOwnProperty(s)&&(n.hasOwnProperty(s)&&(n["_"+s]=n[s]),n[s]=o[s])}if(n.name=i.name,i.helperType&&(n.helperType=i.helperType),i.modeProps)for(var s in i.modeProps)n[s]=i.modeProps[s];return n},t.defineMode("null",function(){return{token:function(t){t.skipToEnd()}}}),t.defineMIME("text/plain","null");var no=t.modeExtensions={};t.extendMode=function(t,e){Ur(e,no.hasOwnProperty(t)?no[t]:no[t]={})},t.defineExtension=function(e,i){t.prototype[e]=i},t.defineDocExtension=function(t,e){To.prototype[t]=e},t.defineOption=di;var oo=[];t.defineInitHook=function(t){oo.push(t)};var so=t.helpers={};t.registerHelper=function(e,i,r){so.hasOwnProperty(e)||(so[e]=t[e]={_global:[]}),so[e][i]=r},t.registerGlobalHelper=function(e,i,r,n){t.registerHelper(e,i,n),so[e]._global.push({pred:r,val:n})};var ao=t.copyState=function(t,e){if(!0===e)return e;if(t.copyState)return t.copyState(e);var i={};for(var r in e){var n=e[r];n instanceof Array&&(n=n.concat([])),i[r]=n}return i},lo=t.startState=function(t,e,i){return!t.startState||t.startState(e,i)};t.innerMode=function(t,e){for(;t.innerMode;){var i=t.innerMode(e);if(!i||i.mode==t)break;e=i.state,t=i.mode}return i||{mode:t,state:e}};var co=t.commands={selectAll:function(t){t.setSelection(Bn(t.firstLine(),0),Bn(t.lastLine()),Bo)},singleSelection:function(t){t.setSelection(t.getCursor("anchor"),t.getCursor("head"),Bo)},killLine:function(t){ai(t,function(e){if(e.empty()){var i=sr(t.doc,e.head.line).text.length;return e.head.ch==i&&e.head.line<t.lastLine()?{from:e.head,to:Bn(e.head.line+1,0)}:{from:e.head,to:Bn(e.head.line,i)}}return{from:e.from(),to:e.to()}})},deleteLine:function(t){ai(t,function(e){return{from:Bn(e.from().line,0),to:dt(t.doc,Bn(e.to().line+1,0))}})},delLineLeft:function(t){ai(t,function(t){return{from:Bn(t.from().line,0),to:t.from()}})},delWrappedLineLeft:function(t){ai(t,function(e){var i=t.charCoords(e.head,"div").top+5;return{from:t.coordsChar({left:0,top:i},"div"),to:e.from()}})},delWrappedLineRight:function(t){ai(t,function(e){var i=t.charCoords(e.head,"div").top+5,r=t.coordsChar({left:t.display.lineDiv.offsetWidth+100,top:i},"div");return{from:e.from(),to:r}})},undo:function(t){t.undo()},redo:function(t){t.redo()},undoSelection:function(t){t.undoSelection()},redoSelection:function(t){t.redoSelection()},goDocStart:function(t){t.extendSelection(Bn(t.firstLine(),0))},goDocEnd:function(t){t.extendSelection(Bn(t.lastLine()))},goLineStart:function(t){t.extendSelectionsBy(function(e){return an(t,e.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(t){t.extendSelectionsBy(function(e){return ln(t,e.head)},{origin:"+move",bias:1})},goLineEnd:function(t){t.extendSelectionsBy(function(e){return function(t,e){for(var i,r=sr(t.doc,e);i=Ni(r);)r=i.find(1,!0).line,e=null;var n=pr(r),o=n?n[0].level%2?on(r):sn(r):r.text.length;return Bn(null==e?dr(r):e,o)}(t,e.head.line)},{origin:"+move",bias:-1})},goLineRight:function(t){t.extendSelectionsBy(function(e){var i=t.charCoords(e.head,"div").top+5;return t.coordsChar({left:t.display.lineDiv.offsetWidth+100,top:i},"div")},Fo)},goLineLeft:function(t){t.extendSelectionsBy(function(e){var i=t.charCoords(e.head,"div").top+5;return t.coordsChar({left:0,top:i},"div")},Fo)},goLineLeftSmart:function(t){t.extendSelectionsBy(function(e){var i=t.charCoords(e.head,"div").top+5,r=t.coordsChar({left:0,top:i},"div");return r.ch<t.getLine(r.line).search(/\S/)?ln(t,e.head):r},Fo)},goLineUp:function(t){t.moveV(-1,"line")},goLineDown:function(t){t.moveV(1,"line")},goPageUp:function(t){t.moveV(-1,"page")},goPageDown:function(t){t.moveV(1,"page")},goCharLeft:function(t){t.moveH(-1,"char")},goCharRight:function(t){t.moveH(1,"char")},goColumnLeft:function(t){t.moveH(-1,"column")},goColumnRight:function(t){t.moveH(1,"column")},goWordLeft:function(t){t.moveH(-1,"word")},goGroupRight:function(t){t.moveH(1,"group")},goGroupLeft:function(t){t.moveH(-1,"group")},goWordRight:function(t){t.moveH(1,"word")},delCharBefore:function(t){t.deleteH(-1,"char")},delCharAfter:function(t){t.deleteH(1,"char")},delWordBefore:function(t){t.deleteH(-1,"word")},delWordAfter:function(t){t.deleteH(1,"word")},delGroupBefore:function(t){t.deleteH(-1,"group")},delGroupAfter:function(t){t.deleteH(1,"group")},indentAuto:function(t){t.indentSelection("smart")},indentMore:function(t){t.indentSelection("add")},indentLess:function(t){t.indentSelection("subtract")},insertTab:function(t){t.replaceSelection("\t")},insertSoftTab:function(t){for(var e=[],i=t.listSelections(),r=t.options.tabSize,n=0;n<i.length;n++){var o=i[n].from(),s=Wo(t.getLine(o.line),o.ch,r);e.push(new Array(r-s%r+1).join(" "))}t.replaceSelections(e)},defaultTab:function(t){t.somethingSelected()?t.indentSelection("add"):t.execCommand("insertTab")},transposeChars:function(t){ue(t,function(){for(var e=t.listSelections(),i=[],r=0;r<e.length;r++){var n=e[r].head,o=sr(t.doc,n.line).text;if(o)if(n.ch==o.length&&(n=new Bn(n.line,n.ch-1)),n.ch>0)n=new Bn(n.line,n.ch+1),t.replaceRange(o.charAt(n.ch-1)+o.charAt(n.ch-2),Bn(n.line,n.ch-2),n,"+transpose");else if(n.line>t.doc.first){var s=sr(t.doc,n.line-1).text;s&&t.replaceRange(o.charAt(0)+t.doc.lineSeparator()+s.charAt(s.length-1),Bn(n.line-1,s.length-1),Bn(n.line,1),"+transpose")}i.push(new st(n,n))}t.setSelections(i)})},newlineAndIndent:function(t){ue(t,function(){for(var e=t.listSelections().length,i=0;e>i;i++){var r=t.listSelections()[i];t.replaceRange(t.doc.lineSeparator(),r.anchor,r.head,"+input"),t.indentLine(r.from().line+1,null,!0)}ri(t)})},toggleOverwrite:function(t){t.toggleOverwrite()}},ho=t.keyMap={};ho.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},ho.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},ho.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},ho.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},ho.default=Mn?ho.macDefault:ho.pcDefault,t.normalizeKeyMap=function(t){var e={};for(var i in t)if(t.hasOwnProperty(i)){var r=t[i];if(/^(name|fallthrough|(de|at)tach)$/.test(i))continue;if("..."==r){delete t[i];continue}for(var n=Fr(i.split(" "),hi),o=0;o<n.length;o++){var s,a;o==n.length-1?(a=n.join(" "),s=r):(a=n.slice(0,o+1).join(" "),s="...");var l=e[a];if(l){if(l!=s)throw new Error("Inconsistent bindings for "+a)}else e[a]=s}delete t[i]}for(var c in e)t[c]=e[c];return t};var uo=t.lookupKey=function(t,e,i,r){var n=(e=ui(e)).call?e.call(t,r):e[t];if(!1===n)return"nothing";if("..."===n)return"multi";if(null!=n&&i(n))return"handled";if(e.fallthrough){if("[object Array]"!=Object.prototype.toString.call(e.fallthrough))return uo(t,e.fallthrough,i,r);for(var o=0;o<e.fallthrough.length;o++){var s=uo(t,e.fallthrough[o],i,r);if(s)return s}}},po=t.isModifierKey=function(t){var e="string"==typeof t?t:os[t.keyCode];return"Ctrl"==e||"Alt"==e||"Shift"==e||"Mod"==e},fo=t.keyName=function(t,e){if(Tn&&34==t.keyCode&&t.char)return!1;var i=os[t.keyCode],r=i;return null!=r&&!t.altGraphKey&&(t.altKey&&"Alt"!=i&&(r="Alt-"+r),(Hn?t.metaKey:t.ctrlKey)&&"Ctrl"!=i&&(r="Ctrl-"+r),(Hn?t.ctrlKey:t.metaKey)&&"Cmd"!=i&&(r="Cmd-"+r),!e&&t.shiftKey&&"Shift"!=i&&(r="Shift-"+r),r)};t.fromTextArea=function(e,i){function r(){e.value=l.getValue()}if((i=i?Ur(i):{}).value=e.value,!i.tabindex&&e.tabIndex&&(i.tabindex=e.tabIndex),!i.placeholder&&e.placeholder&&(i.placeholder=e.placeholder),null==i.autofocus){var n=Yr();i.autofocus=n==e||null!=e.getAttribute("autofocus")&&n==document.body}if(e.form&&(Mo(e.form,"submit",r),!i.leaveSubmitMethodAlone)){var o=e.form,s=o.submit;try{var a=o.submit=function(){r(),o.submit=s,o.submit(),o.submit=a}}catch(t){}}i.finishInit=function(t){t.save=r,t.getTextArea=function(){return e},t.toTextArea=function(){t.toTextArea=isNaN,r(),e.parentNode.removeChild(t.getWrapperElement()),e.style.display="",e.form&&(Do(e.form,"submit",r),"function"==typeof e.form.submit&&(e.form.submit=s))}},e.style.display="none";var l=t(function(t){e.parentNode.insertBefore(t,e.nextSibling)},i);return l};var go=t.StringStream=function(t,e){this.pos=this.start=0,this.string=t,this.tabSize=e||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0};go.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){return this.pos<this.string.length?this.string.charAt(this.pos++):void 0},eat:function(t){var e=this.string.charAt(this.pos);if("string"==typeof t)var i=e==t;else i=e&&(t.test?t.test(e):t(e));return i?(++this.pos,e):void 0},eatWhile:function(t){for(var e=this.pos;this.eat(t););return this.pos>e},eatSpace:function(){for(var t=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>t},skipToEnd:function(){this.pos=this.string.length},skipTo:function(t){var e=this.string.indexOf(t,this.pos);return e>-1?(this.pos=e,!0):void 0},backUp:function(t){this.pos-=t},column:function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=Wo(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?Wo(this.string,this.lineStart,this.tabSize):0)},indentation:function(){return Wo(this.string,null,this.tabSize)-(this.lineStart?Wo(this.string,this.lineStart,this.tabSize):0)},match:function(t,e,i){if("string"!=typeof t){var r=this.string.slice(this.pos).match(t);return r&&r.index>0?null:(r&&!1!==e&&(this.pos+=r[0].length),r)}var n=function(t){return i?t.toLowerCase():t};return n(this.string.substr(this.pos,t.length))==n(t)?(!1!==e&&(this.pos+=t.length),!0):void 0},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(t,e){this.lineStart+=t;try{return e()}finally{this.lineStart-=t}}};var mo=0,vo=t.TextMarker=function(t,e){this.lines=[],this.type=e,this.doc=t,this.id=++mo};Ir(vo),vo.prototype.clear=function(){if(!this.explicitlyCleared){var t=this.doc.cm,e=t&&!t.curOp;if(e&&oe(t),Hr(this,"clear")){var i=this.find();i&&Nr(this,"clear",i.from,i.to)}for(var r=null,n=null,o=0;o<this.lines.length;++o){var s=this.lines[o],a=vi(s.markedSpans,this);t&&!this.collapsed?ye(t,dr(s),"text"):t&&(null!=a.to&&(n=dr(s)),null!=a.from&&(r=dr(s))),s.markedSpans=bi(s.markedSpans,a),null==a.from&&this.collapsed&&!Ii(this.doc,s)&&t&&cr(s,re(t.display))}if(t&&this.collapsed&&!t.options.lineWrapping)for(o=0;o<this.lines.length;++o){var l=Oi(this.lines[o]),d=c(l);d>t.display.maxLineLength&&(t.display.maxLine=l,t.display.maxLineLength=d,t.display.maxLineChanged=!0)}null!=r&&t&&this.collapsed&&be(t,r,n+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,t&&kt(t.doc)),t&&Nr(t,"markerCleared",t,this),e&&se(t),this.parent&&this.parent.clear()}},vo.prototype.find=function(t,e){null==t&&"bookmark"==this.type&&(t=1);for(var i,r,n=0;n<this.lines.length;++n){var o=this.lines[n],s=vi(o.markedSpans,this);if(null!=s.from&&(i=Bn(e?o:dr(o),s.from),-1==t))return i;if(null!=s.to&&(r=Bn(e?o:dr(o),s.to),1==t))return r}return i&&{from:i,to:r}},vo.prototype.changed=function(){var t=this.find(-1,!0),e=this,i=this.doc.cm;t&&i&&ue(i,function(){var r=t.line,n=dr(t.line),o=Wt(i,n);if(o&&(qt(o),i.curOp.selectionChanged=i.curOp.forceUpdate=!0),i.curOp.updateMaxLine=!0,!Ii(e.doc,r)&&null!=e.height){var s=e.height;e.height=null;var a=Bi(e)-s;a&&cr(r,r.height+a)}})},vo.prototype.attachLine=function(t){if(!this.lines.length&&this.doc.cm){var e=this.doc.cm.curOp;e.maybeHiddenMarkers&&-1!=Pr(e.maybeHiddenMarkers,this)||(e.maybeUnhiddenMarkers||(e.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(t)},vo.prototype.detachLine=function(t){if(this.lines.splice(Pr(this.lines,t),1),!this.lines.length&&this.doc.cm){var e=this.doc.cm.curOp;(e.maybeHiddenMarkers||(e.maybeHiddenMarkers=[])).push(this)}};mo=0;var bo=t.SharedTextMarker=function(t,e){this.markers=t,this.primary=e;for(var i=0;i<t.length;++i)t[i].parent=this};Ir(bo),bo.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var t=0;t<this.markers.length;++t)this.markers[t].clear();Nr(this,"clear")}},bo.prototype.find=function(t,e){return this.primary.find(t,e)};var yo=t.LineWidget=function(t,e,i){if(i)for(var r in i)i.hasOwnProperty(r)&&(this[r]=i[r]);this.doc=t,this.node=e};Ir(yo),yo.prototype.clear=function(){var t=this.doc.cm,e=this.line.widgets,i=this.line,r=dr(i);if(null!=r&&e){for(var n=0;n<e.length;++n)e[n]==this&&e.splice(n--,1);e.length||(i.widgets=null);var o=Bi(this);cr(i,Math.max(0,i.height-o)),t&&ue(t,function(){$i(t,i,-o),ye(t,r,"widget")})}},yo.prototype.changed=function(){var t=this.height,e=this.doc.cm,i=this.line;this.height=null;var r=Bi(this)-t;r&&(cr(i,i.height+r),e&&ue(e,function(){e.curOp.forceUpdate=!0,$i(e,i,r)}))};var wo=t.Line=function(t,e,i){this.text=t,Ci(this,e),this.height=i?i(this):1};Ir(wo),wo.prototype.lineNo=function(){return dr(this)};var ko={},xo={};ir.prototype={chunkSize:function(){return this.lines.length},removeInner:function(t,e){for(var i=t,r=t+e;r>i;++i){var n=this.lines[i];this.height-=n.height,Pi(n),Nr(n,"delete")}this.lines.splice(t,e)},collapse:function(t){t.push.apply(t,this.lines)},insertInner:function(t,e,i){this.height+=i,this.lines=this.lines.slice(0,t).concat(e).concat(this.lines.slice(t));for(var r=0;r<e.length;++r)e[r].parent=this},iterN:function(t,e,i){for(var r=t+e;r>t;++t)if(i(this.lines[t]))return!0}},rr.prototype={chunkSize:function(){return this.size},removeInner:function(t,e){this.size-=e;for(var i=0;i<this.children.length;++i){var r=this.children[i],n=r.chunkSize();if(n>t){var o=Math.min(e,n-t),s=r.height;if(r.removeInner(t,o),this.height-=s-r.height,n==o&&(this.children.splice(i--,1),r.parent=null),0==(e-=o))break;t=0}else t-=n}if(this.size-e<25&&(this.children.length>1||!(this.children[0]instanceof ir))){var a=[];this.collapse(a),this.children=[new ir(a)],this.children[0].parent=this}},collapse:function(t){for(var e=0;e<this.children.length;++e)this.children[e].collapse(t)},insertInner:function(t,e,i){this.size+=e.length,this.height+=i;for(var r=0;r<this.children.length;++r){var n=this.children[r],o=n.chunkSize();if(o>=t){if(n.insertInner(t,e,i),n.lines&&n.lines.length>50){for(;n.lines.length>50;){var s=new ir(n.lines.splice(n.lines.length-25,25));n.height-=s.height,this.children.splice(r+1,0,s),s.parent=this}this.maybeSpill()}break}t-=o}},maybeSpill:function(){if(!(this.children.length<=10)){var t=this;do{var e=new rr(t.children.splice(t.children.length-5,5));if(t.parent){t.size-=e.size,t.height-=e.height;var i=Pr(t.parent.children,t);t.parent.children.splice(i+1,0,e)}else{var r=new rr(t.children);r.parent=t,t.children=[r,e],t=r}e.parent=t.parent}while(t.children.length>10);t.parent.maybeSpill()}},iterN:function(t,e,i){for(var r=0;r<this.children.length;++r){var n=this.children[r],o=n.chunkSize();if(o>t){var s=Math.min(e,o-t);if(n.iterN(t,s,i))return!0;if(0==(e-=s))break;t=0}else t-=o}}};var Co=0,To=t.Doc=function(t,e,i,r){if(!(this instanceof To))return new To(t,e,i,r);null==i&&(i=0),rr.call(this,[new ir([new wo("",null)])]),this.first=i,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.frontier=i;var n=Bn(i,0);this.sel=lt(n),this.history=new fr(null),this.id=++Co,this.modeOption=e,this.lineSep=r,"string"==typeof t&&(t=this.splitLines(t)),er(this,{from:n,to:n,text:t}),bt(this,lt(n),Bo)};To.prototype=zr(rr.prototype,{constructor:To,iter:function(t,e,i){i?this.iterN(t-this.first,e-t,i):this.iterN(this.first,this.first+this.size,t)},insert:function(t,e){for(var i=0,r=0;r<e.length;++r)i+=e[r].height;this.insertInner(t-this.first,e,i)},remove:function(t,e){this.removeInner(t-this.first,e)},getValue:function(t){var e=lr(this,this.first,this.first+this.size);return!1===t?e:e.join(t||this.lineSeparator())},setValue:ge(function(t){var e=Bn(this.first,0),i=this.first+this.size-1;Ve(this,{from:e,to:Bn(i,sr(this,i).text.length),text:this.splitLines(t),origin:"setValue",full:!0},!0),bt(this,lt(e))}),replaceRange:function(t,e,i,r){ti(this,t,e=dt(this,e),i=i?dt(this,i):e,r)},getRange:function(t,e,i){var r=ar(this,dt(this,t),dt(this,e));return!1===i?r:r.join(i||this.lineSeparator())},getLine:function(t){var e=this.getLineHandle(t);return e&&e.text},getLineHandle:function(t){return ht(this,t)?sr(this,t):void 0},getLineNumber:function(t){return dr(t)},getLineHandleVisualStart:function(t){return"number"==typeof t&&(t=sr(this,t)),Oi(t)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(t){return dt(this,t)},getCursor:function(t){var e=this.sel.primary();return null==t||"head"==t?e.head:"anchor"==t?e.anchor:"end"==t||"to"==t||!1===t?e.to():e.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:ge(function(t,e,i){mt(this,dt(this,"number"==typeof t?Bn(t,e||0):t),null,i)}),setSelection:ge(function(t,e,i){mt(this,dt(this,t),dt(this,e||t),i)}),extendSelection:ge(function(t,e,i){pt(this,dt(this,t),e&&dt(this,e),i)}),extendSelections:ge(function(t,e){ft(this,function(t,e){for(var i=[],r=0;r<e.length;r++)i[r]=dt(t,e[r]);return i}(this,t))}),extendSelectionsBy:ge(function(t,e){ft(this,Fr(this.sel.ranges,t),e)}),setSelections:ge(function(t,e,i){if(t.length){for(var r=0,n=[];r<t.length;r++)n[r]=new st(dt(this,t[r].anchor),dt(this,t[r].head));null==e&&(e=Math.min(t.length-1,this.sel.primIndex)),bt(this,at(n,e),i)}}),addSelection:ge(function(t,e,i){var r=this.sel.ranges.slice(0);r.push(new st(dt(this,t),dt(this,e||t))),bt(this,at(r,r.length-1),i)}),getSelection:function(t){for(var e,i=this.sel.ranges,r=0;r<i.length;r++){var n=ar(this,i[r].from(),i[r].to());e=e?e.concat(n):n}return!1===t?e:e.join(t||this.lineSeparator())},getSelections:function(t){for(var e=[],i=this.sel.ranges,r=0;r<i.length;r++){var n=ar(this,i[r].from(),i[r].to());!1!==t&&(n=n.join(t||this.lineSeparator())),e[r]=n}return e},replaceSelection:function(t,e,i){for(var r=[],n=0;n<this.sel.ranges.length;n++)r[n]=t;this.replaceSelections(r,e,i||"+input")},replaceSelections:ge(function(t,e,i){for(var r=[],n=this.sel,o=0;o<n.ranges.length;o++){var s=n.ranges[o];r[o]={from:s.from(),to:s.to(),text:this.splitLines(t[o]),origin:i}}var a=e&&"end"!=e&&function(t,e,i){for(var r=[],n=Bn(t.first,0),o=n,s=0;s<e.length;s++){var a=e[s],l=je(a.from,n,o),c=je(Zn(a),n,o);if(n=a.to,o=c,"around"==i){var d=t.sel.ranges[s],h=Pn(d.head,d.anchor)<0;r[s]=new st(h?c:l,h?l:c)}else r[s]=new st(l,l)}return new ot(r,t.sel.primIndex)}(this,r,e);for(o=r.length-1;o>=0;o--)Ve(this,r[o]);a?vt(this,a):this.cm&&ri(this.cm)}),undo:ge(function(){Ye(this,"undo")}),redo:ge(function(){Ye(this,"redo")}),undoSelection:ge(function(){Ye(this,"undo",!0)}),redoSelection:ge(function(){Ye(this,"redo",!0)}),setExtending:function(t){this.extend=t},getExtending:function(){return this.extend},historySize:function(){for(var t=this.history,e=0,i=0,r=0;r<t.done.length;r++)t.done[r].ranges||++e;for(r=0;r<t.undone.length;r++)t.undone[r].ranges||++i;return{undo:e,redo:i}},clearHistory:function(){this.history=new fr(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(t){return t&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(t){return this.history.generation==(t||this.cleanGeneration)},getHistory:function(){return{done:kr(this.history.done),undone:kr(this.history.undone)}},setHistory:function(t){var e=this.history=new fr(this.history.maxGeneration);e.done=kr(t.done.slice(0),null,!0),e.undone=kr(t.undone.slice(0),null,!0)},addLineClass:ge(function(t,e,i){return si(this,t,"gutter"==e?"gutter":"class",function(t){var r="text"==e?"textClass":"background"==e?"bgClass":"gutter"==e?"gutterClass":"wrapClass";if(t[r]){if(Qr(i).test(t[r]))return!1;t[r]+=" "+i}else t[r]=i;return!0})}),removeLineClass:ge(function(t,e,i){return si(this,t,"gutter"==e?"gutter":"class",function(t){var r="text"==e?"textClass":"background"==e?"bgClass":"gutter"==e?"gutterClass":"wrapClass",n=t[r];if(!n)return!1;if(null==i)t[r]=null;else{var o=n.match(Qr(i));if(!o)return!1;var s=o.index+o[0].length;t[r]=n.slice(0,o.index)+(o.index&&s!=n.length?" ":"")+n.slice(s)||null}return!0})}),addLineWidget:ge(function(t,e,i){return function(t,e,i,r){var n=new yo(t,i,r),o=t.cm;return o&&n.noHScroll&&(o.display.alignWidgets=!0),si(t,e,"widget",function(e){var i=e.widgets||(e.widgets=[]);if(null==n.insertAt?i.push(n):i.splice(Math.min(i.length-1,Math.max(0,n.insertAt)),0,n),n.line=e,o&&!Ii(t,e)){var r=ur(e)<t.scrollTop;cr(e,e.height+Bi(n)),r&&ii(o,null,n.height),o.curOp.forceUpdate=!0}return!0}),n}(this,t,e,i)}),removeLineWidget:function(t){t.clear()},markText:function(t,e,i){return pi(this,dt(this,t),dt(this,e),i,"range")},setBookmark:function(t,e){var i={replacedWith:e&&(null==e.nodeType?e.widget:e),insertLeft:e&&e.insertLeft,clearWhenEmpty:!1,shared:e&&e.shared,handleMouseEvents:e&&e.handleMouseEvents};return pi(this,t=dt(this,t),t,i,"bookmark")},findMarksAt:function(t){var e=[],i=sr(this,(t=dt(this,t)).line).markedSpans;if(i)for(var r=0;r<i.length;++r){var n=i[r];(null==n.from||n.from<=t.ch)&&(null==n.to||n.to>=t.ch)&&e.push(n.marker.parent||n.marker)}return e},findMarks:function(t,e,i){t=dt(this,t),e=dt(this,e);var r=[],n=t.line;return this.iter(t.line,e.line+1,function(o){var s=o.markedSpans;if(s)for(var a=0;a<s.length;a++){var l=s[a];n==t.line&&t.ch>l.to||null==l.from&&n!=t.line||n==e.line&&l.from>e.ch||i&&!i(l.marker)||r.push(l.marker.parent||l.marker)}++n}),r},getAllMarks:function(){var t=[];return this.iter(function(e){var i=e.markedSpans;if(i)for(var r=0;r<i.length;++r)null!=i[r].from&&t.push(i[r].marker)}),t},posFromIndex:function(t){var e,i=this.first;return this.iter(function(r){var n=r.text.length+1;return n>t?(e=t,!0):(t-=n,void++i)}),dt(this,Bn(i,e))},indexFromPos:function(t){var e=(t=dt(this,t)).ch;return t.line<this.first||t.ch<0?0:(this.iter(this.first,t.line,function(t){e+=t.text.length+1}),e)},copy:function(t){var e=new To(lr(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep);return e.scrollTop=this.scrollTop,e.scrollLeft=this.scrollLeft,e.sel=this.sel,e.extend=!1,t&&(e.history.undoDepth=this.history.undoDepth,e.setHistory(this.getHistory())),e},linkedDoc:function(t){t||(t={});var e=this.first,i=this.first+this.size;null!=t.from&&t.from>e&&(e=t.from),null!=t.to&&t.to<i&&(i=t.to);var r=new To(lr(this,e,i),t.mode||this.modeOption,e,this.lineSep);return t.sharedHist&&(r.history=this.history),(this.linked||(this.linked=[])).push({doc:r,sharedHist:t.sharedHist}),r.linked=[{doc:this,isParent:!0,sharedHist:t.sharedHist}],function(t,e){for(var i=0;i<e.length;i++){var r=e[i],n=r.find(),o=t.clipPos(n.from),s=t.clipPos(n.to);if(Pn(o,s)){var a=pi(t,o,s,r.primary,r.primary.type);r.markers.push(a),a.parent=r}}}(r,fi(this)),r},unlinkDoc:function(e){if(e instanceof t&&(e=e.doc),this.linked)for(var i=0;i<this.linked.length;++i){if(this.linked[i].doc==e){this.linked.splice(i,1),e.unlinkDoc(this),gi(fi(this));break}}if(e.history==this.history){var r=[e.id];nr(e,function(t){r.push(t.id)},!0),e.history=new fr(null),e.history.done=kr(this.history.done,r),e.history.undone=kr(this.history.undone,r)}},iterLinkedDocs:function(t){nr(this,t)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(t){return this.lineSep?t.split(this.lineSep):es(t)},lineSeparator:function(){return this.lineSep||"\n"}}),To.prototype.eachLine=To.prototype.iter;var So="iter insert remove copy getEditor constructor".split(" ");for(var Lo in To.prototype)To.prototype.hasOwnProperty(Lo)&&Pr(So,Lo)<0&&(t.prototype[Lo]=function(t){return function(){return t.apply(this.doc,arguments)}}(To.prototype[Lo]));Ir(To);var Ao=t.e_preventDefault=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1},Eo=t.e_stopPropagation=function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},No=t.e_stop=function(t){Ao(t),Eo(t)},Mo=t.on=function(t,e,i){if(t.addEventListener)t.addEventListener(e,i,!1);else if(t.attachEvent)t.attachEvent("on"+e,i);else{var r=t._handlers||(t._handlers={});(r[e]||(r[e]=[])).push(i)}},Oo=[],Do=t.off=function(t,e,i){if(t.removeEventListener)t.removeEventListener(e,i,!1);else if(t.detachEvent)t.detachEvent("on"+e,i);else for(var r=Er(t,e,!1),n=0;n<r.length;++n)if(r[n]==i){r.splice(n,1);break}},Ho=t.signal=function(t,e){var i=Er(t,e,!0);if(i.length)for(var r=Array.prototype.slice.call(arguments,2),n=0;n<i.length;++n)i[n].apply(null,r)},Io=null,Ro=30,$o=t.Pass={toString:function(){return"CodeMirror.Pass"}},Bo={scroll:!1},Po={origin:"*mouse"},Fo={origin:"+move"};Rr.prototype.set=function(t,e){clearTimeout(this.id),this.id=setTimeout(e,t)};var Wo=t.countColumn=function(t,e,i,r,n){null==e&&(-1==(e=t.search(/[^\s\u00a0]/))&&(e=t.length));for(var o=r||0,s=n||0;;){var a=t.indexOf("\t",o);if(0>a||a>=e)return s+(e-o);s+=a-o,s+=i-s%i,o=a+1}},zo=t.findColumn=function(t,e,i){for(var r=0,n=0;;){var o=t.indexOf("\t",r);-1==o&&(o=t.length);var s=o-r;if(o==t.length||n+s>=e)return r+Math.min(s,e-n);if(n+=o-r,r=o+1,(n+=i-n%i)>=e)return r}},Uo=[""],Ko=function(t){t.select()};En?Ko=function(t){t.selectionStart=0,t.selectionEnd=t.value.length}:yn&&(Ko=function(t){try{t.select()}catch(t){}});var qo,Go=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,jo=t.isWordChar=function(t){return/\w/.test(t)||t>""&&(t.toUpperCase()!=t.toLowerCase()||Go.test(t))},_o=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;qo=document.createRange?function(t,e,i,r){var n=document.createRange();return n.setEnd(r||t,i),n.setStart(t,e),n}:function(t,e,i){var r=document.body.createTextRange();try{r.moveToElementText(t.parentNode)}catch(t){return r}return r.collapse(!0),r.moveEnd("character",i),r.moveStart("character",e),r};var Vo=t.contains=function(t,e){if(3==e.nodeType&&(e=e.parentNode),t.contains)return t.contains(e);do{if(11==e.nodeType&&(e=e.host),e==t)return!0}while(e=e.parentNode)};yn&&11>wn&&(Yr=function(){try{return document.activeElement}catch(t){return document.body}});var Xo,Yo,Qo=t.rmClass=function(t,e){var i=t.className,r=Qr(e).exec(i);if(r){var n=i.slice(r.index+r[0].length);t.className=i.slice(0,r.index)+(n?r[1]+n:"")}},Zo=t.addClass=function(t,e){var i=t.className;Qr(e).test(i)||(t.className+=(i?" ":"")+e)},Jo=!1,ts=function(){if(yn&&9>wn)return!1;var t=_r("div");return"draggable"in t||"dragDrop"in t}(),es=t.splitLines=3!="\n\nb".split(/\n/).length?function(t){for(var e=0,i=[],r=t.length;r>=e;){var n=t.indexOf("\n",e);-1==n&&(n=t.length);var o=t.slice(e,"\r"==t.charAt(n-1)?n-1:n),s=o.indexOf("\r");-1!=s?(i.push(o.slice(0,s)),e+=s+1):(i.push(o),e=n+1)}return i}:function(t){return t.split(/\r\n?|\n/)},is=window.getSelection?function(t){try{return t.selectionStart!=t.selectionEnd}catch(t){return!1}}:function(t){try{var e=t.ownerDocument.selection.createRange()}catch(t){}return!(!e||e.parentElement()!=t)&&0!=e.compareEndPoints("StartToEnd",e)},rs=function(){var t=_r("div");return"oncopy"in t||(t.setAttribute("oncopy","return;"),"function"==typeof t.oncopy)}(),ns=null,os=t.keyNames={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};!function(){for(var t=0;10>t;t++)os[t+48]=os[t+96]=String(t);for(t=65;90>=t;t++)os[t]=String.fromCharCode(t);for(t=1;12>=t;t++)os[t+111]=os[t+63235]="F"+t}();var ss,as=function(){function t(t){return 247>=t?i.charAt(t):t>=1424&&1524>=t?"R":t>=1536&&1773>=t?r.charAt(t-1536):t>=1774&&2220>=t?"r":t>=8192&&8203>=t?"w":8204==t?"b":"L"}function e(t,e,i){this.level=t,this.from=e,this.to=i}var i="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",r="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm",n=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,o=/[stwN]/,s=/[LRr]/,a=/[Lb1n]/,l=/[1n]/,c="L";return function(i){if(!n.test(i))return!1;for(var r=i.length,d=[],h=0;r>h;++h)d.push(v=t(i.charCodeAt(h)));h=0;for(var u=c;r>h;++h){"m"==(v=d[h])?d[h]=u:u=v}h=0;for(var p=c;r>h;++h){"1"==(v=d[h])&&"r"==p?d[h]="n":s.test(v)&&(p=v,"r"==v&&(d[h]="R"))}for(h=1,u=d[0];r-1>h;++h){"+"==(v=d[h])&&"1"==u&&"1"==d[h+1]?d[h]="1":","!=v||u!=d[h+1]||"1"!=u&&"n"!=u||(d[h]=u),u=v}for(h=0;r>h;++h){if(","==(v=d[h]))d[h]="N";else if("%"==v){for(var f=h+1;r>f&&"%"==d[f];++f);for(var g=h&&"!"==d[h-1]||r>f&&"1"==d[f]?"1":"N",m=h;f>m;++m)d[m]=g;h=f-1}}for(h=0,p=c;r>h;++h){var v=d[h];"L"==p&&"1"==v?d[h]="L":s.test(v)&&(p=v)}for(h=0;r>h;++h)if(o.test(d[h])){for(f=h+1;r>f&&o.test(d[f]);++f);var b="L"==(h?d[h-1]:c),y="L"==(r>f?d[f]:c);for(g=b||y?"L":"R",m=h;f>m;++m)d[m]=g;h=f-1}var w,k=[];for(h=0;r>h;)if(a.test(d[h])){var x=h;for(++h;r>h&&a.test(d[h]);++h);k.push(new e(0,x,h))}else{var C=h,T=k.length;for(++h;r>h&&"L"!=d[h];++h);for(m=C;h>m;)if(l.test(d[m])){m>C&&k.splice(T,0,new e(1,C,m));var S=m;for(++m;h>m&&l.test(d[m]);++m);k.splice(T,0,new e(2,S,m)),C=m}else++m;h>C&&k.splice(T,0,new e(1,C,h))}return 1==k[0].level&&(w=i.match(/^\s+/))&&(k[0].from=w[0].length,k.unshift(new e(0,0,w[0].length))),1==Br(k).level&&(w=i.match(/\s+$/))&&(Br(k).to-=w[0].length,k.push(new e(0,r-w[0].length,r))),2==k[0].level&&k.unshift(new e(1,k[0].to,k[0].to)),k[0].level!=Br(k).level&&k.push(new e(k[0].level,r,r)),k}}();return t.version="5.7.1",t}),function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";var e={autoSelfClosers:{area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,menuitem:!0},implicitlyClosed:{dd:!0,li:!0,optgroup:!0,option:!0,p:!0,rp:!0,rt:!0,tbody:!0,td:!0,tfoot:!0,th:!0,tr:!0},contextGrabbers:{dd:{dd:!0,dt:!0},dt:{dd:!0,dt:!0},li:{li:!0},option:{option:!0,optgroup:!0},optgroup:{optgroup:!0},p:{address:!0,article:!0,aside:!0,blockquote:!0,dir:!0,div:!0,dl:!0,fieldset:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,menu:!0,nav:!0,ol:!0,p:!0,pre:!0,section:!0,table:!0,ul:!0},rp:{rp:!0,rt:!0},rt:{rp:!0,rt:!0},tbody:{tbody:!0,tfoot:!0},td:{td:!0,th:!0},tfoot:{tbody:!0},th:{td:!0,th:!0},thead:{tbody:!0,tfoot:!0},tr:{tr:!0}},doNotIndent:{pre:!0},allowUnquoted:!0,allowMissing:!0,caseFold:!0},i={autoSelfClosers:{},implicitlyClosed:{},contextGrabbers:{},doNotIndent:{},allowUnquoted:!1,allowMissing:!1,allowMissingTagName:!1,caseFold:!1};t.defineMode("xml",function(r,n){var o,s,a=r.indentUnit,l={},c=n.htmlMode?e:i;for(var d in c)l[d]=c[d];for(var d in n)l[d]=n[d];function h(t,e){function i(i){return e.tokenize=i,i(t,e)}var r=t.next();return"<"==r?t.eat("!")?t.eat("[")?t.match("CDATA[")?i(p("atom","]]>")):null:t.match("--")?i(p("comment","--\x3e")):t.match("DOCTYPE",!0,!0)?(t.eatWhile(/[\w\._\-]/),i(function t(e){return function(i,r){for(var n;null!=(n=i.next());){if("<"==n)return r.tokenize=t(e+1),r.tokenize(i,r);if(">"==n){if(1==e){r.tokenize=h;break}return r.tokenize=t(e-1),r.tokenize(i,r)}}return"meta"}}(1))):null:t.eat("?")?(t.eatWhile(/[\w\._\-]/),e.tokenize=p("meta","?>"),"meta"):(o=t.eat("/")?"closeTag":"openTag",e.tokenize=u,"tag bracket"):"&"==r?(t.eat("#")?t.eat("x")?t.eatWhile(/[a-fA-F\d]/)&&t.eat(";"):t.eatWhile(/[\d]/)&&t.eat(";"):t.eatWhile(/[\w\.\-:]/)&&t.eat(";"))?"atom":"error":(t.eatWhile(/[^&<]/),null)}function u(t,e){var i,r,n=t.next();if(">"==n||"/"==n&&t.eat(">"))return e.tokenize=h,o=">"==n?"endTag":"selfcloseTag","tag bracket";if("="==n)return o="equals",null;if("<"==n){e.tokenize=h,e.state=m,e.tagName=e.tagStart=null;var s=e.tokenize(t,e);return s?s+" tag error":"tag error"}return/[\'\"]/.test(n)?(e.tokenize=(i=n,(r=function(t,e){for(;!t.eol();)if(t.next()==i){e.tokenize=u;break}return"string"}).isInAttribute=!0,r),e.stringStartCol=t.column(),e.tokenize(t,e)):(t.match(/^[^\s\u00a0=<>\"\']*[^\s\u00a0=<>\"\'\/]/),"word")}function p(t,e){return function(i,r){for(;!i.eol();){if(i.match(e)){r.tokenize=h;break}i.next()}return t}}function f(t){t.context&&(t.context=t.context.prev)}function g(t,e){for(var i;;){if(!t.context)return;if(i=t.context.tagName,!l.contextGrabbers.hasOwnProperty(i)||!l.contextGrabbers[i].hasOwnProperty(e))return;f(t)}}function m(t,e,i){return"openTag"==t?(i.tagStart=e.column(),v):"closeTag"==t?b:m}function v(t,e,i){return"word"==t?(i.tagName=e.current(),s="tag",k):l.allowMissingTagName&&"endTag"==t?(s="tag bracket",k(t,e,i)):(s="error",v)}function b(t,e,i){if("word"==t){var r=e.current();return i.context&&i.context.tagName!=r&&l.implicitlyClosed.hasOwnProperty(i.context.tagName)&&f(i),i.context&&i.context.tagName==r||!1===l.matchClosing?(s="tag",y):(s="tag error",w)}return l.allowMissingTagName&&"endTag"==t?(s="tag bracket",y(t,e,i)):(s="error",w)}function y(t,e,i){return"endTag"!=t?(s="error",y):(f(i),m)}function w(t,e,i){return s="error",y(t,0,i)}function k(t,e,i){if("word"==t)return s="attribute",x;if("endTag"==t||"selfcloseTag"==t){var r=i.tagName,n=i.tagStart;return i.tagName=i.tagStart=null,"selfcloseTag"==t||l.autoSelfClosers.hasOwnProperty(r)?g(i,r):(g(i,r),i.context=new function(t,e,i){this.prev=t.context,this.tagName=e,this.indent=t.indented,this.startOfLine=i,(l.doNotIndent.hasOwnProperty(e)||t.context&&t.context.noIndent)&&(this.noIndent=!0)}(i,r,n==i.indented)),m}return s="error",k}function x(t,e,i){return"equals"==t?C:(l.allowMissing||(s="error"),k(t,0,i))}function C(t,e,i){return"string"==t?T:"word"==t&&l.allowUnquoted?(s="string",k):(s="error",k(t,0,i))}function T(t,e,i){return"string"==t?T:k(t,0,i)}return h.isInText=!0,{startState:function(t){var e={tokenize:h,state:m,indented:t||0,tagName:null,tagStart:null,context:null};return null!=t&&(e.baseIndent=t),e},token:function(t,e){if(!e.tagName&&t.sol()&&(e.indented=t.indentation()),t.eatSpace())return null;o=null;var i=e.tokenize(t,e);return(i||o)&&"comment"!=i&&(s=null,e.state=e.state(o||i,t,e),s&&(i="error"==s?i+" error":s)),i},indent:function(e,i,r){var n=e.context;if(e.tokenize.isInAttribute)return e.tagStart==e.indented?e.stringStartCol+1:e.indented+a;if(n&&n.noIndent)return t.Pass;if(e.tokenize!=u&&e.tokenize!=h)return r?r.match(/^(\s*)/)[0].length:0;if(e.tagName)return!1!==l.multilineTagIndentPastTag?e.tagStart+e.tagName.length+2:e.tagStart+a*(l.multilineTagIndentFactor||1);if(l.alignCDATA&&/<!\[CDATA\[/.test(i))return 0;var o=i&&/^<(\/)?([\w_:\.-]*)/.exec(i);if(o&&o[1])for(;n;){if(n.tagName==o[2]){n=n.prev;break}if(!l.implicitlyClosed.hasOwnProperty(n.tagName))break;n=n.prev}else if(o)for(;n;){var s=l.contextGrabbers[n.tagName];if(!s||!s.hasOwnProperty(o[2]))break;n=n.prev}for(;n&&n.prev&&!n.startOfLine;)n=n.prev;return n?n.indent+a:e.baseIndent||0},electricInput:/<\/[\s\w:]+>$/,blockCommentStart:"\x3c!--",blockCommentEnd:"--\x3e",configuration:l.htmlMode?"html":"xml",helperType:l.htmlMode?"html":"xml",skipAttribute:function(t){t.state==C&&(t.state=k)}}}),t.defineMIME("text/xml","xml"),t.defineMIME("application/xml","xml"),t.mimeModes.hasOwnProperty("text/html")||t.defineMIME("text/html",{name:"xml",htmlMode:!0})}),function(t){"use strict";function e(t,i){return new e.prototype.init(t,i)}Function.prototype.bind||(Function.prototype.bind=function(t){var e=this;return function(){return e.apply(t)}});var i=0;t.fn.redactor=function(i){var r=[],n=Array.prototype.slice.call(arguments,1);return"string"==typeof i?this.each(function(){var e,o=t.data(this,"redactor");if("-1"!==i.search(/\./)?void 0!==o[(e=i.split("."))[0]]&&(e=o[e[0]][e[1]]):e=o[i],void 0!==o&&t.isFunction(e)){var s=e.apply(o,n);void 0!==s&&s!==o&&r.push(s)}else t.error('No such method "'+i+'" for Redactor')}):this.each(function(){t.data(this,"redactor",{}),t.data(this,"redactor",e(this,i))}),0===r.length?this:1===r.length?r[0]:r},t.Redactor=e,t.Redactor.VERSION="2.12",t.Redactor.modules=["air","autosave","block","buffer","build","button","caret","clean","code","core","detect","dropdown","events","file","focus","image","indent","inline","insert","keydown","keyup","lang","line","link","linkify","list","marker","modal","observe","offset","paragraphize","paste","placeholder","progress","selection","shortcuts","storage","toolbar","upload","uploads3","utils","browser"],t.Redactor.settings={},t.Redactor.opts={animation:!1,lang:"en",direction:"ltr",spellcheck:!0,overrideStyles:!0,stylesClass:!1,scrollTarget:document,focus:!1,focusEnd:!1,clickToEdit:!1,structure:!1,tabindex:!1,minHeight:!1,maxHeight:!1,maxWidth:!1,plugins:!1,callbacks:{},placeholder:!1,linkify:!0,enterKey:!0,pastePlainText:!1,pasteImages:!0,pasteLinks:!0,pasteBlockTags:["pre","h1","h2","h3","h4","h5","h6","table","tbody","thead","tfoot","th","tr","td","ul","ol","li","blockquote","p","figure","figcaption"],pasteInlineTags:["br","strong","ins","code","del","span","samp","kbd","sup","sub","mark","var","cite","small","b","u","em","i"],preClass:!1,preSpaces:4,tabAsSpaces:!1,tabKey:!0,autosave:!1,autosaveName:!1,autosaveFields:!1,imageUpload:null,imageUploadParam:"file",imageUploadFields:!1,imageUploadForms:!1,imageTag:"figure",imageEditable:!0,imageCaption:!0,imagePosition:!1,imageResizable:!1,imageFloatMargin:"10px",dragImageUpload:!0,multipleImageUpload:!0,clipboardImageUpload:!0,fileUpload:null,fileUploadParam:"file",fileUploadFields:!1,fileUploadForms:!1,dragFileUpload:!0,s3:!1,linkNewTab:!1,linkTooltip:!0,linkNofollow:!1,linkSize:30,linkValidation:!0,pasteLinkTarget:!1,videoContainerClass:"video-container",toolbar:!0,toolbarFixed:!0,toolbarFixedTarget:document,toolbarFixedTopOffset:0,toolbarExternal:!1,toolbarOverflow:!1,air:!1,airWidth:!1,formatting:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],formattingAdd:!1,buttons:["format","bold","italic","deleted","lists","image","file","link","horizontalrule"],buttonsTextLabeled:!1,buttonsHide:[],buttonsHideOnMobile:[],script:!0,removeNewlines:!1,removeComments:!0,replaceTags:{b:"strong",i:"em",strike:"del"},keepStyleAttr:[],keepInlineOnEnter:!1,shortcuts:{"ctrl+shift+m, meta+shift+m":{func:"inline.removeFormat"},"ctrl+b, meta+b":{func:"inline.format",params:["bold"]},"ctrl+i, meta+i":{func:"inline.format",params:["italic"]},"ctrl+h, meta+h":{func:"inline.format",params:["superscript"]},"ctrl+l, meta+l":{func:"inline.format",params:["subscript"]},"ctrl+k, meta+k":{func:"link.show"},"ctrl+shift+7":{func:"list.toggle",params:["orderedlist"]},"ctrl+shift+8":{func:"list.toggle",params:["unorderedlist"]}},shortcutsAdd:!1,activeButtons:["deleted","italic","bold"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted"},langs:{en:{format:"Format",image:"Image",file:"File",link:"Link",bold:"Bold",italic:"Italic",deleted:"Strikethrough",underline:"Underline","bold-abbr":"B","italic-abbr":"I","deleted-abbr":"S","underline-abbr":"U",lists:"Lists","link-insert":"Insert link","link-edit":"Edit link","link-in-new-tab":"Open link in new tab",unlink:"Unlink",cancel:"Cancel",close:"Close",insert:"Insert",save:"Save",delete:"Delete",text:"Text",edit:"Edit",title:"Title",paragraph:"Normal text",quote:"Quote",code:"Code",heading1:"Heading 1",heading2:"Heading 2",heading3:"Heading 3",heading4:"Heading 4",heading5:"Heading 5",heading6:"Heading 6",filename:"Name",optional:"optional",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",horizontalrule:"Line","upload-label":"Drop file here or ",caption:"Caption",bulletslist:"Bullets",numberslist:"Numbers","image-position":"Position",none:"None",left:"Left",right:"Right",center:"Center","accessibility-help-label":"Rich text editor"}},type:"textarea",inline:!1,inlineTags:["a","span","strong","strike","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small"],blockTags:["pre","ul","ol","li","p","h1","h2","h3","h4","h5","h6","dl","dt","dd","div","td","blockquote","output","figcaption","figure","address","section","header","footer","aside","article","iframe"],paragraphize:!0,paragraphizeBlocks:["table","div","pre","form","ul","ol","h1","h2","h3","h4","h5","h6","dl","blockquote","figcaption","address","section","header","footer","aside","article","object","style","script","iframe","select","input","textarea","button","option","map","area","math","hr","fieldset","legend","hgroup","nav","figure","details","menu","summary","p"],emptyHtml:"<p>&#x200b;</p>",invisibleSpace:"&#x200b;",emptyHtmlRendered:t("").html("​").html(),imageTypes:["image/png","image/jpeg","image/gif"],userAgent:navigator.userAgent.toLowerCase(),observe:{dropdowns:[]},regexps:{linkyoutube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.\-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,linkvimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,linkimage:/((https?|www)[^\s]+\.)(jpe?g|png|gif)(\?[^\s-]+)?/gi,url:/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/gi}},e.fn=t.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,UP:38,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37,LEFT_WIN:91},init:function(e,r){if(this.$element=t(e),this.uuid=i++,this.sBuffer=[],this.sRebuffer=[],this.loadOptions(r),this.loadModules(),this.opts.clickToEdit&&!this.$element.hasClass("redactor-click-to-edit"))return this.loadToEdit(r);this.$element.hasClass("redactor-click-to-edit")&&this.$element.removeClass("redactor-click-to-edit"),this.reIsBlock=new RegExp("^("+this.opts.blockTags.join("|").toUpperCase()+")$","i"),this.reIsInline=new RegExp("^("+this.opts.inlineTags.join("|").toUpperCase()+")$","i"),this.opts.dragImageUpload=null!==this.opts.imageUpload&&this.opts.dragImageUpload,this.opts.dragFileUpload=null!==this.opts.fileUpload&&this.opts.dragFileUpload,this.formatting={},this.lang.load(),t.extend(this.opts.shortcuts,this.opts.shortcutsAdd),this.$editor=this.$element,this.detectType(),this.core.callback("start"),this.core.callback("startToEdit"),this.start=!0,this.build.start()},detectType:function(){this.build.isInline()||this.opts.inline?this.opts.type="inline":this.build.isTag("DIV")?this.opts.type="div":this.build.isTag("PRE")&&(this.opts.type="pre")},loadToEdit:function(e){this.$element.on("click.redactor-click-to-edit",t.proxy(function(){this.initToEdit(e)},this)),this.$element.addClass("redactor-click-to-edit")},initToEdit:function(e){t.extend(e.callbacks,{startToEdit:function(){this.insert.node(this.marker.get(),!1)},initToEdit:function(){this.selection.restore(),this.clickToCancelStorage=this.code.get(),t(this.opts.clickToCancel).off(".redactor-click-to-edit"),t(this.opts.clickToCancel).show().on("click.redactor-click-to-edit",t.proxy(function(i){i.preventDefault(),this.core.destroy(),this.events.syncFire=!1,this.$element.html(this.clickToCancelStorage),this.core.callback("cancel",this.clickToCancelStorage),this.events.syncFire=!0,this.clickToCancelStorage="",t(this.opts.clickToCancel).hide(),t(this.opts.clickToSave).hide(),this.$element.on("click.redactor-click-to-edit",t.proxy(function(){this.initToEdit(e)},this)),this.$element.addClass("redactor-click-to-edit")},this)),t(this.opts.clickToSave).off(".redactor-click-to-edit"),t(this.opts.clickToSave).show().on("click.redactor-click-to-edit",t.proxy(function(i){i.preventDefault(),this.core.destroy(),this.core.callback("save",this.code.get()),t(this.opts.clickToCancel).hide(),t(this.opts.clickToSave).hide(),this.$element.on("click.redactor-click-to-edit",t.proxy(function(){this.initToEdit(e)},this)),this.$element.addClass("redactor-click-to-edit")},this))}}),this.$element.redactor(e),this.$element.off(".redactor-click-to-edit")},loadOptions:function(e){var i={};void 0!==t.Redactor.settings.namespace?this.$element.hasClass(t.Redactor.settings.namespace)&&(i=t.Redactor.settings):i=t.Redactor.settings,this.opts=t.extend({},t.Redactor.opts,this.$element.data(),e),this.opts=t.extend({},this.opts,i)},getModuleMethods:function(t){return Object.getOwnPropertyNames(t).filter(function(e){return"function"==typeof t[e]})},loadModules:function(){for(var e=t.Redactor.modules.length,i=0;i<e;i++)this.bindModuleMethods(t.Redactor.modules[i])},bindModuleMethods:function(t){if(void 0!==this[t]){this[t]=this[t]();for(var e=this.getModuleMethods(this[t]),i=e.length,r=0;r<i;r++)this[t][e[r]]=this[t][e[r]].bind(this)}},air:function(){return{enabled:!1,collapsed:function(){this.opts.air&&this.selection.get().collapseToStart()},collapsedEnd:function(){this.opts.air&&this.selection.get().collapseToEnd()},build:function(){this.detect.isMobile()||(this.button.hideButtons(),this.button.hideButtonsOnMobile(),0!==this.opts.buttons.length&&(this.$air=this.air.createContainer(),!1!==this.opts.airWidth&&this.$air.css("width",this.opts.airWidth),this.air.append(),this.button.$toolbar=this.$air,this.button.setFormatting(),this.button.load(this.$air),this.core.editor().on("mouseup.redactor",this,t.proxy(function(t){""!==this.selection.text()&&this.air.show(t)},this))))},append:function(){this.$air.appendTo("body")},createContainer:function(){return t("<ul>").addClass("redactor-air").attr({id:"redactor-air-"+this.uuid,role:"toolbar"}).hide()},show:function(e){this.selection.saveInstant(),t(".redactor-air").hide();var i=0,r=this.$air.innerWidth();t(window).width()<e.clientX+r&&(i=200),this.$air.css({left:e.clientX-i+"px",top:e.clientY+10+t(document).scrollTop()+"px"}).show(),this.air.enabled=!0,this.air.bindHide()},bindHide:function(){t(document).on("mousedown.redactor-air."+this.uuid,t.proxy(function(e){var i=t(e.target).closest(".redactor-dropdown").length;0===t(e.target).closest(this.$air).length&&0===i&&!1!==this.air.hide(e)&&this.marker.remove()},this)).on("keydown.redactor-air."+this.uuid,t.proxy(function(e){var i=e.which;if((this.utils.isRedactorParent(e.target)||t(e.target).hasClass("redactor-in"))&&0===t(e.target).closest("#redactor-modal").length){if(i===this.keyCode.ESC)this.selection.get().collapseToStart();else if(i===this.keyCode.BACKSPACE||i===this.keyCode.DELETE){var r=this.selection.get();this.selection.range(r).deleteContents()}else i===this.keyCode.ENTER&&this.selection.get().collapseToEnd();this.air.enabled?this.air.hide(e):this.selection.get().collapseToStart()}},this))},hide:function(e){if(e.ctrlKey||e.metaKey||e.shiftKey&&e.altKey)return!1;this.button.setInactiveAll(),this.$air.fadeOut(100),this.air.enabled=!1,t(document).off("mousedown.redactor-air."+this.uuid),t(document).off("keydown.redactor-air."+this.uuid)}}},autosave:function(){return{enabled:!1,html:!1,init:function(){this.opts.autosave&&(this.autosave.enabled=!0,this.autosave.name=this.opts.autosaveName?this.opts.autosaveName:this.$textarea.attr("name"))},is:function(){return this.autosave.enabled},send:function(){if(this.opts.autosave&&(this.autosave.source=this.code.get(),this.autosave.html!==this.autosave.source)){var e={};e.name=this.autosave.name,e[this.autosave.name]=this.autosave.source,e=this.autosave.getHiddenFields(e),t.ajax({url:this.opts.autosave,type:"post",data:e}).done(this.autosave.success)}},getHiddenFields:function(e){return!1===this.opts.autosaveFields||"object"!=typeof this.opts.autosaveFields?e:(t.each(this.opts.autosaveFields,t.proxy(function(i,r){null!==r&&0===r.toString().indexOf("#")&&(r=t(r).val()),e[i]=r},this)),e)},success:function(t){var e;try{e=JSON.parse(t)}catch(i){e=t}var i=void 0===e.error?"autosave":"autosaveError";this.core.callback(i,this.autosave.name,e),this.autosave.html=this.autosave.source},disable:function(){this.autosave.enabled=!1,clearInterval(this.autosaveTimeout)}}},block:function(){return{format:function(e,i,r,n){if(e="quote"===e?"blockquote":e,this.block.tags=["p","blockquote","pre","h1","h2","h3","h4","h5","h6","div","figure"],-1!==t.inArray(e,this.block.tags))return"p"===e&&void 0===i&&(i="class"),this.placeholder.hide(),this.buffer.set(),this.utils.isCollapsed()?this.block.formatCollapsed(e,i,r,n):this.block.formatUncollapsed(e,i,r,n)},formatCollapsed:function(e,i,r,n){this.selection.save();var o=this.selection.block(),s=o.tagName.toLowerCase();if(-1!==t.inArray(s,this.block.tags)){var a,l=!1;if(s===e&&void 0===i&&(e="p",l=!0),l&&(this.block.removeAllClass(),this.block.removeAllAttr()),"blockquote"===s&&this.utils.isEndOfElement(o)){this.marker.remove(),(a=document.createElement("p")).innerHTML=this.opts.invisibleSpace,t(o).after(a),this.caret.start(a);var c=t(o).children().last();0!==c.length&&"BR"===c[0].tagName&&c.remove()}else a=this.utils.replaceToTag(o,e);if("object"==typeof i)for(var d in n=r,i)a=this.block.setAttr(a,d,i[d],n);else a=this.block.setAttr(a,i,r,n);return"pre"===e&&1===a.length&&t(a).html(t.trim(t(a).html())),this.selection.restore(),this.block.removeInlineTags(a),a}this.selection.restore()},formatUncollapsed:function(e,i,r,n){this.selection.save();var o=[],s=this.selection.blocks();s[0]&&(t(s[0]).hasClass("redactor-in")||t(s[0]).hasClass("redactor-box"))&&(s=this.core.editor().find(this.opts.blockTags.join(", ")));for(var a=s.length,l=0;l<a;l++){var c=s[l].tagName.toLowerCase();if(-1!==t.inArray(c,this.block.tags)&&"figure"!==c){var d=this.utils.replaceToTag(s[l],e);if("object"==typeof i)for(var h in n=r,i)d=this.block.setAttr(d,h,i[h],n);else d=this.block.setAttr(d,i,r,n);o.push(d),this.block.removeInlineTags(d)}}if(this.selection.restore(),"pre"===e&&0!==o.length){var u=o[0];t.each(o,function(e,i){0!==e&&(t(u).append("\n"+t.trim(i.html())),t(i).remove())}),(o=[]).push(u)}return o},removeInlineTags:function(e){e=e[0]||e;var i=this.opts.inlineTags;if(-1!==t.inArray(e.tagName,["PRE","H1","H2","H3","H4","H5","H6"])){if("PRE"!==e.tagName){var r=i.indexOf("a");i.splice(r,1)}t(e).find(i.join(",")).not(".redactor-selection-marker").contents().unwrap()}},setAttr:function(t,e,i,r){if(void 0===e)return t;var n=void 0===r?"replace":r;return"class"===e?this.block[n+"Class"](i,t):"remove"===n?this.block[n+"Attr"](e,t):"removeAll"===n?this.block[n+"Attr"](e,t):this.block[n+"Attr"](e,i,t)},getBlocks:function(e){if(e=void 0===e?this.selection.blocks():e,t(e).hasClass("redactor-box")){var i=[],r=this.core.editor().children();return t.each(r,t.proxy(function(t,e){this.utils.isBlock(e)&&i.push(e)},this)),i}return e},replaceClass:function(e,i){return t(this.block.getBlocks(i)).removeAttr("class").addClass(e)[0]},toggleClass:function(e,i){return t(this.block.getBlocks(i)).toggleClass(e)[0]},addClass:function(e,i){return t(this.block.getBlocks(i)).addClass(e)[0]},removeClass:function(e,i){return t(this.block.getBlocks(i)).removeClass(e)[0]},removeAllClass:function(e){return t(this.block.getBlocks(e)).removeAttr("class")[0]},replaceAttr:function(e,i,r){return r=this.block.removeAttr(e,r),t(r).attr(e,i)[0]},toggleAttr:function(e,i,r){r=this.block.getBlocks(r);var n=this,o=[];return t.each(r,function(r,s){t(s).attr(e)?o.push(n.block.removeAttr(e,s)):o.push(n.block.addAttr(e,i,s))}),o},addAttr:function(e,i,r){return t(this.block.getBlocks(r)).attr(e,i)[0]},removeAttr:function(e,i){return t(this.block.getBlocks(i)).removeAttr(e)[0]},removeAllAttr:function(e){e=this.block.getBlocks(e);var i=[];return t.each(e,function(t,e){if(void 0!==e.attributes)for(;e.attributes.length;)e.removeAttribute(e.attributes[0].name);i.push(e)}),i}}},buffer:function(){return{set:function(t){void 0===t&&this.buffer.clear(),void 0===t||"undo"===t?this.buffer.setUndo():this.buffer.setRedo()},setUndo:function(){var t=this.selection.saveInstant(),e=this.sBuffer[this.sBuffer.length-1],i=this.core.editor().html();(void 0===e||e[0]!==i)&&this.sBuffer.push([i,t])},setRedo:function(){var t=this.selection.saveInstant();this.sRebuffer.push([this.core.editor().html(),t])},add:function(){this.sBuffer.push([this.core.editor().html(),0])},undo:function(){if(0!==this.sBuffer.length){var t=this.sBuffer.pop();this.buffer.set("redo"),this.core.editor().html(t[0]),this.selection.restoreInstant(t[1]),this.selection.restore(),this.observe.load()}},redo:function(){if(0!==this.sRebuffer.length){var t=this.sRebuffer.pop();this.buffer.set("undo"),this.core.editor().html(t[0]),this.selection.restoreInstant(t[1]),this.selection.restore(),this.observe.load()}},clear:function(){this.sRebuffer=[]}}},build:function(){return{start:function(){"inline"===this.opts.type?this.opts.type="inline":"div"===this.opts.type?(""===t.trim(this.$editor.html())&&this.$editor.html(this.opts.emptyHtml),this.build.buildTextarea()):"textarea"===this.opts.type&&this.build.startTextarea(),this.build.setIn(),this.build.setId(),this.build.enableEditor(),this.build.setOptions(),this.build.callEditor()},createContainerBox:function(){this.$box=t('<div class="redactor-box" role="application" />')},setIn:function(){this.core.editor().addClass("redactor-in")},setId:function(){var t="textarea"===this.opts.type?"redactor-uuid-"+this.uuid:this.$element.attr("id");this.core.editor().attr("id",void 0===t?"redactor-uuid-"+this.uuid:t)},getName:function(){var t=this.$element.attr("name");return void 0===t?"content-"+this.uuid:t},buildTextarea:function(){this.$textarea=t("<textarea>"),this.$textarea.attr("name",this.build.getName()),this.$textarea.hide(),this.$element.after(this.$textarea),this.build.setStartAttrs()},loadFromTextarea:function(){this.$editor=t("<div />"),this.$textarea=this.$element,this.$element.attr("name",this.build.getName()),this.$box.insertAfter(this.$element).append(this.$editor).append(this.$element),this.build.setStartAttrs(),this.$editor.addClass("redactor-layer"),this.opts.overrideStyles&&this.$editor.addClass("redactor-styles"),this.$element.hide(),this.$box.prepend('<span class="redactor-voice-label" id="redactor-voice-'+this.uuid+'" aria-hidden="false">'+this.lang.get("accessibility-help-label")+"</span>")},setStartAttrs:function(){this.$editor.attr({"aria-labelledby":"redactor-voice-"+this.uuid,role:"presentation"})},startTextarea:function(){this.build.createContainerBox(),this.build.loadFromTextarea(),this.code.start(this.core.textarea().val()),this.core.textarea().val(this.clean.onSync(this.$editor.html()))},isTag:function(t){return this.$element[0].tagName===t},isInline:function(){return!this.build.isTag("TEXTAREA")&&!this.build.isTag("DIV")&&!this.build.isTag("PRE")},enableEditor:function(){this.core.editor().attr({contenteditable:!0})},setOptions:function(){"inline"===this.opts.type&&(this.opts.enterKey=!1),"inline"!==this.opts.type&&"pre"!==this.opts.type||(this.opts.toolbarMobile=!1,this.opts.toolbar=!1,this.opts.air=!1,this.opts.linkify=!1),this.core.editor().attr("spellcheck",this.opts.spellcheck),this.opts.structure&&this.core.editor().addClass("redactor-structure"),this.opts.stylesClass&&this.core.editor().addClass(this.opts.stylesClass),"textarea"===this.opts.type&&(this.core.box().attr("dir",this.opts.direction),this.core.editor().attr("dir",this.opts.direction),this.opts.tabindex&&this.core.editor().attr("tabindex",this.opts.tabindex),this.opts.minHeight?this.core.editor().css("min-height",this.opts.minHeight):this.core.editor().css("min-height","40px"),this.opts.maxHeight&&this.core.editor().css("max-height",this.opts.maxHeight),this.opts.maxWidth&&this.core.editor().css({"max-width":this.opts.maxWidth,margin:"auto"}))},callEditor:function(){this.build.disableBrowsersEditing(),this.events.init(),this.build.setHelpers(),(this.opts.toolbar||this.opts.air)&&(this.toolbarsButtons=this.button.init()),this.opts.air?this.air.build():this.opts.toolbar&&this.toolbar.build(),this.detect.isMobile()&&this.opts.toolbarMobile&&this.opts.air&&(this.opts.toolbar=!0,this.toolbar.build()),(this.opts.air||this.opts.toolbar)&&(this.core.editor().on("mouseup.redactor-observe."+this.uuid+" keyup.redactor-observe."+this.uuid+" focus.redactor-observe."+this.uuid+" touchstart.redactor-observe."+this.uuid,t.proxy(this.observe.toolbar,this)),this.core.element().on("blur.callback.redactor",t.proxy(function(){this.button.setInactiveAll()},this))),this.modal.templates(),this.build.plugins(),this.autosave.init(),this.code.html=this.code.cleaned(this.core.editor().html()),this.core.callback("init"),this.core.callback("initToEdit"),this.storage.observe(),this.start=!1},setHelpers:function(){this.opts.linkify&&this.linkify.format(),this.placeholder.init(),this.opts.focus?setTimeout(this.focus.start,100):this.opts.focusEnd&&setTimeout(this.focus.end,100)},disableBrowsersEditing:function(){try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1),document.execCommand("AutoUrlDetect",!1,!1)}catch(t){}},plugins:function(){this.opts.plugins&&t.each(this.opts.plugins,t.proxy(function(i,r){var n="undefined"!=typeof RedactorPlugins&&void 0!==RedactorPlugins[r]?RedactorPlugins:e.fn;if(t.isFunction(n[r])){this[r]=n[r]();for(var o=this.getModuleMethods(this[r]),s=o.length,a=0;a<s;a++)this[r][o[a]]=this[r][o[a]].bind(this);if(void 0!==this[r].langs){var l={};void 0!==this[r].langs[this.opts.lang]?l=this[r].langs[this.opts.lang]:void 0===this[r].langs[this.opts.lang]&&void 0!==this[r].langs.en&&(l=this[r].langs.en);var c=this;t.each(l,function(t,e){void 0===c.opts.curLang[t]&&(c.opts.curLang[t]=e)})}t.isFunction(this[r].init)&&this[r].init()}},this))}}},button:function(){return{toolbar:function(){return void 0!==this.button.$toolbar&&this.button.$toolbar?this.button.$toolbar:this.$toolbar},init:function(){return{format:{title:this.lang.get("format"),icon:!0,dropdown:{p:{title:this.lang.get("paragraph"),func:"block.format"},blockquote:{title:this.lang.get("quote"),func:"block.format"},pre:{title:this.lang.get("code"),func:"block.format"},h1:{title:this.lang.get("heading1"),func:"block.format"},h2:{title:this.lang.get("heading2"),func:"block.format"},h3:{title:this.lang.get("heading3"),func:"block.format"},h4:{title:this.lang.get("heading4"),func:"block.format"},h5:{title:this.lang.get("heading5"),func:"block.format"},h6:{title:this.lang.get("heading6"),func:"block.format"}}},bold:{title:this.lang.get("bold-abbr"),icon:!0,label:this.lang.get("bold"),func:"inline.format"},italic:{title:this.lang.get("italic-abbr"),icon:!0,label:this.lang.get("italic"),func:"inline.format"},deleted:{title:this.lang.get("deleted-abbr"),icon:!0,label:this.lang.get("deleted"),func:"inline.format"},underline:{title:this.lang.get("underline-abbr"),icon:!0,label:this.lang.get("underline"),func:"inline.format"},lists:{title:this.lang.get("lists"),icon:!0,dropdown:{unorderedlist:{title:"&bull; "+this.lang.get("unorderedlist"),func:"list.toggle"},orderedlist:{title:"1. "+this.lang.get("orderedlist"),func:"list.toggle"},outdent:{title:"< "+this.lang.get("outdent"),func:"indent.decrease",observe:{element:"li",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},indent:{title:"> "+this.lang.get("indent"),func:"indent.increase",observe:{element:"li",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}}}},ul:{title:"&bull; "+this.lang.get("bulletslist"),icon:!0,func:"list.toggle"},ol:{title:"1. "+this.lang.get("numberslist"),icon:!0,func:"list.toggle"},outdent:{title:this.lang.get("outdent"),icon:!0,func:"indent.decrease"},indent:{title:this.lang.get("indent"),icon:!0,func:"indent.increase"},image:{title:this.lang.get("image"),icon:!0,func:"image.show"},file:{title:this.lang.get("file"),icon:!0,func:"file.show"},link:{title:this.lang.get("link"),icon:!0,dropdown:{link:{title:this.lang.get("link-insert"),func:"link.show",observe:{element:"a",in:{title:this.lang.get("link-edit")},out:{title:this.lang.get("link-insert")}}},unlink:{title:this.lang.get("unlink"),func:"link.unlink",observe:{element:"a",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}}}},horizontalrule:{title:this.lang.get("horizontalrule"),icon:!0,func:"line.insert"}}},setFormatting:function(){t.each(this.toolbarsButtons.format.dropdown,t.proxy(function(e,i){-1===t.inArray(e,this.opts.formatting)&&delete this.toolbarsButtons.format.dropdown[e]},this))},hideButtons:function(){0!==this.opts.buttonsHide.length&&this.button.hideButtonsSlicer(this.opts.buttonsHide)},hideButtonsOnMobile:function(){this.detect.isMobile()&&0!==this.opts.buttonsHideOnMobile.length&&this.button.hideButtonsSlicer(this.opts.buttonsHideOnMobile)},hideButtonsSlicer:function(e){t.each(e,t.proxy(function(t,e){var i=this.opts.buttons.indexOf(e);-1!==i&&this.opts.buttons.splice(i,1)},this))},load:function(e){this.button.buttons=[],t.each(this.opts.buttons,t.proxy(function(i,r){!this.toolbarsButtons[r]||"file"===r&&!this.file.is()||"image"===r&&!this.image.is()||e.append(t("<li>").append(this.button.build(r,this.toolbarsButtons[r])))},this))},buildButtonTooltip:function(e,i){if(void 0!==this.button.toolbar()&&!this.opts.air&&!this.detect.isMobile()){var r=t("<span>");r.addClass("re-button-tooltip"),r.html(i);var n=this,o=this.button.toolbar(),s=o.closest(".redactor-toolbar-box");(s=0===s.length?o:s).prepend(r),e.on("mouseover",function(){if(!t(this).hasClass("redactor-button-disabled")){var i=o.hasClass("toolbar-fixed-box")?e.offset():e.position();i=n.opts.toolbarFixedTarget!==document?e.position():i;var s=o.hasClass("toolbar-fixed-box")?e.position().top:i.top,a=e.innerHeight(),l=e.innerWidth(),c=o.hasClass("toolbar-fixed-box")?"fixed":"absolute";c=n.opts.toolbarFixedTarget!==document?"absolute":c;var d=n.opts.toolbarFixedTarget!==document?o.position().top:0;r.show(),r.css({top:s+a+d+"px",left:i.left+l/2-r.innerWidth()/2+"px",position:c})}}).on("mouseout",function(){r.hide()})}},build:function(e,i){if(!1!==this.opts.toolbar){var r=void 0!==i.label?i.label:i.title,n=t('<a href="javascript:void(null);" alt="'+r+'" rel="'+e+'" />');if(n.addClass("re-button re-"+e),n.attr({role:"button","aria-label":r,tabindex:"-1"}),void 0===i.icon||this.opts.buttonsTextLabeled)n.html(i.title);else{var o=t("<i>");o.addClass("re-icon-"+e),n.append(o),n.addClass("re-button-icon"),this.button.buildButtonTooltip(n,r)}if((i.func||i.command||i.dropdown)&&this.button.setEvent(n,e,i),i.dropdown){n.addClass("redactor-toolbar-link-dropdown").attr("aria-haspopup",!0);var s=t('<ul class="redactor-dropdown redactor-dropdown-'+this.uuid+" redactor-dropdown-box-"+e+'" style="display: none;">');n.data("dropdown",s),this.dropdown.build(e,s,i.dropdown)}return this.button.buttons.push(n),n}},getButtons:function(){return this.button.toolbar().find("a.re-button")},getButtonsKeys:function(){return this.button.buttons},setEvent:function(e,i,r){e.on("mousedown",t.proxy(function(t){if(t.preventDefault(),e.hasClass("redactor-button-disabled"))return!1;var n="func",o=r.func;return r.command?(n="command",o=r.command):r.dropdown&&(n="dropdown",o=!1),this.button.toggle(t,i,n,o),!1},this))},toggle:function(t,e,i,r,n){!this.detect.isIe()&&this.detect.isDesktop()||(this.utils.freezeScroll(),t.returnValue=!1),"command"===i?this.inline.format(r):"dropdown"===i?this.dropdown.show(t,e):this.button.clickCallback(t,r,e,n),"dropdown"!==i&&this.dropdown.hideAll(!1),this.opts.air&&"dropdown"!==i&&this.air.hide(t),!this.detect.isIe()&&this.detect.isDesktop()||this.utils.unfreezeScroll()},clickCallback:function(e,i,r,n){var o;if(n=void 0===n?r:n,t.isFunction(i))i.call(this,r);else if("-1"!==i.search(/\./)){if(void 0===this[(o=i.split("."))[0]])return;"object"==typeof n?this[o[0]][o[1]].apply(this,n):this[o[0]][o[1]].call(this,n)}else"object"==typeof n?this[i].apply(this,n):this[i].call(this,n);this.observe.buttons(e,r)},all:function(){return this.button.buttons},get:function(t){if(!1!==this.opts.toolbar)return this.button.toolbar().find("a.re-"+t)},set:function(t,e){if(!1!==this.opts.toolbar){var i=this.button.toolbar().find("a.re-"+t);return i.html(e).attr("aria-label",e),i}},add:function(e,i){if(!0!==this.button.isAdded(e))return t();var r=this.button.build(e,{title:i});return this.button.toolbar().append(t("<li>").append(r)),r},addFirst:function(e,i){if(!0!==this.button.isAdded(e))return t();var r=this.button.build(e,{title:i});return this.button.toolbar().prepend(t("<li>").append(r)),r},addAfter:function(e,i,r){if(!0!==this.button.isAdded(i))return t();var n=this.button.build(i,{title:r}),o=this.button.get(e);return 0!==o.length?o.parent().after(t("<li>").append(n)):this.button.toolbar().append(t("<li>").append(n)),n},addBefore:function(e,i,r){if(!0!==this.button.isAdded(i))return t();var n=this.button.build(i,{title:r}),o=this.button.get(e);return 0!==o.length?o.parent().before(t("<li>").append(n)):this.button.toolbar().append(t("<li>").append(n)),n},isAdded:function(t){var e=this.opts.buttonsHideOnMobile.indexOf(t);return!(!1===this.opts.toolbar||-1!==e&&this.detect.isMobile())},setIcon:function(t,e){this.opts.buttonsTextLabeled||(t.html(e).addClass("re-button-icon"),this.button.buildButtonTooltip(t,t.attr("alt")))},changeIcon:function(t,e){var i=this.button.get(t);0!==i.length&&i.find("i").removeAttr("class").addClass("re-icon-"+e)},addCallback:function(e,i){if(void 0!==e&&!1!==this.opts.toolbar){var r="dropdown"===i?"dropdown":"func",n=e.attr("rel");e.on("mousedown",t.proxy(function(t){if(e.hasClass("redactor-button-disabled"))return!1;this.button.toggle(t,n,r,i)},this))}},addDropdown:function(e,i){if(!1!==this.opts.toolbar){e.addClass("redactor-toolbar-link-dropdown").attr("aria-haspopup",!0);var r=e.attr("rel");this.button.addCallback(e,"dropdown");var n=t('<div class="redactor-dropdown redactor-dropdown-'+this.uuid+" redactor-dropdown-box-"+r+'" style="display: none;">');return e.data("dropdown",n),i&&this.dropdown.build(r,n,i),n}},setActive:function(t){this.button.get(t).addClass("redactor-act")},setInactive:function(t){this.button.get(t).removeClass("redactor-act")},setInactiveAll:function(t){var e=this.button.toolbar().find("a.re-button");void 0!==t&&(e=e.not(".re-"+t)),e.removeClass("redactor-act")},disable:function(t){this.button.get(t).addClass("redactor-button-disabled")},enable:function(t){this.button.get(t).removeClass("redactor-button-disabled")},disableAll:function(t){var e=this.button.toolbar().find("a.re-button");void 0!==t&&(e=e.not(".re-"+t)),e.addClass("redactor-button-disabled")},enableAll:function(){this.button.toolbar().find("a.re-button").removeClass("redactor-button-disabled")},remove:function(t){this.button.get(t).remove()}}},caret:function(){return{set:function(t,e,i){var r=this.core.editor().scrollTop();this.core.editor().focus(),this.core.editor().scrollTop(r),i=void 0===i?0:1,t=t[0]||t,e=e[0]||e;var n=this.selection.get(),o=this.selection.range(n);try{o.setStart(t,0),o.setEnd(e,i)}catch(t){}this.selection.update(n,o)},prepare:function(t){return this.detect.isFirefox()&&void 0!==this.start&&this.core.editor().focus(),t[0]||t},start:function(e){var i,r;if(e=this.caret.prepare(e)){if("BR"===e.tagName)return this.caret.before(e);var n=t(e).children().first(),o=this.utils.isInlineTag(e.tagName);""===e.innerHTML||o?this.caret.setStartEmptyOrInline(e,o):n&&0!==n.length&&this.utils.isInlineTag(n[0].tagName)&&""===n.text()?this.caret.setStartEmptyOrInline(n[0],!0):((i=window.getSelection()).removeAllRanges(),(r=document.createRange()).selectNodeContents(e),r.collapse(!0),i.addRange(r))}},setStartEmptyOrInline:function(e,i){var r=window.getSelection(),n=document.createRange(),o=document.createTextNode("​");n.setStart(e,0),n.insertNode(o),n.setStartAfter(o),n.collapse(!0),r.removeAllRanges(),r.addRange(n),i||this.core.editor().on("keydown.redactor-remove-textnode",function(){t(o).remove(),t(this).off("keydown.redactor-remove-textnode")})},end:function(e){var i,r;if(e=this.caret.prepare(e)){if("BR"!==e.tagName&&""===e.innerHTML)return this.caret.start(e);if("BR"===e.tagName){var n=document.createElement("span");return n.className="redactor-invisible-space",n.innerHTML="&#x200b;",t(e).after(n),(i=window.getSelection()).removeAllRanges(),(r=document.createRange()).setStartBefore(n),r.setEndBefore(n),i.addRange(r),void t(n).replaceWith(function(){return t(this).contents()})}if(e.lastChild&&1===e.lastChild.nodeType)return this.caret.after(e.lastChild);if((i=window.getSelection()).getRangeAt||i.rangeCount)try{(r=i.getRangeAt(0)).selectNodeContents(e),r.collapse(!1),i.removeAllRanges(),i.addRange(r)}catch(t){}}},after:function(e){var i,r;if(e=this.caret.prepare(e)){if("BR"===e.tagName)return this.caret.end(e);if(this.utils.isBlockTag(e.tagName)){var n=this.caret.next(e);void 0===n?this.caret.end(e):("TABLE"===n.tagName?n=t(n).find("th, td").first()[0]:"UL"!==n.tagName&&"OL"!==n.tagName||(n=t(n).find("li").first()[0]),this.caret.start(n))}else{var o=document.createTextNode("​");(i=window.getSelection()).removeAllRanges(),(r=document.createRange()).setStartAfter(e),r.insertNode(o),r.setStartAfter(o),r.collapse(!0),i.addRange(r)}}},before:function(e){var i,r;if(e=this.caret.prepare(e))if(this.utils.isBlockTag(e.tagName)){var n=this.caret.prev(e);void 0===n?this.caret.start(e):("TABLE"===n.tagName?n=t(n).find("th, td").last()[0]:"UL"!==n.tagName&&"OL"!==n.tagName||(n=t(n).find("li").last()[0]),this.caret.end(n))}else(i=window.getSelection()).removeAllRanges(),(r=document.createRange()).setStartBefore(e),r.collapse(!0),i.addRange(r)},next:function(e){var i=t(e).next();return i.hasClass("redactor-script-tag, redactor-selection-marker")?i.next()[0]:i[0]},prev:function(e){var i=t(e).prev();return i.hasClass("redactor-script-tag, redactor-selection-marker")?i.prev()[0]:i[0]},offset:function(t){return this.offset.get(t)}}},clean:function(){return{onSet:function(e){e=this.clean.savePreCode(e),e=this.clean.saveFormTags(e),this.opts.script&&(e=e.replace(/<script(.*?[^>]?)>([\w\W]*?)<\/script>/gi,'<pre class="redactor-script-tag" $1>$2</pre>')),e=(e=(e=(e=(e=e.replace(/\$/g,"&#36;")).replace(/&amp;/g,"&")).replace(/<a href="(.*?[^>]?)®(.*?[^>]?)">/gi,'<a href="$1&reg$2">')).replace(/<span id="selection-marker-1"(.*?[^>]?)>​<\/span>/gi,"###marker1###")).replace(/<span id="selection-marker-2"(.*?[^>]?)>​<\/span>/gi,"###marker2###");var i=this,r=t("<div/>").html(t.parseHTML(e,document,!0)),n=this.opts.replaceTags;if(n){var o=Object.keys(this.opts.replaceTags);r.find(o.join(",")).each(function(t,e){i.utils.replaceToTag(e,n[e.tagName.toLowerCase()])})}r.find("span, a").attr("data-redactor-span",!0),r.find(this.opts.inlineTags.join(",")).each(function(){var e=t(this);e.attr("style")&&e.attr("data-redactor-style-cache",e.attr("style"))}),e=r.html();var s=["font","html","head","link","body","meta","applet"];return this.opts.script||s.push("script"),e=this.clean.stripTags(e,s),this.opts.removeComments&&(e=e.replace(/<!--[\s\S]*?-->/gi,"")),-1!==(e=(e=(e=this.paragraphize.load(e)).replace("###marker1###",'<span id="selection-marker-1" class="redactor-selection-marker">​</span>')).replace("###marker2###",'<span id="selection-marker-2" class="redactor-selection-marker">​</span>')).search(/^(||\s||<br\s?\/?>||&nbsp;)$/i)?this.opts.emptyHtml:e},onGet:function(t){return this.clean.onSync(t)},onSync:function(e){if(-1!==(e=(e=e.replace(/\u200B/g,"")).replace(/&#x200b;/gi,"")).search(/^<p>(||\s||<br\s?\/?>||&nbsp;)<\/p>$/i))return"";e=(e=(e=(e=e.replace(/<span(.*?)id="redactor-image-box"(.*?[^>])>([\w\W]*?)<img(.*?)><\/span>/gi,"$3<img$4>")).replace(/<span(.*?)id="redactor-image-resizer"(.*?[^>])>(.*?)<\/span>/gi,"")).replace(/<span(.*?)id="redactor-image-editter"(.*?[^>])>(.*?)<\/span>/gi,"")).replace(/<img(.*?)style="(.*?)opacity: 0\.5;(.*?)"(.*?)>/gi,'<img$1style="$2$3"$4>');var i=t("<div/>").html(t.parseHTML(e,document,!0));i.find('*[style=""]').removeAttr("style"),i.find('*[class=""]').removeAttr("class"),i.find('*[rel=""]').removeAttr("rel"),i.find('*[data-image=""]').removeAttr("data-image"),i.find('*[alt=""]').removeAttr("alt"),i.find('*[title=""]').removeAttr("title"),i.find("*[data-redactor-style-cache]").removeAttr("data-redactor-style-cache"),i.find(".redactor-invisible-space, .redactor-unlink").each(function(){t(this).contents().unwrap()}),i.find("span, a").removeAttr("data-redactor-span data-redactor-style-cache").each(function(){0===this.attributes.length&&t(this).contents().unwrap()}),i.find("img").removeAttr("rel"),i.find(".redactor-selection-marker, #redactor-insert-marker").remove(),e=i.html(),this.opts.script&&(e=e.replace(/<pre class="redactor-script-tag"(.*?[^>]?)>([\w\W]*?)<\/pre>/gi,"<script$1>$2<\/script>")),e=(e=(e=(e=(e=this.clean.restoreFormTags(e)).replace(new RegExp("<br\\s?/?></h","gi"),"</h")).replace(new RegExp("<br\\s?/?></li>","gi"),"</li>")).replace(new RegExp("</li><br\\s?/?>","gi"),"</li>")).replace(/<pre>/gi,"<pre>\n"),this.opts.preClass&&(e=e.replace(/<pre>/gi,'<pre class="'+this.opts.preClass+'">')),this.opts.linkNofollow&&(e=(e=e.replace(/<a(.*?)rel="nofollow"(.*?[^>])>/gi,"<a$1$2>")).replace(/<a(.*?[^>])>/gi,'<a$1 rel="nofollow">'));return t.each({"™":"&trade;","©":"&copy;","…":"&hellip;","—":"&mdash;","‐":"&dash;"},function(t,i){e=e.replace(new RegExp(t,"g"),i)}),e=(e=e.replace(/&amp;/g,"&")).replace(/\n{2,}/g,"\n"),this.opts.removeNewlines&&(e=e.replace(/\r?\n/g,"")),e},onPaste:function(e,i,r){return!0!==r&&(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2")).replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3")).replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>")).replace(/<span[^>]*(font-style: italic; font-weight: 700|font-weight: 700; font-style: italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>")).replace(/<span[^>]*font-style: italic[^>]*>([\w\W]*?)<\/span>/gi,"<i>$1</i>")).replace(/<span[^>]*font-weight: bold[^>]*>([\w\W]*?)<\/span>/gi,"<b>$1</b>")).replace(/<span[^>]*font-weight: 700[^>]*>([\w\W]*?)<\/span>/gi,"<b>$1</b>")).replace(/<o:p[^>]*>/gi,"")).replace(/<\/o:p>/gi,""),this.clean.isHtmlMsWord(e)&&(e=this.clean.cleanMsWord(e))),e=t.trim(e),i.pre?this.opts.preSpaces&&(e=e.replace(/\t/g,new Array(this.opts.preSpaces+1).join(" "))):(e=this.clean.replaceBrToNl(e),e=this.clean.removeTagsInsidePre(e)),!0!==r&&(e=this.clean.removeEmptyInlineTags(e),!1===i.encode&&(e=e.replace(/&/g,"&amp;"),e=this.clean.convertTags(e,i),e=this.clean.getPlainText(e),e=this.clean.reconvertTags(e,i))),i.text&&(e=this.clean.replaceNbspToSpaces(e),e=this.clean.getPlainText(e)),i.lists&&(e=e.replace("\n","<br>")),i.encode&&(e=this.clean.encodeHtml(e)),i.paragraphize&&(e=(e=e.replace(/ \n/g," ")).replace(/\n /g," "),e=(e=this.paragraphize.load(e)).replace(/<p><\/p>/g,"")),(e=e.replace(/<li><p>/g,"<li>")).replace(/<\/p><\/li>/g,"</li>")},getCurrentType:function(t,e){var i=this.selection.blocks(),r={text:!1,encode:!1,paragraphize:!0,line:this.clean.isHtmlLine(t),blocks:this.clean.isHtmlBlocked(t),pre:!1,lists:!1,block:!0,inline:!0,links:!0,images:!0};return 1===i.length&&this.utils.isCurrentOrParent(["h1","h2","h3","h4","h5","h6","a","figcaption"])?(r.text=!0,r.paragraphize=!1,r.inline=!1,r.images=!1,r.links=!1,r.line=!0):"inline"===this.opts.type||!1===this.opts.enterKey?(r.paragraphize=!1,r.block=!1,r.line=!0):1===i.length&&this.utils.isCurrentOrParent(["li"])?(r.lists=!0,r.block=!1,r.paragraphize=!1,r.images=!1):1===i.length&&this.utils.isCurrentOrParent(["th","td","blockquote"])?(r.block=!1,r.paragraphize=!1):("pre"===this.opts.type||1===i.length&&this.utils.isCurrentOrParent("pre"))&&(r.inline=!1,r.block=!1,r.encode=!0,r.pre=!0,r.paragraphize=!1,r.images=!1,r.links=!1),!0===r.line&&(r.paragraphize=!1),!0===e&&(r.text=!1),r},isHtmlBlocked:function(t){var e=t.match(new RegExp("</("+this.opts.blockTags.join("|").toUpperCase()+")>","gi")),i=t.match(new RegExp("<hr(.*?[^>])>","gi"));return null!==e||null!==i},isHtmlLine:function(t){if(this.clean.isHtmlBlocked(t))return!1;var e=t.match(/<br\s?\/?>/gi),i=t.match(/\n/gi);return!e&&!i},isHtmlMsWord:function(t){return t.match(/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i)},removeEmptyInlineTags:function(e){var i=this.opts.inlineTags,r=t("<div/>").html(t.parseHTML(e,document,!0)),n=this,o=r.find("span"),s=r.find(i.join(","));return s.removeAttr("style"),s.each(function(){var e=t(this).html();0===this.attributes.length&&n.utils.isEmpty(e)&&t(this).replaceWith(function(){return t(this).contents()})}),o.each(function(){t(this).html(),0===this.attributes.length&&t(this).replaceWith(function(){return t(this).contents()})}),e=(e=(e=(e=r.html()).replace("\x3c!--?php","<?php")).replace("\x3c!--?","<?")).replace("?--\x3e","?>"),r.remove(),e},cleanMsWord:function(e){e=(e=(e=(e=e.replace(/<!--[\s\S]*?-->/g,"")).replace(/<o:p>[\s\S]*?<\/o:p>/gi,"")).replace(/\n/g," ")).replace(/<br\s?\/?>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n\n");var i=t("<div/>").html(e),r=!1,n=1,o=[];return i.find("p[style]").each(function(){var e=t(this).attr("style").match(/mso\-list\:l([0-9]+)\slevel([0-9]+)/);if(e){var s=parseInt(e[1]),a=parseInt(e[2]),l=t(this).html().match(/^[\w]+\./)?"ol":"ul",c=t("<li/>").html(t(this).html());if(c.html(c.html().replace(/^([\w\.]+)</,"<")),c.find("span:first").remove(),1==a&&-1==t.inArray(s,o)){var d=t("<"+l+"/>").attr({"data-level":a,"data-list":s}).html(c);t(this).replaceWith(d),r=s,o.push(s)}else{if(a>n){for(var h=p=i.find('[data-level="'+n+'"][data-list="'+r+'"]'),u=n;u<a;u++)(d=t("<"+l+"/>")).appendTo(h.find("li").last()),h=d;h.attr({"data-level":a,"data-list":s}).html(c)}else{var p=i.find('[data-level="'+a+'"][data-list="'+s+'"]').last();p.append(c)}n=a,r=s,t(this).remove()}}}),i.find("[data-level][data-list]").removeAttr("data-level data-list"),i.html()},replaceNbspToSpaces:function(t){return t.replace("&nbsp;"," ")},replaceBrToNl:function(t){return t.replace(/<br\s?\/?>/gi,"\n")},replaceNlToBr:function(t){return t.replace(/\n/g,"<br />")},convertTags:function(e,i){var r=t("<div>").html(e);r.find("iframe").remove();var n=r.find("a");if(n.removeAttr("style"),!1!==this.opts.pasteLinkTarget&&n.attr("target",this.opts.pasteLinkTarget),i.links&&this.opts.pasteLinks&&r.find("a").each(function(t,e){if(e.href){for(var i,r='##%%a href="'+e.href+'"',n=0,o=e.attributes.length;n<o;n++)"href"!==(i=e.attributes.item(n)).name&&(r+=" "+i.name+'="'+i.value+'"');e.outerHTML=r+"%%##"+e.innerHTML+"##%%/a%%##"}}),e=r.html(),i.images&&this.opts.pasteImages&&(e=e.replace(/<img(.*?)src="(.*?)"(.*?[^>])>/gi,'##%%img$1src="$2"$3%%##')),this.opts.pastePlainText)return e;for(var o,s=i.lists?["ul","ol","li"]:this.opts.pasteBlockTags,a=(o=i.block||i.lists?i.inline?s.concat(this.opts.pasteInlineTags):s:i.inline?this.opts.pasteInlineTags:[]).length,l=0;l<a;l++)e=e.replace(new RegExp("</"+o[l]+">","gi"),"###/"+o[l]+"###"),e="td"===o[l]||"th"===o[l]?e.replace(new RegExp("<"+o[l]+'(.*?[^>])((colspan|rowspan)="(.*?[^>])")?(.*?[^>])>',"gi"),"###"+o[l]+" $2###"):this.utils.isInlineTag(o[l])?(e=(e=e.replace(new RegExp("<"+o[l]+'([^>]*)class="([^>]*)"[^>]*>',"gi"),"###"+o[l]+' class="$2"###')).replace(new RegExp("<"+o[l]+'([^>]*)data-redactor-style-cache="([^>]*)"[^>]*>',"gi"),"###"+o[l]+' cache="$2"###')).replace(new RegExp("<"+o[l]+"[^>]*>","gi"),"###"+o[l]+"###"):e.replace(new RegExp("<"+o[l]+"[^>]*>","gi"),"###"+o[l]+"###");return e},reconvertTags:function(t,e){if((e.links&&this.opts.pasteLinks||e.images&&this.opts.pasteImages)&&(t=(t=t.replace(new RegExp("##%%","gi"),"<")).replace(new RegExp("%%##","gi"),">")),this.opts.pastePlainText)return t;for(var i,r=e.lists?["ul","ol","li"]:this.opts.pasteBlockTags,n=(i=e.block||e.lists?e.inline?r.concat(this.opts.pasteInlineTags):r:e.inline?this.opts.pasteInlineTags:[]).length,o=0;o<n;o++)t=t.replace(new RegExp("###/"+i[o]+"###","gi"),"</"+i[o]+">");for(o=0;o<n;o++)t=t.replace(new RegExp("###"+i[o]+"###","gi"),"<"+i[o]+">");for(o=0;o<n;o++)if("td"===i[o]||"th"===i[o])t=t.replace(new RegExp("###"+i[o]+"s?(.*?[^#])###","gi"),"<"+i[o]+"$1>");else if(this.utils.isInlineTag(i[o])){var s="span"===i[o]?' data-redactor-span="true"':"";t=(t=t.replace(new RegExp("###"+i[o]+' cache="(.*?[^#])"###',"gi"),"<"+i[o]+' style="$1"'+s+' data-redactor-style-cache="$1">')).replace(new RegExp("###"+i[o]+"s?(.*?[^#])###","gi"),"<"+i[o]+"$1>")}return t},cleanPre:function(e){e=void 0===e?t(this.selection.block()).closest("pre",this.core.editor()[0]):e,t(e).find("br").replaceWith(function(){return document.createTextNode("\n")}),t(e).find("p").replaceWith(function(){return t(this).contents()})},removeTagsInsidePre:function(e){var i=t("<div />").append(e);return i.find("pre").replaceWith(function(){var e=t(this).html();return e=(e=e.replace(/<br\s?\/?>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n")).replace(/(<([^>]+)>)/gi,""),t("<pre />").append(e)}),e=i.html(),i.remove(),e},getPlainText:function(e){e=(e=(e=(e=(e=(e=e.replace(/<!--[\s\S]*?-->/gi,"")).replace(/<style[\s\S]*?style>/gi,"")).replace(/<p><\/p>/g,"")).replace(/<\/div>|<\/li>|<\/td>/gi,"\n")).replace(/<\/p>/gi,"\n\n")).replace(/<\/H[1-6]>/gi,"\n\n");var i=document.createElement("div");return i.innerHTML=e,e=i.textContent||i.innerText,t.trim(e)},savePreCode:function(t){return t=this.clean.savePreFormatting(t),t=this.clean.saveCodeFormatting(t),this.clean.restoreSelectionMarkers(t)},savePreFormatting:function(e){var i=e.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return null===i?e:(t.each(i,t.proxy(function(t,i){var r,n,o,s=[],a=!1;i.match(/<pre(.*?)>(([\n\r\s]+)?)<code(.*?)>/i)?(a=!0,r=(s=i.match(/<pre(.*?)>(([\n\r\s]+)?)<code(.*?)>([\w\W]*?)<\/code>(([\n\r\s]+)?)<\/pre>/i))[5],n=s[1],o=s[4]):(r=(s=i.match(/<pre(.*?)>([\w\W]*?)<\/pre>/i))[2],n=s[1]),r=(r=r.replace(/<br\s?\/?>/g,"\n")).replace(/&nbsp;/g," "),this.opts.preSpaces&&(r=r.replace(/\t/g,new Array(this.opts.preSpaces+1).join(" "))),r=(r=this.clean.encodeEntities(r)).replace(/\$/g,"&#36;"),e=a?e.replace(i,"<pre"+n+"><code"+o+">"+r+"</code></pre>"):e.replace(i,"<pre"+n+">"+r+"</pre>")},this)),e)},saveCodeFormatting:function(e){var i=e.match(/<code(.*?)>([\w\W]*?)<\/code>/gi);return null===i?e:(t.each(i,t.proxy(function(t,i){var r=i.match(/<code(.*?)>([\w\W]*?)<\/code>/i);r[2]=r[2].replace(/&nbsp;/g," "),r[2]=this.clean.encodeEntities(r[2]),r[2]=r[2].replace(/\$/g,"&#36;"),e=e.replace(i,"<code"+r[1]+">"+r[2]+"</code>")},this)),e)},restoreSelectionMarkers:function(t){return t.replace(/&lt;span id=&quot;selection-marker-([0-9])&quot; class=&quot;redactor-selection-marker&quot;&gt;​&lt;\/span&gt;/g,'<span id="selection-marker-$1" class="redactor-selection-marker">​</span>')},saveFormTags:function(t){return t.replace(/<form(.*?)>([\w\W]*?)<\/form>/gi,'<section$1 rel="redactor-form-tag">$2</section>')},restoreFormTags:function(t){return t.replace(/<section(.*?) rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,"<form$1$2>$3</form>")},encodeHtml:function(t){return t=(t=(t=(t=t.replace(/”/g,'"')).replace(/“/g,'"')).replace(/‘/g,"'")).replace(/’/g,"'"),this.clean.encodeEntities(t)},encodeEntities:function(t){return(t=String(t).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},stripTags:function(t,e){if(void 0===e)return t.replace(/(<([^>]+)>)/gi,"");return t.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(t,i){return-1===e.indexOf(i.toLowerCase())?t:""})},removeMarkers:function(t){return t.replace(/<span(.*?[^>]?)class="redactor-selection-marker"(.*?[^>]?)>([\w\W]*?)<\/span>/gi,"")},removeSpaces:function(e){return(e=(e=(e=(e=(e=(e=(e=(e=t.trim(e)).replace(/\n/g,"")).replace(/[\t]*/g,"")).replace(/\n\s*\n/g,"\n")).replace(/^[\s\n]*/g," ")).replace(/[\s\n]*$/g," ")).replace(/>\s{2,}</g,"> <")).replace(/\n\n/g,"\n")).replace(/\u200B/g,"")},removeSpacesHard:function(e){return(e=(e=(e=(e=(e=(e=(e=(e=t.trim(e)).replace(/\n/g,"")).replace(/[\t]*/g,"")).replace(/\n\s*\n/g,"\n")).replace(/^[\s\n]*/g,"")).replace(/[\s\n]*$/g,"")).replace(/>\s{2,}</g,"><")).replace(/\n\n/g,"\n")).replace(/\u200B/g,"")},normalizeCurrentHeading:function(){var t=this.selection.block();this.utils.isCurrentOrParentHeader()&&t&&t.normalize()}}},code:function(){return{syncFire:!0,html:!1,start:function(e){e=(e=t.trim(e)).replace(/^(<span id="selection-marker-1" class="redactor-selection-marker">​<\/span>)/,""),"textarea"===this.opts.type?e=this.clean.onSet(e):"div"===this.opts.type&&""===e&&(e=this.opts.emptyHtml),e=e.replace(/<p><span id="selection-marker-1" class="redactor-selection-marker">​<\/span><\/p>/,""),this.events.stopDetectChanges(),this.core.editor().html(e),this.observe.load(),this.events.startDetectChanges()},set:function(e,i){e=t.trim(e),(i=i||{}).start&&(this.start=i.start),"textarea"===this.opts.type?e=this.clean.onSet(e):"div"===this.opts.type&&""===e&&(e=this.opts.emptyHtml),this.core.editor().html(e),"textarea"===this.opts.type&&this.code.sync(),this.placeholder.enable()},get:function(){if("textarea"===this.opts.type)return this.core.textarea().val();var t=this.core.editor().html();return this.clean.onGet(t)},sync:function(){if(this.code.syncFire){var e=this.core.editor().html(),i=this.code.cleaned(e);if(!this.code.isSync(i)){if(this.code.html=i,"textarea"!==this.opts.type)return this.core.callback("sync",e),void this.core.callback("change",e);"textarea"===this.opts.type&&setTimeout(t.proxy(function(){this.code.startSync(e)},this),10)}}},startSync:function(t){t=this.core.callback("syncBefore",t),t=this.clean.onSync(t),this.core.textarea().val(t),this.core.callback("sync",t),!1===this.start&&this.core.callback("change",t),this.start=!1},isSync:function(t){var e=!1!==this.code.html&&this.code.html;return!1!==e&&e===t},cleaned:function(t){return t=t.replace(/\u200B/g,""),this.clean.removeMarkers(t)}}},core:function(){return{id:function(){return this.$editor.attr("id")},element:function(){return this.$element},editor:function(){return void 0===this.$editor?t():this.$editor},textarea:function(){return this.$textarea},box:function(){return"textarea"===this.opts.type?this.$box:this.$element},toolbar:function(){return!!this.$toolbar&&this.$toolbar},air:function(){return!!this.$air&&this.$air},object:function(){return t.extend({},this)},structure:function(){this.core.editor().toggleClass("redactor-structure")},addEvent:function(t){this.core.event=t},getEvent:function(){return this.core.event},callback:function(e,i,r){var n=!1,o=t._data(this.core.element()[0],"events");if(void 0!==o&&void 0!==o[e])for(var s=o[e].length,a=0;a<s;a++)if("callback.redactor"===o[e][a].namespace){var l=o[e][a].handler,c=void 0===r?[i]:[i,r];n=void 0===c?l.call(this,i):l.call(this,i,c)}if(n)return n;if(void 0===this.opts.callbacks[e])return void 0===r?i:r;var d=this.opts.callbacks[e];return t.isFunction(d)?void 0===r?d.call(this,i):d.call(this,i,r):void 0===r?i:r},destroy:function(){this.opts.destroyed=!0,this.core.callback("destroy"),this.placeholder.destroy(),this.progress.destroy(),t("#redactor-voice-"+this.uuid).remove(),this.core.editor().removeClass("redactor-in redactor-styles redactor-structure redactor-layer-img-edit"),this.core.editor().off("keydown.redactor-remove-textnode"),this.core.editor().off(".redactor-observe."+this.uuid),this.$element.off(".redactor").removeData("redactor"),this.core.editor().off(".redactor"),t(document).off(".redactor-dropdown"),t(document).off(".redactor-air."+this.uuid),t(document).off("mousedown.redactor-blur."+this.uuid),t(document).off("mousedown.redactor."+this.uuid),t(document).off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid),t(window).off(".redactor-toolbar."+this.uuid),t(window).off("touchmove.redactor."+this.uuid),t("body").off("scroll.redactor."+this.uuid),t(this.opts.toolbarFixedTarget).off("scroll.redactor."+this.uuid);var e=this;!1!==this.opts.plugins&&t.each(this.opts.plugins,function(i,r){t(window).off(".redactor-plugin-"+r),t(document).off(".redactor-plugin-"+r),t("body").off(".redactor-plugin-"+r),e.core.editor().off(".redactor-plugin-"+r)}),this.$element.off("click.redactor-click-to-edit"),this.$element.removeClass("redactor-click-to-edit"),this.core.editor().removeClass("redactor-layer"),this.core.editor().removeAttr("contenteditable");var i=this.code.get();this.opts.toolbar&&this.$toolbar&&this.$toolbar.find("a").each(function(){var e=t(this);e.data("dropdown")&&(e.data("dropdown").remove(),e.data("dropdown",{}))}),"textarea"===this.opts.type&&(this.$box.after(this.$element),this.$box.remove(),this.$element.val(i).show()),this.opts.air&&this.$air.remove(),this.opts.toolbar&&this.$toolbar&&this.$toolbar.remove(),this.$modalBox&&this.$modalBox.remove(),this.$modalOverlay&&this.$modalOverlay.remove(),t(".redactor-link-tooltip").remove(),clearInterval(this.autosaveTimeout)}}},detect:function(){return{isWebkit:function(){return/webkit/.test(this.opts.userAgent)},isFirefox:function(){return this.opts.userAgent.indexOf("firefox")>-1},isIe:function(t){return document.documentMode||/Edge/.test(navigator.userAgent)?"edge":((e=RegExp("msie"+(isNaN(t)?"":"\\s"+t),"i").test(navigator.userAgent))||(e=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./)),e);var e},isMobile:function(){return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},isDesktop:function(){return!/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)},isIpad:function(){return/iPad/.test(navigator.userAgent)}}},dropdown:function(){return{active:!1,button:!1,key:!1,position:[],getDropdown:function(){return this.dropdown.active},build:function(e,i,r){r=this.dropdown.buildFormatting(e,r),t.each(r,t.proxy(function(t,r){var n=this.dropdown.buildItem(t,r);this.observe.addDropdown(n,t,r),i.attr("rel",e).append(n)},this))},buildFormatting:function(e,i){return"format"!==e||!1===this.opts.formattingAdd?i:(t.each(this.opts.formattingAdd,t.proxy(function(t,e){var r=this.utils.isBlockTag(e.args[0])?"block":"inline";i[t]={func:"block"===r?"block.format":"inline.format",args:e.args,title:e.title}},this)),i)},buildItem:function(e,i){var r=t("<li />");if(void 0!==i.classname&&r.addClass(i.classname),-1!==e.search(/^divider/i))return r.addClass("redactor-dropdown-divider"),r;var n=t('<a href="#" class="redactor-dropdown-'+e+'" role="button" />'),o=t("<span />").html(i.title);return n.append(o),n.on("mousedown",t.proxy(function(t){t.preventDefault(),this.dropdown.buildClick(t,e,i)},this)),r.append(n),r},buildClick:function(e,i,r){if(!t(e.target).hasClass("redactor-dropdown-link-inactive")){var n=this.dropdown.buildCommand(r);void 0!==r.args?this.button.toggle(e,i,n.type,n.callback,r.args):this.button.toggle(e,i,n.type,n.callback)}},buildCommand:function(t){var e={type:"func"};return e.callback=t.func,t.command?(e.type="command",e.callback=t.command):t.dropdown&&(e.type="dropdown",e.callback=t.dropdown),e},show:function(e,i){this.detect.isDesktop()&&this.core.editor().focus(),this.dropdown.hideAll(!1,i),this.dropdown.key=i,this.dropdown.button=this.button.get(this.dropdown.key),this.dropdown.button.hasClass("dropact")?this.dropdown.hide():(this.dropdown.active=this.dropdown.button.data("dropdown").appendTo(document.body),this.core.callback("dropdownShow",{dropdown:this.dropdown.active,key:this.dropdown.key,button:this.dropdown.button}),this.button.setActive(this.dropdown.key),this.dropdown.button.addClass("dropact"),this.dropdown.getButtonPosition(),this.button.toolbar().hasClass("toolbar-fixed-box")&&this.detect.isDesktop()?this.dropdown.showIsFixedToolbar():this.dropdown.showIsUnFixedToolbar(),this.detect.isDesktop()&&!this.detect.isFirefox()&&(this.dropdown.active.on("mouseover.redactor-dropdown",t.proxy(this.utils.disableBodyScroll,this)),this.dropdown.active.on("mouseout.redactor-dropdown mousedown.redactor-dropdown",t.proxy(this.utils.enableBodyScroll,this))),e.stopPropagation())},showIsFixedToolbar:function(){var e=this.dropdown.button.position().top+this.dropdown.button.innerHeight()+this.opts.toolbarFixedTopOffset,i="fixed";this.opts.toolbarFixedTarget!==document&&(e=this.dropdown.button.innerHeight()+this.$toolbar.offset().top+this.opts.toolbarFixedTopOffset,i="absolute"),this.dropdown.active.css({position:i,left:this.dropdown.position.left+"px",top:e+"px"}).show(),this.dropdown.active.redactorAnimation("slideDown",{duration:.2},t.proxy(function(){this.dropdown.enableCallback(),this.dropdown.enableEvents()},this))},showIsUnFixedToolbar:function(){this.dropdown.active.css({position:"absolute",left:this.dropdown.position.left+"px",top:this.dropdown.button.innerHeight()+this.dropdown.position.top+"px"}).show(),this.dropdown.active.redactorAnimation(this.opts.animation?"slideDown":"show",{duration:.2},t.proxy(function(){this.dropdown.enableCallback(),this.dropdown.enableEvents()},this))},enableEvents:function(){t(document).on("mousedown.redactor-dropdown",t.proxy(this.dropdown.hideAll,this)),this.core.editor().on("touchstart.redactor-dropdown",t.proxy(this.dropdown.hideAll,this)),t(document).on("keyup.redactor-dropdown",t.proxy(this.dropdown.closeHandler,this))},enableCallback:function(){this.core.callback("dropdownShown",{dropdown:this.dropdown.active,key:this.dropdown.key,button:this.dropdown.button})},getButtonPosition:function(){this.dropdown.position=this.dropdown.button.offset();var e=this.dropdown.active.width();this.dropdown.position.left+e>t(document).width()&&(this.dropdown.position.left=Math.max(0,this.dropdown.position.left-e+parseInt(this.dropdown.button.innerWidth())))},closeHandler:function(t){t.which===this.keyCode.ESC&&(this.dropdown.hideAll(t),this.core.editor().focus())},hideAll:function(e,i){if(this.detect.isDesktop()&&this.utils.enableBodyScroll(),!1===e||0===t(e.target).closest(".redactor-dropdown").length){var r=void 0===i?this.button.toolbar().find("a.dropact"):this.button.toolbar().find("a.dropact").not(".re-"+i),n=void 0===i?t(".redactor-dropdown-"+this.uuid):t(".redactor-dropdown-"+this.uuid).not(".redactor-dropdown-box-"+i);0!==n.length&&(t(document).off(".redactor-dropdown"),this.core.editor().off(".redactor-dropdown"),t.each(n,t.proxy(function(e,i){var r=t(i);this.core.callback("dropdownHide",r),r.hide(),r.off("mouseover mouseout").off(".redactor-dropdown")},this)),r.removeClass("redactor-act dropact"))}},hide:function(){!1!==this.dropdown.active&&(this.detect.isDesktop()&&this.utils.enableBodyScroll(),this.dropdown.active.redactorAnimation(this.opts.animation?"slideUp":"hide",{duration:.2},t.proxy(function(){t(document).off(".redactor-dropdown"),this.core.editor().off(".redactor-dropdown"),this.dropdown.hideOut()},this)))},hideOut:function(){this.core.callback("dropdownHide",this.dropdown.active),this.dropdown.button.removeClass("redactor-act dropact"),this.dropdown.active.off("mouseover mouseout").off(".redactor-dropdown"),this.dropdown.button=!1,this.dropdown.key=!1,this.dropdown.active=!1}}},events:function(){return{focused:!1,blured:!0,dropImage:!1,stopChanges:!1,stopDetectChanges:function(){this.events.stopChanges=!0},startDetectChanges:function(){var t=this;setTimeout(function(){t.events.stopChanges=!1},1)},dragover:function(e){e.preventDefault(),e.stopPropagation(),"IMG"===e.target.tagName&&t(e.target).addClass("redactor-image-dragover")},dragleave:function(t){this.core.editor().find("img").removeClass("redactor-image-dragover")},drop:function(t){return t=t.originalEvent||t,this.core.editor().find("img").removeClass("redactor-image-dragover"),"inline"===this.opts.type||"pre"===this.opts.type?(t.preventDefault(),!1):void 0===window.FormData||!t.dataTransfer||(0===t.dataTransfer.files.length?this.events.onDrop(t):(this.events.onDropUpload(t),void this.core.callback("drop",t)))},click:function(t){var e=this.core.getEvent(),i="click"!==e&&"arrow"!==e&&"click";this.core.addEvent(i),this.utils.disableSelectAll(),this.core.callback("click",t)},focus:function(t){if(!this.rtePaste&&(this.events.isCallback("focus")&&this.core.callback("focus",t),this.events.focused=!0,this.events.blured=!1,!1===this.selection.current())){var e=this.selection.get(),i=this.selection.range(e);i.setStart(this.core.editor()[0],0),i.setEnd(this.core.editor()[0],0),this.selection.update(e,i)}},blur:function(e){this.start||this.rtePaste||0===t(e.target).closest("#"+this.core.id()+", .redactor-toolbar, .redactor-dropdown, #redactor-modal-box").length&&(!this.events.blured&&this.events.isCallback("blur")&&this.core.callback("blur",e),this.events.focused=!1,this.events.blured=!0)},touchImageEditing:function(){var e=-1;this.events.imageEditing=!1,t(window).on("touchmove.redactor."+this.uuid,t.proxy(function(){this.events.imageEditing=!0,-1!==e&&clearTimeout(e),e=setTimeout(t.proxy(function(){this.events.imageEditing=!1},this),500)},this))},init:function(){this.core.editor().on("dragover.redactor dragenter.redactor",t.proxy(this.events.dragover,this)),this.core.editor().on("dragleave.redactor",t.proxy(this.events.dragleave,this)),this.core.editor().on("drop.redactor",t.proxy(this.events.drop,this)),this.core.editor().on("click.redactor",t.proxy(this.events.click,this)),this.core.editor().on("paste.redactor",t.proxy(this.paste.init,this)),this.core.editor().on("keydown.redactor",t.proxy(this.keydown.init,this)),this.core.editor().on("keyup.redactor",t.proxy(this.keyup.init,this)),this.core.editor().on("focus.redactor",t.proxy(this.events.focus,this)),t(document).on("mousedown.redactor-blur."+this.uuid,t.proxy(this.events.blur,this)),this.events.touchImageEditing(),this.events.createObserver(),this.events.setupObserver()},createObserver:function(){var e=this;this.events.observer=new MutationObserver(function(i){i.forEach(t.proxy(e.events.iterateObserver,e))})},iterateObserver:function(t){var e=!1;(("textarea"===this.opts.type||"div"===this.opts.type)&&!this.detect.isFirefox()&&t.target===this.core.editor()[0]||"class"===t.attributeName&&t.target===this.core.editor()[0]||"data-vivaldi-spatnav-clickable"==t.attributeName)&&(e=!0),e||(this.observe.load(),this.events.changeHandler())},setupObserver:function(){this.events.observer.observe(this.core.editor()[0],{attributes:!0,subtree:!0,childList:!0,characterData:!0,characterDataOldValue:!0})},changeHandler:function(){this.events.stopChanges||(this.code.sync(),this.autosave.is()&&(clearTimeout(this.autosaveTimeout),this.autosaveTimeout=setTimeout(t.proxy(this.autosave.send,this),300)))},onDropUpload:function(t){if(t.preventDefault(),t.stopPropagation(),(this.opts.dragImageUpload||this.opts.dragFileUpload)&&(null!==this.opts.imageUpload||null!==this.opts.fileUpload)){"IMG"===t.target.tagName&&(this.events.dropImage=t.target);for(var e=t.dataTransfer.files,i=e.length,r=0;r<i;r++)this.upload.directUpload(e[r],t)}},onDrop:function(t){this.core.callback("drop",t)},isCallback:function(e){return void 0!==this.opts.callbacks[e]&&t.isFunction(this.opts.callbacks[e])},stopDetect:function(){this.events.stopDetectChanges()},startDetect:function(){this.events.startDetectChanges()}}},file:function(){return{is:function(){return!(!this.opts.fileUpload||!this.opts.fileUpload&&!this.opts.s3)},show:function(){this.modal.load("file",this.lang.get("file"),700),this.upload.init("#redactor-modal-file-upload",this.opts.fileUpload,this.file.insert),t("#redactor-filename").val(this.selection.get().toString()),this.modal.show()},insert:function(e,i,r){if(void 0!==e.error)return this.modal.close(),void this.core.callback("fileUploadError",e);this.file.release(r,i),this.buffer.set(),this.air.collapsed();var n=this.file.text(e),o=t("<a />").attr("href",e.url).text(n),s=void 0===e.id?"":e.id,a=void 0===e.s3?"file":"s3";o.attr("data-"+a,s),o=t(this.insert.node(o)),this.caret.after(o),this.storage.add({type:a,node:o[0],url:e.url,id:s}),null!==i&&this.core.callback("fileUpload",o,e)},release:function(t,e){e?(this.marker.remove(),this.insert.nodeToPoint(t,this.marker.get()),this.selection.restore()):this.modal.close()},text:function(e){var i=t("#redactor-filename").val();return void 0===i||""===i?e.name:i}}},focus:function(){return{start:function(){if(this.core.editor().focus(),"inline"!==this.opts.type){var t=this.focus.first();!1!==t&&this.caret.start(t)}},end:function(){this.core.editor().focus();var t=this.opts.inline?this.core.editor():this.focus.last();if(0!==t.length){var e=this.focus.lastChild(t);if(this.detect.isWebkit()||!1===e){var i=this.selection.get(),r=this.selection.range(i);null!==r?(r.selectNodeContents(t[0]),r.collapse(!1),this.selection.update(i,r)):this.caret.end(t)}else this.caret.end(e)}},first:function(){var t=this.core.editor().children().first();return(0!==t.length||0!==t[0].length&&"BR"!==t[0].tagName&&"HR"!==t[0].tagName&&3!==t[0].nodeType)&&("UL"===t[0].tagName||"OL"===t[0].tagName?t.find("li").first():t)},last:function(){return this.core.editor().children().last()},lastChild:function(t){var e=t[0].lastChild;return!(null===e||!this.utils.isInlineTag(e.tagName))&&e},is:function(){return this.core.editor()[0]===document.activeElement}}},image:function(){return{is:function(){return!(!this.opts.imageUpload||!this.opts.imageUpload&&!this.opts.s3)},show:function(){this.modal.load("image",this.lang.get("image"),700),this.upload.init("#redactor-modal-image-droparea",this.opts.imageUpload,this.image.insert),this.modal.show()},insert:function(e,i,r){var n;if(void 0!==e.error)return this.modal.close(),this.events.dropImage=!1,void this.core.callback("imageUploadError",e,r);if(!1!==this.events.dropImage)return n=t(this.events.dropImage),this.core.callback("imageDelete",n[0].src,n),n.attr("src",e.url),this.events.dropImage=!1,void this.core.callback("imageUpload",n,e);this.placeholder.hide();var o=t("<"+this.opts.imageTag+">");(n=t("<img>")).attr("src",e.url);var s=void 0===e.id?"":e.id,a=void 0===e.s3?"image":"s3";n.attr("data-"+a,s),o.append(n);var l=this.utils.isTag(this.selection.current(),"pre");if(i){this.air.collapsed(),this.marker.remove();var c=this.insert.nodeToPoint(r,this.marker.get()),d=t(c).next();this.selection.restore(),this.buffer.set(),void 0!==d&&0!==d.length&&"IMG"===d[0].tagName?(this.core.callback("imageDelete",d[0].src,d),d.closest("figure, p",this.core.editor()[0]).replaceWith(o),this.caret.after(o)):(l?t(l).after(o):this.insert.node(o),this.caret.after(o))}else this.modal.close(),this.buffer.set(),this.air.collapsed(),l?t(l).after(o):this.insert.node(o),this.caret.after(o);this.events.dropImage=!1,this.storage.add({type:a,node:n[0],url:e.url,id:s});var h=n[0].nextSibling,u=o.next(),p=t(h).text().replace(/\u200B/g,""),f=u.text().replace(/\u200B/g,"");""===p&&t(h).remove(),1===u.length&&"FIGURE"===u[0].tagName&&""===f&&u.remove(),null!==i?this.core.callback("imageUpload",n,e):this.core.callback("imageInserted",n,e)},setEditable:function(e){if(e.on("dragstart",function(t){t.preventDefault()}),this.opts.imageResizable){var i=t.proxy(function(i){this.observe.image=e,this.image.resizer=this.image.loadEditableControls(e),t(document).on("mousedown.redactor-image-resize-hide."+this.uuid,t.proxy(this.image.hideResize,this)),this.image.resizer&&this.image.resizer.on("mousedown.redactor touchstart.redactor",t.proxy(function(t){this.image.setResizable(t,e)},this))},this);e.off("mousedown.redactor").on("mousedown.redactor",t.proxy(this.image.hideResize,this)),e.off("click.redactor touchstart.redactor").on("click.redactor touchstart.redactor",i)}else e.off("click.redactor touchstart.redactor").on("click.redactor touchstart.redactor",t.proxy(function(i){setTimeout(t.proxy(function(){this.image.showEdit(e)},this),200)},this))},setResizable:function(t,e){t.preventDefault(),this.image.resizeHandle={x:t.pageX,y:t.pageY,el:e,ratio:e.width()/e.height(),h:e.height()},(t=t.originalEvent||t).targetTouches&&(this.image.resizeHandle.x=t.targetTouches[0].pageX,this.image.resizeHandle.y=t.targetTouches[0].pageY),this.image.startResize()},startResize:function(){t(document).on("mousemove.redactor-image-resize touchmove.redactor-image-resize",t.proxy(this.image.moveResize,this)),t(document).on("mouseup.redactor-image-resize touchend.redactor-image-resize",t.proxy(this.image.stopResize,this))},moveResize:function(t){t.preventDefault(),t=t.originalEvent||t;var e=this.image.resizeHandle.h;t.targetTouches?e+=t.targetTouches[0].pageY-this.image.resizeHandle.y:e+=t.pageY-this.image.resizeHandle.y;var i=Math.round(e*this.image.resizeHandle.ratio);e<50||i<100||this.core.editor().width()<=i||(this.image.resizeHandle.el.attr({width:i,height:e}),this.image.resizeHandle.el.width(i),this.image.resizeHandle.el.height(e),this.code.sync())},stopResize:function(){this.handle=!1,t(document).off(".redactor-image-resize"),this.image.hideResize()},hideResize:function(e){if(!e||0===t(e.target).closest("#redactor-image-box",this.$editor[0]).length){e&&"IMG"==e.target.tagName&&t(e.target);var i=this.$editor.find("#redactor-image-box");0!==i.length&&(t("#redactor-image-editter").remove(),t("#redactor-image-resizer").remove(),i.find("img").css({marginTop:i[0].style.marginTop,marginBottom:i[0].style.marginBottom,marginLeft:i[0].style.marginLeft,marginRight:i[0].style.marginRight}),i.css("margin",""),i.find("img").css("opacity",""),i.replaceWith(function(){return t(this).contents()}),t(document).off("mousedown.redactor-image-resize-hide."+this.uuid),void 0!==this.image.resizeHandle&&this.image.resizeHandle.el.attr("rel",this.image.resizeHandle.el.attr("style")))}},loadResizableControls:function(e,i){if(this.opts.imageResizable&&!this.detect.isMobile()){var r=t('<span id="redactor-image-resizer" data-redactor="verified"></span>');return this.detect.isDesktop()||r.css({width:"15px",height:"15px"}),r.attr("contenteditable",!1),i.append(r),i.append(e),r}return i.append(e),!1},loadEditableControls:function(e){if(0===t("#redactor-image-box").length){var i=t('<span id="redactor-image-box" data-redactor="verified">');if(i.css("float",e.css("float")).attr("contenteditable",!1),"auto"!=e[0].style.margin?(i.css({marginTop:e[0].style.marginTop,marginBottom:e[0].style.marginBottom,marginLeft:e[0].style.marginLeft,marginRight:e[0].style.marginRight}),e.css("margin","")):i.css({display:"block",margin:"auto"}),e.css("opacity",".5").after(i),this.opts.imageEditable){this.image.editter=t('<span id="redactor-image-editter" data-redactor="verified">'+this.lang.get("edit")+"</span>"),this.image.editter.attr("contenteditable",!1),this.image.editter.on("click",t.proxy(function(){this.image.showEdit(e)},this)),i.append(this.image.editter);var r=this.image.editter.innerWidth();this.image.editter.css("margin-left","-"+r/2+"px")}return this.image.loadResizableControls(e,i)}},showEdit:function(e){if(!this.events.imageEditing){this.observe.image=e;var i=e.closest("a",this.$editor[0]),r=e.closest("figure",this.$editor[0]),n=0!==r.length?r:e;if(this.modal.load("image-edit",this.lang.get("edit"),705),this.image.buttonDelete=this.modal.getDeleteButton().text(this.lang.get("delete")),this.image.buttonSave=this.modal.getActionButton().text(this.lang.get("save")),this.image.buttonDelete.on("click",t.proxy(this.image.remove,this)),this.image.buttonSave.on("click",t.proxy(this.image.update,this)),!1===this.opts.imageCaption)t("#redactor-image-caption").val("").hide().prev().hide();else{var o=e.closest(this.opts.imageTag,this.$editor[0]).find("figcaption");0!==o&&t("#redactor-image-caption").val(o.text()).show()}if(this.opts.imagePosition){var s=(0!==r.length?"center"===n.css("text-align"):"block"==n.css("display")&&"none"==n.css("float"))?"center":n.css("float");t("#redactor-image-align").val(s)}else t(".redactor-image-position-option").hide();t("#redactor-image-preview").html(t('<img src="'+e.attr("src")+'" style="max-width: 100%;">')),t("#redactor-image-title").val(e.attr("alt")),0!==i.length&&(t("#redactor-image-link").val(i.attr("href")),"_blank"===i.attr("target")&&t("#redactor-image-link-blank").prop("checked",!0)),t(".redactor-link-tooltip").remove(),this.modal.show(),this.detect.isDesktop()&&t("#redactor-image-title").focus()}},update:function(){var e=this.observe.image,i=e.closest("a",this.core.editor()[0]),r=t("#redactor-image-title").val().replace(/(<([^>]+)>)/gi,"");e.attr("alt",r).attr("title",r),this.image.setFloating(e);var n=t.trim(t("#redactor-image-link").val()).replace(/(<([^>]+)>)/gi,"");if(""!==n){var o="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}",s=new RegExp("^(http|ftp|https)://"+o,"i"),a=new RegExp("^"+o,"i");-1===n.search(s)&&0===n.search(a)&&this.opts.linkProtocol&&(n=this.opts.linkProtocol+"://"+n);var l=!!t("#redactor-image-link-blank").prop("checked");if(0===i.length){var c=t('<a href="'+n+'" id="redactor-img-tmp">'+this.utils.getOuterHtml(e)+"</a>");l&&c.attr("target","_blank"),e=e.replaceWith(c),(i=this.core.editor().find("#redactor-img-tmp")).removeAttr("id")}else i.attr("href",n),l?i.attr("target","_blank"):i.removeAttr("target")}else 0!==i.length&&i.replaceWith(this.utils.getOuterHtml(e));this.image.addCaption(e,i),this.modal.close(),this.buffer.set()},setFloating:function(e){var i=e.closest("figure",this.$editor[0]),r=0!==i.length?i:e,n="",o="",s="",a="";switch(t("#redactor-image-align").val()){case"left":n="left",s="0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin+" 0";break;case"right":n="right",s="0 0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin;break;case"center":0!==i.length?a="center":(o="block",s="auto")}r.css({float:n,display:o,margin:s,"text-align":a}),r.attr("rel",e.attr("style"))},addCaption:function(e,i){var r=t("#redactor-image-caption").val(),n=0!==i.length?i:e,o=n.next();0!==o.length&&"FIGCAPTION"===o[0].tagName||(o=!1),""!==r?!1===o?(o=t("<figcaption />").text(r),n.after(o)):o.text(r):!1!==o&&o.remove()},remove:function(e,i,r){i=void 0===i?t(this.observe.image):i,"boolean"!=typeof e&&this.buffer.set(),this.events.stopDetectChanges();var n,o,s=i.closest("a",this.core.editor()[0]),a=i.closest(this.opts.imageTag,this.core.editor()[0]);if(i.parent(),!1===this.core.callback("imageDelete",e,i[0]))return e&&e.preventDefault(),!1;0!==t("#redactor-image-box").length&&t("#redactor-image-box").parent(),0!==a.length?(o=a.prev(),n=a.next(),a.remove()):0!==s.length?(s.parent(),s.remove()):i.remove(),t("#redactor-image-box").remove(),!1!==e&&(n&&0!==n.length?this.caret.start(n):o&&0!==o.length&&this.caret.end(o)),"boolean"!=typeof e&&this.modal.close(),this.utils.restoreScroll(),this.observe.image=!1,this.events.startDetectChanges(),this.placeholder.enable(),this.code.sync()}}},indent:function(){return{increase:function(){if(this.list.get()){var e=t(this.selection.current()).closest("li"),i=e.closest("ul, ol",this.core.editor()[0]),r=e.closest("li").prev();if(0!==r.length&&"LI"===r[0].tagName)if(this.buffer.set(),this.utils.isCollapsed()){var n=i[0].tagName,o=t("<"+n+" />");this.selection.save();var s=r.find("ol").first();1===s.length?s.append(e):(n=i[0].tagName,(o=t("<"+n+" />")).append(e),r.append(o)),this.selection.restore()}else document.execCommand("indent"),this.selection.save(),this.indent.removeEmpty(),this.indent.normalize(),this.selection.restore()}},decrease:function(){if(this.list.get()){t(this.selection.current()).closest("li").closest("ul, ol",this.core.editor()[0]),this.buffer.set(),document.execCommand("outdent");var e=t(this.selection.current()).closest("li",this.core.editor()[0]);if(this.utils.isCollapsed()&&this.indent.repositionItem(e),0===e.length){document.execCommand("formatblock",!1,"p");var i=(e=t(this.selection.current())).next();0!==i.length&&"BR"===i[0].tagName&&i.remove()}this.selection.save(),this.indent.removeEmpty(),this.indent.normalize(),this.selection.restore()}},repositionItem:function(t){var e=t.next();0===e.length||"UL"===e[0].tagName&&"OL"===e[0].tagName||t.append(e);var i=t.prev();0!==i.length&&"LI"!==i[0].tagName&&(this.selection.save(),t.parents("li",this.core.editor()[0]).after(t),this.selection.restore())},normalize:function(){this.core.editor().find("li").each(t.proxy(function(e,i){var r=t(i),n="";0!==this.opts.keepStyleAttr.length&&(n=","+this.opts.keepStyleAttr.join(",")),r.find(this.opts.inlineTags.join(",")).not("img"+n).removeAttr("style");var o=r.parent();if(0===o.length||"LI"!==o[0].tagName){var s=r.next();0===s.length||"UL"!==s[0].tagName&&"OL"!==s[0].tagName||r.append(s)}else o.after(r)},this))},removeEmpty:function(e){var i=this.core.editor().find("ul, ol"),r=this.core.editor().find("li");r.each(t.proxy(function(t,e){this.indent.removeItemEmpty(e)},this)),i.each(t.proxy(function(t,e){this.indent.removeItemEmpty(e)},this)),r.each(t.proxy(function(t,e){this.indent.removeItemEmpty(e)},this))},removeItemEmpty:function(e){var i=e.innerHTML.replace(/[\t\s\n]/g,"");""===(i=i.replace(/<span><\/span>/g,""))&&t(e).remove()}}},inline:function(){return{format:function(t,e,i,r){if(!this.utils.isCurrentOrParent(["PRE","CODE"])){var n=this.inline.getParams(e,i,r);t=this.inline.arrangeTag(t),this.placeholder.hide(),this.buffer.set(),this.utils.isCollapsed()?this.inline.formatCollapsed(t,n):this.inline.formatUncollapsed(t,n)}},formatCollapsed:function(e,i){var r,n=this.selection.inline();if(n){var o=n.tagName.toLowerCase();if(o===e)this.utils.isEmpty(n.innerHTML)?(this.caret.after(n),t(n).remove()):(s=this.inline.insertBreakpoint(n,o),this.caret.after(s));else if(0===t(n).closest(e).length)r=this.inline.insertInline(e),r=this.inline.setParams(r,i);else{var s=this.inline.insertBreakpoint(n,o);this.caret.after(s)}}else r=this.inline.insertInline(e),r=this.inline.setParams(r,i)},formatUncollapsed:function(e,i){this.selection.save();var r=this.inline.getClearedNodes();this.inline.setNodesStriked(r,e,i),this.selection.restore(),document.execCommand("strikethrough"),this.selection.saveInstant();var n=this;this.core.editor().find("strike").each(function(){var r=n.utils.replaceToTag(this,e);n.inline.setParams(r[0],i);var o=r.find(e),s=r.parent(),a=s.parent();if(0!==a.length&&a[0].tagName.toLowerCase()===e&&a.html()==s[0].outerHTML)return r.replaceWith(function(){return t(this).contents()}),void a.replaceWith(function(){return t(this).contents()});0!==o.length&&n.inline.cleanInsideOrParent(o,i),s.html()==r[0].outerHTML&&n.inline.cleanInsideOrParent(s,i),n.detect.isFirefox()&&n.core.editor().find(e+":empty").remove()}),this.selection.restoreInstant()},cleanInsideOrParent:function(t,e){if(e)for(var i in e.data)this.inline.removeSpecificAttr(t,i,e.data[i])},getClearedNodes:function(){for(var e=this.selection.nodes(),i=[],r=e.length,n=0,o=0;o<r;o++)if(t(e[o]).hasClass("redactor-selection-marker")){n=o+2;break}for(o=0;o<r;o++)o>=n&&!this.utils.isBlockTag(e[o].tagName)&&i.push(e[o]);return i},isConvertableAttr:function(e,i,r){var n=t(e).attr(i);if(n)if("style"===i){for(var o=(r=t.trim(r).replace(/;$/,"")).split(";"),s=0,a=0;a<o.length;a++){var l=o[a].split(":"),c=t.trim(l[0]),d=t.trim(l[1]);if(-1!==c.search(/color/)){var h=t(e).css(c);!h||h!==d&&this.utils.rgb2hex(h)!==d||s++}else t(e).css(c)===d&&s++}if(s===o.length)return 1}else if(n===r)return 1;return 0},isConvertable:function(t,e,i,r){if(e===i){if(!r)return!0;var n=0;for(var o in r.data)n+=this.inline.isConvertableAttr(t,o,r.data[o]);if(n===Object.keys(r.data).length)return!0}return!1},setNodesStriked:function(e,i,r){for(var n=0;n<e.length;n++){var o=e[n].tagName?e[n].tagName.toLowerCase():void 0,s=e[n].parentNode,a=s&&s.tagName?s.tagName.toLowerCase():void 0,l=this.inline.isConvertable(s,a,i,r);l&&t(s).replaceWith(function(){return t("<strike>").append(t(this).contents())}).attr("data-redactor-inline-converted"),(l=this.inline.isConvertable(e[n],o,i,r))&&t(e[n]).replaceWith(function(){return t("<strike>").append(t(this).contents())})}},insertBreakpoint:function(e,i){var r=document.createElement("span");r.id="redactor-inline-breakpoint",r=this.insert.node(r);var n=this.utils.isEndOfElement(e),o=this.utils.getOuterHtml(e),s=n?"":"<"+i+">";o=o.replace(/<span id="redactor-inline-breakpoint"><\/span>/i,"</"+i+">"+s);var a=t(o);return t(e).replaceWith(a),""!==s&&this.utils.cloneAttributes(e,a.last()),a.first()},insertInline:function(t){var e=document.createElement(t);return this.insert.node(e),this.caret.start(e),e},arrangeTag:function(t){var e=["b","bold","i","italic","underline","strikethrough","deleted","superscript","subscript"],i=["strong","strong","em","em","u","del","del","sup","sub"];t=t.toLowerCase();for(var r=0;r<e.length;r++)t===e[r]&&(t=i[r]);return t},getStyleParams:function(t){for(var e={},i=t.trim().replace(/;$/,"").split(";"),r=0;r<i.length;r++){var n=i[r].split(":");n&&(e[n[0].trim()]=n[1].trim())}return e},getParams:function(t,e,i){var r=!1,n="toggle";return"object"==typeof t?(r=t,n=void 0!==e?e:n):void 0!==t&&void 0!==e&&((r={})[t]=e,n=void 0!==i?i:n),!!r&&{func:n,data:r}},setParams:function(e,i){if(i)for(var r in i.data){var n=t(e);"style"===r?(e=this.inline[i.func+"Style"](i.data[r],e),n.attr("data-redactor-style-cache",n.attr("style"))):e="class"===r?this.inline[i.func+"Class"](i.data[r],e):"remove"===i.func?this.inline[i.func+"Attr"](r,e):this.inline[i.func+"Attr"](r,i.data[r],e),"style"===r&&"SPAN"===e.tagName&&n.attr("data-redactor-span",!0)}return e},eachInline:function(t,e){var i,r=void 0===t?this.selection.inlines():[t];if(r)for(var n=0;n<r.length;n++)i=e(r[n])[0];return i},replaceClass:function(e,i){return this.inline.eachInline(i,function(i){return t(i).removeAttr("class").addClass(e)})},toggleClass:function(e,i){return this.inline.eachInline(i,function(i){return t(i).toggleClass(e)})},addClass:function(e,i){return this.inline.eachInline(i,function(i){return t(i).addClass(e)})},removeClass:function(e,i){return this.inline.eachInline(i,function(i){return t(i).removeClass(e)})},removeAllClass:function(e){return this.inline.eachInline(e,function(e){return t(e).removeAttr("class")})},replaceAttr:function(e,i,r){return this.inline.eachInline(r,function(i){return t(i).removeAttr(e).attr(e.value)})},toggleAttr:function(e,i,r){return this.inline.eachInline(r,function(i){return t(i).attr(e)?t(i).removeAttr(e):t(i).attr(e.value)})},addAttr:function(e,i,r){return this.inline.eachInline(r,function(r){return t(r).attr(e,i)})},removeAttr:function(e,i){return this.inline.eachInline(i,function(i){var r=t(i);return r.removeAttr(e),"style"===e&&r.removeAttr("data-redactor-style-cache"),r})},removeAllAttr:function(e){return this.inline.eachInline(e,function(e){for(var i=t(e),r=e.attributes.length,n=0;n<r;n++)i.removeAttr(e.attributes[n].name);return i})},removeSpecificAttr:function(e,i,r){var n=t(e);if("style"===i){var o=r.split(":")[0].trim();n.css(o,""),this.utils.removeEmptyAttr(e,"style")&&n.removeAttr("data-redactor-style-cache")}else n.removeAttr(i)[0]},hasParentStyle:function(t){var e=t.parent();return 1===e.length&&e[0].tagName===t[0].tagName&&e.html()===t[0].outerHTML&&e},addParentStyle:function(e){var i=this.inline.hasParentStyle(e);if(i){var r=this.inline.getStyleParams(e.attr("style"));i.css(r),i.attr("data-redactor-style-cache",i.attr("style")),e.replaceWith(function(){return t(this).contents()})}else e.attr("data-redactor-style-cache",e.attr("style"));return e},replaceStyle:function(e,i){e=this.inline.getStyleParams(e);var r=this;return this.inline.eachInline(i,function(i){var n=t(i);n.removeAttr("style").css(e);var o=n.attr("style");return o&&n.attr("style",o.replace(/"/g,"'")),r.inline.addParentStyle(n)})},toggleStyle:function(e,i){e=this.inline.getStyleParams(e);var r=this;return this.inline.eachInline(i,function(i){var n=t(i);for(var o in e){var s=e[o],a=n.css(o);(a=r.utils.isRgb(a)?r.utils.rgb2hex(a):a.replace(/"/g,""))===(s=r.utils.isRgb(s)?r.utils.rgb2hex(s):s.replace(/"/g,""))?n.css(o,""):n.css(o,s)}var l=n.attr("style");return l&&n.attr("style",l.replace(/"/g,"'")),r.utils.removeEmptyAttr(i,"style")?n.removeAttr("data-redactor-style-cache"):n=r.inline.addParentStyle(n),n})},addStyle:function(e,i){e=this.inline.getStyleParams(e);var r=this;return this.inline.eachInline(i,function(i){var n=t(i);n.css(e);var o=n.attr("style");return o&&n.attr("style",o.replace(/"/g,"'")),r.inline.addParentStyle(n)})},removeStyle:function(e,i){e=this.inline.getStyleParams(e);var r=this;return this.inline.eachInline(i,function(i){var n=t(i);for(var o in e)n.css(o,"");return r.utils.removeEmptyAttr(i,"style")?n.removeAttr("data-redactor-style-cache"):n.attr("data-redactor-style-cache",n.attr("style")),n})},removeAllStyle:function(e){return this.inline.eachInline(e,function(e){return t(e).removeAttr("style").removeAttr("data-redactor-style-cache")})},removeStyleRule:function(e){var i=this.selection.parent(),r=this.selection.inlines();this.buffer.set(),i&&"SPAN"===i.tagName&&this.inline.removeStyleRuleAttr(t(i),e);for(var n=0;n<r.length;n++){var o=r[n],s=t(o);-1==t.inArray(o.tagName.toLowerCase(),this.opts.inlineTags)||s.hasClass("redactor-selection-marker")||this.inline.removeStyleRuleAttr(s,e)}},removeStyleRuleAttr:function(t,e){t.css(e,""),this.utils.removeEmptyAttr(t,"style")?t.removeAttr("data-redactor-style-cache"):t.attr("data-redactor-style-cache",t.attr("style"))},update:function(t,e,i,r){t=this.inline.arrangeTag(t);var n=this.inline.getParams(e,i,r),o=this.selection.inlines(),s=[];if(o)for(var a=0;a<o.length;a++){var l=o[a];"*"!==t&&l.tagName.toLowerCase()!==t||s.push(this.inline.setParams(l,n))}return s},removeFormat:function(){this.selection.save();for(var e=this.inline.getClearedNodes(),i=0;i<e.length;i++)1===e[i].nodeType&&t(e[i]).replaceWith(function(){return t(this).contents()});this.selection.restore()}}},insert:function(){return{set:function(t){this.placeholder.hide(),this.code.set(t),this.focus.end(),this.placeholder.enable()},html:function(e,i){this.placeholder.hide(),this.core.editor().focus();var r=this.selection.block(),n=this.selection.inline();void 0===i&&(i=this.clean.getCurrentType(e,!0),e=this.clean.onPaste(e,i,!0)),e=t.parseHTML(e);var o=t(e).last(),s=this.selection.get(),a=this.selection.range(s);if(a.deleteContents(),this.selection.update(s,a),i.lists){var l=t(e);if(0!==l.length&&("UL"===l[0].tagName||"OL"===l[0].tagName))return void this.insert.appendLists(r,l)}if(i.blocks&&r)if(this.utils.isSelectAll())this.core.editor().html(e),this.focus.end();else{var c=this.utils.breakBlockTag();!1===c?this.insert.placeHtml(e):(t(e).children().last().append(this.marker.get()),"start"===c.type?c.$block.before(e):c.$block.after(e),this.selection.restore(),this.core.editor().find("p").each(function(){""===t.trim(this.innerHTML)&&t(this).remove()}))}else{if(n){var d=t("<div/>").html(e);d.find(n.tagName.toLowerCase()).each(function(){t(this).contents().unwrap()}),e=d.html(),e=t.parseHTML(e),o=t(e).last()}if(this.utils.isSelectAll()){var h=t(this.opts.emptyHtml);this.core.editor().html("").append(h),h.html(e),this.caret.end(h)}else this.insert.placeHtml(e)}this.utils.disableSelectAll(),i.pre&&this.clean.cleanPre(),this.caret.end(o),this.linkify.format()},text:function(e){e=e.toString(),e=t.trim(e);var i=document.createElement("div");if(i.innerHTML=e,void 0!==(e=i.textContent||i.innerText)){this.placeholder.hide(),this.core.editor().focus();var r=this.selection.blocks();if(e=e.replace(/\n/g," "),this.utils.isSelectAll()){var n=t(this.opts.emptyHtml);this.core.editor().html("").append(n),n.html(e),this.caret.end(n)}else{var o=this.selection.get(),s=document.createTextNode(e);if(o.getRangeAt&&o.rangeCount){var a=o.getRangeAt(0);a.deleteContents(),a.insertNode(s),a.setStartAfter(s),a.collapse(!0),this.selection.update(o,a)}r.length>1&&(t(s).wrap("<p>"),this.caret.after(s))}this.utils.disableSelectAll(),this.linkify.format(),this.clean.normalizeCurrentHeading()}},raw:function(t){this.placeholder.hide(),this.core.editor().focus();var e=this.selection.get(),i=this.selection.range(e);i.deleteContents();var r=document.createElement("div");r.innerHTML=t;for(var n,o,s=document.createDocumentFragment();n=r.firstChild;)o=s.appendChild(n);i.insertNode(s),o&&((i=i.cloneRange()).setStartAfter(o),i.collapse(!0),e.removeAllRanges(),e.addRange(i))},node:function(e,i){this.placeholder.hide(),void 0!==this.start&&this.core.editor().focus(),e=e[0]||e;var r=this.selection.block(),n=this.utils.isBlockTag(e.tagName),o=!0;if(this.utils.isSelectAll())n?this.core.editor().html(e):this.core.editor().html(t("<p>").html(e)),this.code.sync();else if(n&&r){var s=this.utils.breakBlockTag();!1===s?this.insert.placeNode(e,i):("start"===s.type?s.$block.before(e):s.$block.after(e),this.core.editor().find("p:empty").remove())}else o=this.insert.placeNode(e,i);return this.utils.disableSelectAll(),o&&this.caret.end(e),e},appendLists:function(e,i){var r,n=t(e),o=this.utils.isEmpty(e.innerHTML);if(o||this.utils.isEndOfElement(e))r=n,i.find("li").each(function(){r.after(this),r=t(this)}),o&&n.remove();else if(this.utils.isStartOfElement(e))i.find("li").each(function(){n.before(this),r=t(this)});else{var s=this.selection.extractEndOfNode(e);n.after(t("<li>").append(s)),n.append(i),r=i}this.marker.remove(),r&&this.caret.end(r),this.linkify.format()},placeHtml:function(e){var i=document.createElement("span");i.id="redactor-insert-marker",i=this.insert.node(i),t(i).before(e),this.selection.restore(),this.caret.after(i),t(i).remove()},placeNode:function(t,e){var i=this.selection.get(),r=this.selection.range(i);if(null==r)return!1;!1!==e&&r.deleteContents(),r.insertNode(t),r.collapse(!1),this.selection.update(i,r)},nodeToPoint:function(e,i){if(this.placeholder.hide(),i=i[0]||i,this.utils.isEmpty())return i=this.utils.isBlock(i)?i:t("<p />").append(i),this.core.editor().html(i),i;var r,n=e.clientX,o=e.clientY;if(document.caretPositionFromPoint){var s=document.caretPositionFromPoint(n,o);(r=document.getSelection().getRangeAt(0)).setStart(s.offsetNode,s.offset),r.collapse(!0),r.insertNode(i)}else if(document.caretRangeFromPoint)(r=document.caretRangeFromPoint(n,o)).insertNode(i);else if(void 0!==document.body.createTextRange){(r=document.body.createTextRange()).moveToPoint(n,o);var a=r.duplicate();a.moveToPoint(n,o),r.setEndPoint("EndToEnd",a),r.select()}return i},nodeToCaretPositionFromPoint:function(t,e){this.insert.nodeToPoint(t,e)},marker:function(){this.marker.insert()}}},keydown:function(){return{init:function(e){if(!this.rtePaste){var i=e.which,r=i>=37&&i<=40;if(this.keydown.ctrl=e.ctrlKey||e.metaKey,this.keydown.parent=this.selection.parent(),this.keydown.current=this.selection.current(),this.keydown.block=this.selection.block(),this.keydown.pre=this.utils.isTag(this.keydown.current,"pre"),this.keydown.blockquote=this.utils.isTag(this.keydown.current,"blockquote"),this.keydown.figcaption=this.utils.isTag(this.keydown.current,"figcaption"),this.keydown.figure=this.utils.isTag(this.keydown.current,"figure"),!1===this.core.callback("keydown",e))return e.preventDefault(),!1;if(this.shortcuts.init(e,i),this.keydown.checkEvents(r,i),this.keydown.setupBuffer(e,i),this.utils.isSelectAll()&&(i===this.keyCode.ENTER||i===this.keyCode.BACKSPACE||i===this.keyCode.DELETE))return e.preventDefault(),this.code.set(this.opts.emptyHtml),void this.events.changeHandler();if(this.keydown.addArrowsEvent(r),this.keydown.setupSelectAll(e,i),this.opts.enterKey||i!==this.keyCode.ENTER){if(this.opts.enterKey&&i===this.keyCode.DOWN&&this.keydown.onArrowDown(),this.opts.enterKey&&i===this.keyCode.UP&&this.keydown.onArrowUp(),("textarea"===this.opts.type||"div"===this.opts.type)&&this.keydown.current&&3===this.keydown.current.nodeType&&t(this.keydown.parent).hasClass("redactor-in")&&this.keydown.wrapToParagraph(),!this.keyup.lastShiftKey&&i===this.keyCode.SPACE&&(e.ctrlKey||e.shiftKey))return e.preventDefault(),this.keydown.onShiftSpace();if(i===this.keyCode.ENTER&&(e.ctrlKey||e.shiftKey))return e.preventDefault(),this.keydown.onShiftEnter(e);if(i===this.keyCode.ENTER&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey)return this.keydown.onEnter(e);if(i===this.keyCode.TAB||e.metaKey&&221===i||e.metaKey&&219===i)return this.keydown.onTab(e,i);if(this.detect.isFirefox()&&i===this.keyCode.BACKSPACE&&this.keydown.block&&"P"===this.keydown.block.tagName&&this.utils.isStartOfElement(this.keydown.block)&&0!==(n=t(this.keydown.block).prev()).length)return e.preventDefault(),n.append(this.marker.get()),n.append(t(this.keydown.block).html()),t(this.keydown.block).remove(),void this.selection.restore();if(i===this.keyCode.BACKSPACE||i===this.keyCode.DELETE){if(this.observe.image&&void 0!==this.observe.image&&0!==t("#redactor-image-box").length){e.preventDefault();var n=this.observe.image.closest("figure, p").prev();return this.image.remove(!1),this.observe.image=!1,void(n&&0!==n.length?this.caret.end(n):this.core.editor().focus())}this.keydown.onBackspaceAndDeleteBefore()}if(i===this.keyCode.DELETE){var o=t(this.keydown.block).next();if(this.utils.isEndOfElement(this.keydown.block)&&0!==o.length&&"FIGURE"===o[0].tagName)return o.remove(),!1;if(this.keydown.block&&"LI"===this.keydown.block.tagName&&this.keydown.block){var s=t(this.keydown.block).parents("ul, ol").last(),a=s.next();if(this.utils.isRedactorParent(s)&&this.utils.isEndOfElement(s)&&0!==a.length&&("UL"===a[0].tagName||"OL"===a[0].tagName))return e.preventDefault(),s.append(a.contents()),a.remove(),!1}if(this.utils.isEndOfElement(this.keydown.block)&&0!==o.length&&"PRE"===o[0].tagName)return t(this.keydown.block).append(o.text()),o.remove(),!1}if(i===this.keyCode.DELETE&&0!==t("#redactor-image-box").length&&this.image.remove(),i===this.keyCode.BACKSPACE){if(this.detect.isFirefox()&&this.line.removeOnBackspace(e),this.list.combineAfterAndBefore(this.keydown.block))return void e.preventDefault();var l=this.selection.block();if(l&&"LI"===l.tagName&&this.utils.isCollapsed()&&this.utils.isStartOfElement())return this.indent.decrease(),void e.preventDefault();this.keydown.removeInvisibleSpace(),this.keydown.removeEmptyListInTable(e)}i!==this.keyCode.BACKSPACE&&i!==this.keyCode.DELETE||this.keydown.onBackspaceAndDeleteAfter(e)}else{e.preventDefault();var c=this.selection.get(),d=this.selection.range(c);d.collapsed||d.deleteContents()}}},onShiftSpace:function(){return this.buffer.set(),this.insert.raw("&nbsp;"),!1},onShiftEnter:function(t){return this.buffer.set(),this.keydown.pre?this.keydown.insertNewLine(t):this.insert.raw("<br>")},onBackspaceAndDeleteBefore:function(){this.utils.saveScroll()},onBackspaceAndDeleteAfter:function(e){setTimeout(t.proxy(function(){this.code.syncFire=!1,this.keydown.removeEmptyLists();var t="";0!==this.opts.keepStyleAttr.length&&(t=","+this.opts.keepStyleAttr.join(",")),this.core.editor().find("*[style]").not("img, figure, iframe, #redactor-image-box, #redactor-image-editter, [data-redactor-style-cache], [data-redactor-span]"+t).removeAttr("style"),this.keydown.formatEmpty(e),this.code.syncFire=!0},this),1)},onEnter:function(e){if(!1===this.core.callback("enter",e))return e.preventDefault(),!1;if(this.keydown.blockquote&&!0===this.keydown.exitFromBlockquote(e))return!1;if(this.keydown.pre)return this.keydown.insertNewLine(e);if(this.keydown.blockquote||this.keydown.figcaption)return this.keydown.insertBreakLine(e);if(this.keydown.figure)setTimeout(t.proxy(function(){this.keydown.replaceToParagraph("FIGURE")},this),1);else if(this.keydown.block){if(setTimeout(t.proxy(function(){this.keydown.replaceToParagraph("DIV")},this),1),"LI"===this.keydown.block.tagName){var i=this.selection.current(),r=t(i).closest("li",this.$editor[0]),n=r.parents("ul,ol",this.$editor[0]).last();if(0!==r.length&&this.utils.isEmpty(r.html())&&0===n.next().length&&this.utils.isEmpty(n.find("li").last().html())){n.find("li").last().remove();var o=t(this.opts.emptyHtml);return n.after(o),this.caret.start(o),!1}}}else if(!this.keydown.block)return this.keydown.insertParagraph(e);this.detect.isFirefox()&&this.utils.isInline(this.keydown.parent)?this.keydown.insertBreakLine(e):this.opts.keepInlineOnEnter||setTimeout(t.proxy(function(){var e=this.selection.inline();if(e&&this.utils.isEmpty(e.innerHTML)){var i=this.selection.block();t(e).remove();var r=document.createRange();r.setStart(i,0);var n=document.createTextNode("​");r.insertNode(n),r.setStartAfter(n),r.collapse(!0);var o=window.getSelection();o.removeAllRanges(),o.addRange(r)}},this),1)},checkEvents:function(t,e){t||"click"!==this.core.getEvent()&&"arrow"!==this.core.getEvent()||(this.core.addEvent(!1),this.keydown.checkKeyEvents(e)&&this.buffer.set())},checkKeyEvents:function(e){var i=this.keyCode,r=[i.BACKSPACE,i.DELETE,i.ENTER,i.ESC,i.TAB,i.CTRL,i.META,i.ALT,i.SHIFT];return-1===t.inArray(e,r)},addArrowsEvent:function(t){t&&("click"!==this.core.getEvent()&&"arrow"!==this.core.getEvent()?this.core.addEvent("arrow"):this.core.addEvent(!1))},setupBuffer:function(t,e){return this.keydown.ctrl&&90===e&&!t.shiftKey&&!t.altKey&&this.sBuffer.length?(t.preventDefault(),void this.buffer.undo()):this.keydown.ctrl&&90===e&&t.shiftKey&&!t.altKey&&0!==this.sRebuffer.length?(t.preventDefault(),void this.buffer.redo()):void(this.keydown.ctrl||e!==this.keyCode.SPACE&&e!==this.keyCode.BACKSPACE&&e!==this.keyCode.DELETE&&(e!==this.keyCode.ENTER||t.ctrlKey||t.shiftKey)||this.buffer.set())},exitFromBlockquote:function(e){if(this.utils.isEndOfElement(this.keydown.blockquote)&&-1!==this.clean.removeSpacesHard(t(this.keydown.blockquote).html()).search(/(<br\s?\/?>){1}$/i)){e.preventDefault(),t(this.keydown.blockquote).children().last().filter("br").remove(),t(this.keydown.blockquote).children().last().filter("span").remove();var i=t(this.opts.emptyHtml);return t(this.keydown.blockquote).after(i),this.caret.start(i),!0}},onArrowDown:function(){for(var t=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption],e=0;e<t.length;e++)if(t[e])return this.keydown.insertAfterLastElement(t[e]),!1},onArrowUp:function(){for(var t=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption],e=0;e<t.length;e++)if(t[e])return this.keydown.insertBeforeFirstElement(t[e]),!1},insertAfterLastElement:function(e){if(this.utils.isEndOfElement(e)){var i=this.core.editor().contents().last();if(0===("FIGCAPTION"===e.tagName?t(this.keydown.block).parent().next():t(this.keydown.block).next()).length)if(0!==i.length||i[0]===e){var r=t(this.opts.emptyHtml);"FIGCAPTION"===e.tagName?t(e).parent().after(r):t(e).after(r),this.caret.start(r)}else this.caret.start(i)}},insertBeforeFirstElement:function(e){if(this.utils.isStartOfElement()&&!(this.core.editor().contents().length>1&&this.core.editor().contents().first()[0]!==e)){var i=t(this.opts.emptyHtml);t(e).before(i),this.caret.start(i)}},onTab:function(t,e){if(!this.opts.tabKey)return!0;var i=this.keydown.block&&"LI"===this.keydown.block.tagName;if(this.utils.isEmpty(this.code.get())||!i&&!this.keydown.pre&&!1===this.opts.tabAsSpaces)return!0;t.preventDefault(),this.buffer.set();var r,n=i&&this.utils.isStartOfElement(this.keydown.block);return this.keydown.pre&&!t.shiftKey?(r=this.opts.preSpaces?document.createTextNode(Array(this.opts.preSpaces+1).join(" ")):document.createTextNode("\t"),this.insert.node(r)):!1===this.opts.tabAsSpaces||n?t.metaKey&&219===e?this.indent.decrease():t.metaKey&&221===e?this.indent.increase():t.shiftKey?this.indent.decrease():this.indent.increase():(r=document.createTextNode(Array(this.opts.tabAsSpaces+1).join(" ")),this.insert.node(r)),!1},setupSelectAll:function(t,e){this.keydown.ctrl&&65===e?this.utils.enableSelectAll():e===this.keyCode.LEFT_WIN||this.keydown.ctrl||this.utils.disableSelectAll()},insertNewLine:function(t){t.preventDefault();var e=document.createTextNode("\n"),i=this.selection.get(),r=this.selection.range(i);return r.deleteContents(),r.insertNode(e),this.caret.after(e),!1},insertParagraph:function(t){t.preventDefault();var e=document.createElement("p");e.innerHTML="<br>";var i=this.selection.get(),r=this.selection.range(i);return r.deleteContents(),r.insertNode(e),this.caret.start(e),!1},insertBreakLine:function(t){return this.keydown.insertBreakLineProcessing(t)},insertDblBreakLine:function(t){return this.keydown.insertBreakLineProcessing(t,!0)},insertBreakLineProcessing:function(t,e){t.stopPropagation();var i=document.createElement("br");if(this.insert.node(i),!0===e){var r=document.createElement("br");this.insert.node(r),this.caret.after(r)}else this.caret.after(i);return!1},wrapToParagraph:function(){var e=t(this.keydown.current),i=t("<p>").append(e.clone());e.replaceWith(i);var r=t(i).next();void 0!==r[0]&&"BR"===r[0].tagName&&r.remove(),this.caret.end(i)},replaceToParagraph:function(e){var i=this.selection.block(),r=t(i).prev(),n=i.innerHTML.replace(/<br\s?\/?>/gi,"");if(i.tagName===e&&this.utils.isEmpty(n)&&!t(i).hasClass("redactor-in"))return o=document.createElement("p"),t(i).replaceWith(o),this.keydown.setCaretToParagraph(o),!1;if("P"===i.tagName)return t(i).removeAttr("class").removeAttr("style"),this.detect.isIe()&&this.utils.isEmpty(n)&&this.utils.isInline(this.keydown.parent)&&t(i).on("input",t.proxy(function(){var e=this.selection.parent();if(this.utils.isInline(e)){var r=t(e).html();t(i).html(r),this.caret.end(i)}t(i).off("keyup")},this)),!1;if(r.hasClass(this.opts.videoContainerClass)){r.removeAttr("class");var o=document.createElement("p");return r.replaceWith(o),this.keydown.setCaretToParagraph(o),!1}},setCaretToParagraph:function(t){var e=document.createRange();e.setStart(t,0);var i=document.createTextNode("​");e.insertNode(i),e.setStartAfter(i),e.collapse(!0);var r=window.getSelection();r.removeAllRanges(),r.addRange(e)},removeInvisibleSpace:function(){var e=t(this.keydown.current);0===e.text().search(/^\u200B$/g)&&e.remove()},removeEmptyListInTable:function(e){var i=t(this.keydown.current),r=t(this.keydown.parent),n=i.closest("td",this.$editor[0]);if(0!==n.length&&i.closest("li",this.$editor[0])&&1===r.children("li").length){if(!this.utils.isEmpty(i.text()))return;e.preventDefault(),i.remove(),r.remove(),this.caret.start(n)}},removeEmptyLists:function(){var e=function(){""===t.trim(this.innerHTML).replace(/\/t\/n/g,"")&&t(this).remove()};this.core.editor().find("li").each(e),this.core.editor().find("ul, ol").each(e)},formatEmpty:function(e){var i=t.trim(this.core.editor().html());if(this.utils.isEmpty(i))return e.preventDefault(),"inline"===this.opts.type||"pre"===this.opts.type?(this.core.editor().html(this.marker.html()),this.selection.restore()):(this.core.editor().html(this.opts.emptyHtml),this.focus.start()),!1}}},keyup:function(){return{init:function(e){if(!this.rtePaste){var i=e.which;if(this.keyup.block=this.selection.block(),this.keyup.current=this.selection.current(),this.keyup.parent=this.selection.parent(),this.keyup.lastShiftKey=e.shiftKey,!1===this.core.callback("keyup",e))return e.preventDefault(),!1;if(i===this.keyCode.ENTER&&this.keyup.block&&"FIGURE"===this.keyup.block.tagName){var r=t(this.keyup.block).prev();if(0!==r.length&&"FIGURE"===r[0].tagName){var n=this.utils.replaceToTag(r,"p");return void this.caret.start(n)}}if(i===this.keyCode.BACKSPACE||i===this.keyCode.DELETE){if(this.utils.isSelectAll())return this.focus.start(),void this.toolbar.setUnfixed();if(this.keyup.block&&this.keydown.block&&"FIGURE"===this.keyup.block.tagName&&this.utils.isStartOfElement(this.keydown.block)){e.preventDefault(),this.selection.save(),t(this.keyup.block).find("figcaption").remove(),t(this.keyup.block).find("img").first().remove(),this.utils.replaceToTag(this.keyup.block,"p");var o=this.marker.find();return t("html, body").animate({scrollTop:o.position().top+20},500),void this.selection.restore()}if(this.keyup.block&&"P"===this.keyup.block.tagName){var s=t(this.keyup.block).find("img").length;""===t(this.keyup.block).text().replace(/\u200B/g,"")&&0!==s&&this.utils.replaceToTag(this.keyup.block,"figure")}this.keyup.block&&"FIGURE"===this.keyup.block.tagName&&0===t(this.keyup.block).find("img").length&&(this.selection.save(),this.utils.replaceToTag(this.keyup.block,"p"),this.selection.restore())}this.linkify.isKey(i)&&(this.selection.save(),this.linkify.format(),this.selection.restore())}}}},lang:function(){return{load:function(){this.opts.curLang=this.opts.langs[this.opts.lang]},get:function(t){return void 0!==this.opts.curLang[t]?this.opts.curLang[t]:""}}},line:function(){return{insert:function(){this.buffer.set(),this.insert.html(this.line.getLineHtml());var t=this.core.editor().find("#redactor-hr-tmp-id");return t.removeAttr("id"),this.core.callback("insertedLine",t),t},getLineHtml:function(){var t='<hr id="redactor-hr-tmp-id" />';return!this.detect.isFirefox()&&this.utils.isEmpty()&&(t+="<p>"+this.opts.emptyHtml+"</p>"),t},removeOnBackspace:function(e){if(this.utils.isCollapsed()){var i=t(this.selection.block());if(0!==i.length&&this.utils.isStartOfElement(i)){var r=i.prev();r&&0!==r.length&&"HR"===r[0].tagName&&(e.preventDefault(),r.remove())}}}}},link:function(){return{get:function(){return t(this.selection.inlines("a"))},is:function(){var e=this.selection.nodes(),i=t(this.selection.current()).closest("a",this.core.editor()[0]);return!(0===i.length||e.length>1)&&i},unlink:function(t){void 0!==t&&t.preventDefault&&t.preventDefault(),this.buffer.set();var e=this.selection.inlines("a");if(0!==e.length){var i=this.link.replaceLinksToText(e);this.observe.closeAllTooltip(),this.core.callback("deletedLink",i)}},insert:function(e,i){var r=this.link.is();if(!0!==i&&!1===(e=this.link.buildLinkFromObject(r,e)))return!1;if(this.buffer.set(),e=this.core.callback("beforeInsertingLink",e),!1===r){r=t("<a />"),r=this.link.update(r,e);var n=(r=t(this.insert.node(r))).parent();!1===this.utils.isRedactorParent(n)&&r.wrap("<p>"),n.hasClass("redactor-unlink")&&n.replaceWith(function(){return t(this).contents()}),this.caret.after(r),this.core.callback("insertedLink",r)}else r=this.link.update(r,e),this.caret.after(r);return r},update:function(t,e){return t.text(e.text),t.attr("href",e.url),this.link.target(t,e.target),t},target:function(t,e){return e?t.attr("target","_blank"):t.removeAttr("target")},show:function(e){void 0!==e&&e.preventDefault&&e.preventDefault(),this.observe.closeAllTooltip();var i=this.link.is();this.link.buildModal(i);var r=this.link.buildLinkFromElement(i);r.url=this.link.removeSelfHostFromUrl(r.url),this.opts.linkNewTab&&!i&&(r.target=!0),this.link.setModalValues(r),this.modal.show(),this.detect.isDesktop()&&t("#redactor-link-url").focus()},setModalValues:function(e){t("#redactor-link-blank").prop("checked",e.target),t("#redactor-link-url").val(e.url),t("#redactor-link-url-text").val(e.text)},buildModal:function(e){this.modal.load("link",this.lang.get(!1===e?"link-insert":"link-edit"),600),this.modal.getActionButton().text(this.lang.get(!1===e?"insert":"save")).on("click",t.proxy(this.link.callback,this))},callback:function(){var t=this.link.buildLinkFromModal();if(!1===t)return!1;this.modal.close(),this.link.insert(t,!0)},cleanUrl:function(e){return void 0===e?"":t.trim(e.replace(/[^\W\w\D\d+&\'@#/%?=~_|!:,.;\(\)]/gi,""))},cleanText:function(e){return void 0===e?"":t.trim(e.replace(/(<([^>]+)>)/gi,""))},getText:function(t){return""===t.text&&""!==t.url?this.link.truncateUrl(t.url.replace(/<|>/g,"")):t.text},isUrl:function(t){return!!new RegExp("^((https?|ftp):\\/\\/)?(([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.?)+[a-z]{2,}(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(t)&&t},isMailto:function(t){return-1!==t.search("@")&&!1===/(http|ftp|https):\/\//i.test(t)},isEmpty:function(t){return""===t.url||""===t.text&&""===t.url},truncateUrl:function(t){return t.length>this.opts.linkSize?t.substring(0,this.opts.linkSize)+"...":t},parse:function(t){return this.link.isMailto(t.url)?t.url="mailto:"+t.url.replace("mailto:",""):0!==t.url.search("#")&&this.opts.linkValidation&&(t.url=this.link.isUrl(t.url)?"http://"+t.url.replace(/(ftp|https?):\/\//gi,""):t.url),!this.link.isEmpty(t)&&!1!==t.url&&t},buildLinkFromModal:function(){var e={};return e.url=this.link.cleanUrl(t("#redactor-link-url").val()),e.text=this.link.cleanText(t("#redactor-link-url-text").val()),e.text=this.link.getText(e),e.target=!!t("#redactor-link-blank").prop("checked"),this.link.parse(e)},buildLinkFromObject:function(t,e){return e.url=this.link.cleanUrl(e.url),e.text=void 0===e.text&&this.selection.is()?this.selection.text():this.link.cleanText(e.text),e.text=this.link.getText(e),e.target=!1===t?e.target:this.link.buildTarget(t),this.link.parse(e)},buildLinkFromElement:function(t){var e={url:"",text:this.selection.is()?this.selection.text():"",target:!1};return!1!==t&&(e.url=t.attr("href"),e.text=t.text(),e.target=this.link.buildTarget(t)),e},buildTarget:function(t){return void 0!==t.attr("target")&&"_blank"===t.attr("target")},removeSelfHostFromUrl:function(t){var e=self.location.href.replace("#","").replace(/\/$/i,"");return t.replace(/^\/\#/,"#").replace(e,"").replace("mailto:","")},replaceLinksToText:function(e){var i,r=t.each(e,function(e,r){var n=t(r),o=t('<span class="redactor-unlink" />').append(n.contents());return n.replaceWith(o),0===e&&(i=o),n});return 1===e.length&&this.selection.isCollapsed()&&this.caret.after(i),r}}},linkify:function(){return{isKey:function(t){return t===this.keyCode.ENTER||t===this.keyCode.SPACE},isLink:function(t){return t.nodeValue.match(this.opts.regexps.linkyoutube)||t.nodeValue.match(this.opts.regexps.linkvimeo)||t.nodeValue.match(this.opts.regexps.linkimage)||t.nodeValue.match(this.opts.regexps.url)},isFiltered:function(e,i){return 3===i.nodeType&&""!==t.trim(i.nodeValue)&&!t(i).parent().is("pre")&&this.linkify.isLink(i)},handler:function(e,i){var r=t(i),n=r.text(),o=n;o=o.match(this.opts.regexps.linkyoutube)||o.match(this.opts.regexps.linkvimeo)?this.linkify.convertVideoLinks(o):o.match(this.opts.regexps.linkimage)?this.linkify.convertImages(o):this.linkify.convertLinks(o),r.before(n.replace(n,o)).remove()},format:function(){if(this.opts.linkify&&!this.utils.isCurrentOrParent("pre")){this.core.editor().find(":not(iframe,img,a,pre,code,.redactor-unlink)").addBack().contents().filter(t.proxy(this.linkify.isFiltered,this)).each(t.proxy(this.linkify.handler,this));var e,i=this.core.editor().find(".redactor-linkify-object").each(t.proxy(function(i,r){return(e=t(r)).removeClass("redactor-linkify-object"),""===e.attr("class")&&e.removeAttr("class"),"A"===r.tagName&&this.core.callback("insertedLink",e),e},this));setTimeout(t.proxy(function(){this.code.sync(),this.core.callback("linkify",i)},this),100)}},convertVideoLinks:function(t){var e='<div class="'+this.opts.videoContainerClass+' redactor-linkify-object"><iframe class="redactor-linkify-object" width="500" height="281" src="',i='" frameborder="0" allowfullscreen></iframe></div>';return t.match(this.opts.regexps.linkyoutube)&&(t=t.replace(this.opts.regexps.linkyoutube,e+"//www.youtube.com/embed/$1"+i)),t.match(this.opts.regexps.linkvimeo)&&(t=t.replace(this.opts.regexps.linkvimeo,e+"//player.vimeo.com/video/$2"+i)),t},convertImages:function(t){var e=t.match(this.opts.regexps.linkimage);return e?t.replace(t,'<img src="'+e+'"  class="redactor-linkify-object" />'):t},convertLinks:function(e){var i=e.match(this.opts.regexps.url);if(!i)return e;for(var r=(i=t.grep(i,function(e,r){return t.inArray(e,i)===r})).length,n=0;n<r;n++){var o=i[n],s=o,a=null!==o.match(/(https?|ftp):\/\//i)?"":"http://";s.length>this.opts.linkSize&&(s=s.substring(0,this.opts.linkSize)+"..."),-1===s.search("%")&&(s=decodeURIComponent(s));var l="\\b";-1!==t.inArray(o.slice(-1),["/","&","="])&&(l="");var c=new RegExp("("+o.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+l+")","g"),d="";!1!==this.opts.pasteLinkTarget&&(d=' target="'+this.opts.pasteLinkTarget+'"'),e=e.replace(c,'<a href="'+a+t.trim(o)+'"'+d+' class="redactor-linkify-object">'+t.trim(s)+"</a>")}return e}}},list:function(){return{toggle:function(e){if(!this.utils.inBlocks(["table","td","th","tr"])){e=(e="unorderedlist"===(e="orderedlist"===e?"ol":e)?"ul":e).toLowerCase(),this.buffer.set(),this.selection.save();var i=this.list._getBlocks(),r=this.selection.block(),n=t(r).parents("ul, ol").last();return 0===i.length&&0!==n.length&&(i=[n.get(0)]),i=this.list._isUnformat(e,i)?this.list._unformat(e,i):this.list._format(e,i),this.selection.restore(),i}},get:function(){var e=this.selection.current(),i=t(e).closest("ul, ol",this.core.editor()[0]);return 0!==i.length&&i},combineAfterAndBefore:function(e){var i=t(e).prev(),r=t(e).next(),n=e&&"P"===e.tagName&&("<br>"===e.innerHTML||""===e.innerHTML),o=1===i.closest("ol, ul",this.core.editor()[0]).length&&1===r.closest("ol, ul",this.core.editor()[0]).length;return!(!n||!o||(i.children("li").last().append(this.marker.get()),i.append(r.contents()),this.selection.restore(),0))},_getBlocks:function(){for(var e=[],i=this.selection.blocks(),r=0;r<i.length;r++)t(i[r]).parent().hasClass("redactor-in")&&e.push(i[r]);return e},_isUnformat:function(t,e){for(var i=0,r=0;r<e.length;r++)if(3!==e[r].nodeType){var n=e[r].tagName.toLowerCase();n!==t&&"figure"!==n||i++}return i===e.length},_uniteBlocks:function(e,i){for(var r=0,n={0:[]},o=!1,s=0;s<e.length;s++){var a=t(e[s]).closest("th, td");0!==a.length?(a.get(0)!==o&&(n[++r]=[]),this.list._isUniteBlock(e[s],i)&&n[r].push(e[s])):this.list._isUniteBlock(e[s],i)?n[r].push(e[s]):n[++r]=[],o=a.get()}return n},_isUniteBlock:function(t,e){return 3===t.nodeType||-1!==e.indexOf(t.tagName.toLowerCase())},_createList:function(e,i,r){var n=i[i.length-1],o=t(n),s=t("<"+e+">");return o.after(s),s},_createListItem:function(e){var i=t("<li>");if(3===e.nodeType)i.append(e);else{var r=t(e);i.append(r.contents()),r.remove()}return i},_format:function(e,i){var r=this.list._uniteBlocks(i,["p","div","blockquote","pre","h1","h2","h3","h4","h5","h6","ul","ol"]),n=[];for(var o in r){for(var s=r[o],a=this.list._createList(e,r[o]),l=0;l<s.length;l++){var c;3===s[l].nodeType||"UL"!==s[l].tagName&&"OL"!==s[l].tagName?(c=this.list._createListItem(s[l]),a.append(c)):(c=t(s[l]).contents(),a.append(c))}n.push(a.get(0))}return n},_unformat:function(e,i){if(1===i.length){var r=t(i[0]),n=r.find("li"),o=this.selection.blocks(["li"]),s=this.selection.block(),a=t(s).closest("li");if(0===o.length&&0!==a.length&&(o=[a.get(0)]),o.length===n.length)return this.list._unformatEntire(i[0]);var l=this.list._getItemsPosition(n,o);if("Top"===l)return this.list._unformatAtSide("before",o,r);if("Bottom"===l)return o.reverse(),this.list._unformatAtSide("after",o,r);if("Middle"===l){var c=t(o[o.length-1]),d=!1,h=!1,u=t("<"+r.get(0).tagName.toLowerCase()+">");for(n.each(function(e,i){if(d){var r=t(i);r.children("ul, ol").length,0!==r.closest(".redactor-split-item").length||!1!==h&&0!==r.closest(h).length||r.addClass("redactor-split-item"),h=r}i===c.get(0)&&(d=!0)}),n.filter(".redactor-split-item").each(function(e,i){t(i).removeClass("redactor-split-item"),u.append(i)}),r.after(u),o.reverse(),g=0;g<o.length;g++){var p=t(o[g]),f=this.list._createUnformatContainer(p);r.after(f),f.find("ul, ol").remove(),p.remove()}return}}else for(var g=0;g<i.length;g++)3!==i[g].nodeType&&i[g].tagName.toLowerCase()===e&&this.list._unformatEntire(i[g])},_unformatEntire:function(e){var i=t(e);i.find("li").each(function(e,r){var n=t(r),o=this.list._createUnformatContainer(n);n.remove(),i.before(o)}.bind(this)),i.remove()},_unformatAtSide:function(e,i,r){for(var n=0;n<i.length;n++){var o=t(i[n]),s=this.list._createUnformatContainer(o);r[e](s);var a=s.find("ul, ol").first();o.append(a),a.each(function(e,r){var n=t(r),o=n.closest("li");o.get(0)===i[e]&&(n.unwrap(),o.addClass("r-unwrapped"))}),this.utils.isEmpty(o.html())&&o.remove()}r.find(".r-unwrapped").each(function(e){var i=t(e);""===i.html().trim()?i.remove():i.removeClass("r-unwrapped")})},_getItemsPosition:function(t,e){var i="Middle",r=e[0],n=e[e.length-1],o=t.first().get(0),s=t.last().get(0);return o===r&&s!==n?i="Top":o!==r&&s===n&&(i="Bottom"),i},_createUnformatContainer:function(e){var i=t("<p>");return i.append(e.contents()),i}}},marker:function(){return{get:function(t){t=void 0===t?1:t;var e=document.createElement("span");return e.id="selection-marker-"+t,e.className="redactor-selection-marker",e.innerHTML=this.opts.invisibleSpace,e},html:function(t){return this.utils.getOuterHtml(this.marker.get(t))},find:function(t){return t=void 0===t?1:t,this.core.editor().find("span#selection-marker-"+t)},insert:function(){var t=this.selection.get(),e=this.selection.range(t);this.marker.insertNode(e,this.marker.get(1),!0),e&&!1===e.collapsed&&this.marker.insertNode(e,this.marker.get(2),!1)},remove:function(){this.core.editor().find(".redactor-selection-marker").each(this.marker.iterateRemove)},insertNode:function(e,i,r){var n=this.selection.parent();if(null!==e&&0!==t(n).closest(".redactor-in").length){e=e.cloneRange();try{e.collapse(r),e.insertNode(i)}catch(t){this.focus.start()}}},iterateRemove:function(e,i){var r=t(i),n=r.text().replace(/\u200B/g,"");r.parent()[0],""===n?r.remove():r.replaceWith(function(){return t(this).contents()})}}},modal:function(){return{callbacks:{},templates:function(){this.opts.modal={"image-edit":String()+'<div class="redactor-modal-tab redactor-group" data-title="General"><div id="redactor-image-preview" class="redactor-modal-tab-side"></div><div class="redactor-modal-tab-area"><section><label>'+this.lang.get("title")+'</label><input type="text" id="redactor-image-title" /></section><section><label>'+this.lang.get("caption")+'</label><input type="text" id="redactor-image-caption" aria-label="'+this.lang.get("caption")+'" /></section><section><label>'+this.lang.get("link")+'</label><input type="text" id="redactor-image-link" aria-label="'+this.lang.get("link")+'" /></section><section><label class="redactor-image-position-option">'+this.lang.get("image-position")+'</label><select class="redactor-image-position-option" id="redactor-image-align" aria-label="'+this.lang.get("image-position")+'"><option value="none">'+this.lang.get("none")+'</option><option value="left">'+this.lang.get("left")+'</option><option value="center">'+this.lang.get("center")+'</option><option value="right">'+this.lang.get("right")+'</option></select></section><section><label class="checkbox"><input type="checkbox" id="redactor-image-link-blank" aria-label="'+this.lang.get("link-in-new-tab")+'"> '+this.lang.get("link-in-new-tab")+'</label></section><section><button id="redactor-modal-button-action">'+this.lang.get("insert")+'</button><button id="redactor-modal-button-cancel">'+this.lang.get("cancel")+'</button><button id="redactor-modal-button-delete" class="redactor-modal-button-offset">'+this.lang.get("delete")+"</button></section></div></div>",image:String()+'<div class="redactor-modal-tab" data-title="Upload"><section><div id="redactor-modal-image-droparea"></div></section></div>',file:String()+'<div class="redactor-modal-tab" data-title="Upload"><section><label>'+this.lang.get("filename")+' <span class="desc">('+this.lang.get("optional")+')</span></label><input type="text" id="redactor-filename" aria-label="'+this.lang.get("filename")+'" /><br><br></section><section><div id="redactor-modal-file-upload"></div></section></div>',link:String()+'<div class="redactor-modal-tab" data-title="General"><section><label>URL</label><input type="url" id="redactor-link-url" aria-label="URL" /></section><section><label>'+this.lang.get("text")+'</label><input type="text" id="redactor-link-url-text" aria-label="'+this.lang.get("text")+'" /></section><section><label class="checkbox"><input type="checkbox" id="redactor-link-blank"> '+this.lang.get("link-in-new-tab")+'</label></section><section><button id="redactor-modal-button-action">'+this.lang.get("insert")+'</button><button id="redactor-modal-button-cancel">'+this.lang.get("cancel")+"</button></section></div>"},t.extend(this.opts,this.opts.modal)},addCallback:function(t,e){this.modal.callbacks[t]=e},addTemplate:function(t,e){this.opts.modal[t]=e},getTemplate:function(t){return this.opts.modal[t]},getModal:function(){return this.$modalBody},getActionButton:function(){return this.$modalBody.find("#redactor-modal-button-action")},getCancelButton:function(){return this.$modalBody.find("#redactor-modal-button-cancel")},getDeleteButton:function(){return this.$modalBody.find("#redactor-modal-button-delete")},load:function(t,e,i){void 0!==this.$modalBox&&this.$modalBox.hasClass("open")||(this.modal.templateName=t,this.modal.width=i,this.modal.build(),this.modal.enableEvents(),this.modal.setTitle(e),this.modal.setDraggable(),this.modal.setContent(),void 0!==this.modal.callbacks[t]&&this.modal.callbacks[t].call(this))},show:function(){this.detect.isDesktop()||document.activeElement.blur(),this.selection.save(),this.modal.buildTabber(),this.detect.isMobile()&&(this.modal.width="96%"),setTimeout(t.proxy(this.modal.buildWidth,this),0),t(window).on("resize.redactor-modal",t.proxy(this.modal.buildWidth,this)),this.$modalOverlay.redactorAnimation("fadeIn",{duration:.25}),this.$modalBox.addClass("open").show(),this.$modal.redactorAnimation("fadeIn",{timing:"cubic-bezier(0.175, 0.885, 0.320, 1.105)"},t.proxy(function(){this.utils.saveScroll(),this.utils.disableBodyScroll(),this.core.callback("modalOpened",this.modal.templateName,this.$modal),t(document).off("focusin.modal"),this.$modal.find("input[type=text],input[type=url],input[type=email]").on("keydown.redactor-modal",t.proxy(this.modal.setEnter,this))},this))},buildWidth:function(){var e=t(window).height(),i=t(window).width(),r="number"==typeof this.modal.width;!r&&this.modal.width.match(/%$/)?this.$modal.css({width:this.modal.width,"margin-bottom":"16px"}):parseInt(this.modal.width)>i?this.$modal.css({width:"96%","margin-bottom":"2%"}):(r&&(this.modal.width+="px"),this.$modal.css({width:this.modal.width,"margin-bottom":"16px"}));var n=this.$modal.outerHeight(),o=e/2-n/2+"px";this.detect.isMobile()?o="2%":n>e&&(o="16px"),this.$modal.css("margin-top",o)},buildTabber:function(){this.modal.tabs=this.$modal.find(".redactor-modal-tab"),this.modal.tabs.length<2||(this.modal.$tabsBox=t('<div id="redactor-modal-tabber" />'),t.each(this.modal.tabs,t.proxy(function(e,i){var r=t('<a href="#" rel="'+e+'" />').text(t(i).attr("data-title"));r.on("click",t.proxy(this.modal.showTab,this)),0===e&&r.addClass("active"),this.modal.$tabsBox.append(r)},this)),this.$modalBody.prepend(this.modal.$tabsBox))},showTab:function(e){e.preventDefault();var i=t(e.target),r=i.attr("rel");return this.modal.tabs.hide(),this.modal.tabs.eq(r).show(),t("#redactor-modal-tabber").find("a").removeClass("active"),i.addClass("active"),!1},setTitle:function(t){this.$modalHeader.html(t)},setContent:function(){this.$modalBody.html(this.modal.getTemplate(this.modal.templateName)),this.modal.getCancelButton().on("mousedown",t.proxy(this.modal.close,this))},setDraggable:function(){void 0!==t.fn.draggable&&(this.$modal.draggable({handle:this.$modalHeader}),this.$modalHeader.css("cursor","move"))},setEnter:function(t){13===t.which&&(t.preventDefault(),this.modal.getActionButton().click())},build:function(){this.modal.buildOverlay(),this.$modalBox=t('<div id="redactor-modal-box"/>').hide(),this.$modal=t('<div id="redactor-modal" role="dialog" />'),this.$modalHeader=t('<div id="redactor-modal-header" />'),this.$modalClose=t('<button type="button" id="redactor-modal-close" aria-label="'+this.lang.get("close")+'" />').html("&times;"),this.$modalBody=t('<div id="redactor-modal-body" />'),this.$modal.append(this.$modalHeader),this.$modal.append(this.$modalBody),this.$modal.append(this.$modalClose),this.$modalBox.append(this.$modal),this.$modalBox.appendTo(document.body)},buildOverlay:function(){this.$modalOverlay=t('<div id="redactor-modal-overlay">').hide(),t("body").prepend(this.$modalOverlay)},enableEvents:function(){this.$modalClose.on("mousedown.redactor-modal",t.proxy(this.modal.close,this)),t(document).on("keyup.redactor-modal",t.proxy(this.modal.closeHandler,this)),this.core.editor().on("keyup.redactor-modal",t.proxy(this.modal.closeHandler,this)),this.$modalBox.on("click.redactor-modal",t.proxy(this.modal.close,this))},disableEvents:function(){this.$modalClose.off("mousedown.redactor-modal"),t(document).off("keyup.redactor-modal"),this.core.editor().off("keyup.redactor-modal"),this.$modalBox.off("click§.redactor-modal"),t(window).off("resize.redactor-modal")},closeHandler:function(t){t.which===this.keyCode.ESC&&this.modal.close(!1)},close:function(e){if(e){if("redactor-modal-button-cancel"!==t(e.target).attr("id")&&e.target!==this.$modalClose[0]&&e.target!==this.$modalBox[0])return;e.preventDefault()}this.$modalBox&&(this.selection.restore(),this.modal.disableEvents(),this.utils.enableBodyScroll(),this.utils.restoreScroll(),this.$modalOverlay.redactorAnimation("fadeOut",{duration:.4},t.proxy(function(){this.$modalOverlay.remove()},this)),this.$modal.redactorAnimation("fadeOut",{duration:.3,timing:"cubic-bezier(0.175, 0.885, 0.320, 1.175)"},t.proxy(function(){void 0!==this.$modalBox&&(this.$modalBox.remove(),this.$modalBox=void 0),this.core.callback("modalClosed",this.modal.templateName)},this)))}}},observe:function(){return{load:function(){void 0===this.opts.destroyed&&(this.observe.links(),this.observe.images())},isCurrent:function(e,i){return void 0===i&&(i=t(this.selection.current())),i.is(e)||i.parents(e).length>0},toolbar:function(){this.observe.buttons(),this.observe.dropdowns()},buttons:function(e,i){var r=this.selection.current(),n=this.selection.parent();!1!==e?this.button.setInactiveAll():this.button.setInactiveAll(i),!1!==e||"html"===i?this.utils.isRedactorParent(r)&&("none"!==this.core.editor().css("display")&&(this.utils.isCurrentOrParentHeader()||this.utils.isCurrentOrParent(["table","pre","blockquote","li"])?this.button.disable("horizontalrule"):this.button.enable("horizontalrule")),t.each(this.opts.activeButtonsStates,t.proxy(function(e,i){var o=t(n).closest(e,this.$editor[0]),s=t(r).closest(e,this.$editor[0]);(0===o.length||this.utils.isRedactorParent(o))&&this.utils.isRedactorParent(s)&&(0===o.length&&0===s.closest(e,this.$editor[0]).length||this.button.setActive(i))},this))):-1!==t.inArray(i,this.opts.activeButtons)&&this.button.toggleActive(i)},dropdowns:function(){var e=t("<div />").html(this.selection.html()).find("a").length,i=t(this.selection.current()),r=this.utils.isRedactorParent(i);t.each(this.opts.observe.dropdowns,t.proxy(function(t,n){var o=n.observe,s=o.element,a=n.item,l=void 0!==o.in&&o.in,c=void 0!==o.out&&o.out;i.closest(s).length>0&&r||"a"===s&&0!==e?this.observe.setDropdownProperties(a,l,c):this.observe.setDropdownProperties(a,c,l)},this))},setDropdownProperties:function(t,e,i){i&&void 0!==i.attr&&this.observe.setDropdownAttr(t,i.attr,!0),void 0!==e.attr&&this.observe.setDropdownAttr(t,e.attr),void 0!==e.title&&t.find("span").text(e.title)},setDropdownAttr:function(e,i,r){t.each(i,function(t,i){"class"===t?r?e.removeClass(i):e.addClass(i):r?e.removeAttr(t):e.attr(t,i)})},addDropdown:function(t,e,i){void 0!==i.observe&&(i.item=t,this.opts.observe.dropdowns.push(i))},images:function(){this.opts.imageEditable&&(this.core.editor().addClass("redactor-layer-img-edit"),this.core.editor().find("img").each(t.proxy(function(e,i){var r=t(i);r.closest("a",this.$editor[0]).on("click",function(t){t.preventDefault()}),this.image.setEditable(r)},this)))},links:function(){this.opts.linkTooltip&&this.core.editor().find("a").each(t.proxy(function(e,i){var r=t(i);!0!==r.data("cached")&&(r.data("cached",!0),r.on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,t.proxy(this.observe.showTooltip,this)))},this))},getTooltipPosition:function(t){return t.offset()},showTooltip:function(e){var i=t(e.target);if("IMG"!==i[0].tagName&&("A"!==i[0].tagName&&(i=i.closest("a",this.$editor[0])),"A"===i[0].tagName)){var r=i,n=this.observe.getTooltipPosition(r),o=t('<span class="redactor-link-tooltip"></span>'),s=r.attr("href");void 0===s&&(s=""),s.length>24&&(s=s.substring(0,24)+"...");var a=t('<a href="'+r.attr("href")+'" target="_blank" />').html(s).addClass("redactor-link-tooltip-action"),l=t('<a href="#" />').html(this.lang.get("edit")).on("click",t.proxy(this.link.show,this)).addClass("redactor-link-tooltip-action"),c=t('<a href="#" />').html(this.lang.get("unlink")).on("click",t.proxy(this.link.unlink,this)).addClass("redactor-link-tooltip-action");o.append(a).append(" | ").append(l).append(" | ").append(c);var d=parseInt(r.css("line-height"),10),h=Math.ceil((e.pageY-n.top)/d),u=n.top+h*d;o.css({top:u+"px",left:n.left+"px"}),t(".redactor-link-tooltip").remove(),t("body").append(o),this.core.editor().on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,t.proxy(this.observe.closeTooltip,this)),t(document).on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,t.proxy(this.observe.closeTooltip,this))}},closeAllTooltip:function(){t(".redactor-link-tooltip").remove()},closeTooltip:function(e){var i=(e=e.originalEvent||e).target,r=t(i).closest("a",this.$editor[0]);0!==r.length&&"A"===r[0].tagName&&"A"!==i.tagName||"A"===i.tagName&&this.utils.isRedactorParent(i)||t(i).hasClass("redactor-link-tooltip-action")||(this.observe.closeAllTooltip(),this.core.editor().off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,t.proxy(this.observe.closeTooltip,this)),t(document).off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,t.proxy(this.observe.closeTooltip,this)))}}},offset:function(){return{get:function(e){var i=this.offset.clone(e);if(!1===i)return 0;var r=document.createElement("div");return r.appendChild(i.cloneContents()),r.innerHTML=r.innerHTML.replace(/<img(.*?[^>])>$/gi,"i"),t.trim(t(r).text()).replace(/[\t\n\r\n]/g,"").replace(/\u200B/g,"").length},clone:function(t){var e=this.selection.get(),i=this.selection.range(e);if(null===i&&void 0===t)return!1;if(!1===(t=void 0===t?this.$editor:t))return!1;t=t[0]||t;var r=i.cloneRange();return r.selectNodeContents(t),r.setEnd(i.endContainer,i.endOffset),r},set:function(t,e){e=void 0===e?t:e,this.focus.is()||this.focus.start();for(var i,r=this.selection.get(),n=this.selection.range(r),o=0,s=document.createTreeWalker(this.$editor[0],NodeFilter.SHOW_TEXT,null,null);null!==(i=s.nextNode());)if((o+=i.nodeValue.length)>t&&(n.setStart(i,i.nodeValue.length+t-o),t=1/0),o>=e){n.setEnd(i,i.nodeValue.length+e-o);break}n.collapse(!1),this.selection.update(r,n)}}},paragraphize:function(){return{load:function(e){return!1===this.opts.paragraphize||"inline"===this.opts.type||"pre"===this.opts.type?e:""===e||"<p></p>"===e?this.opts.emptyHtml:(e+="\n",this.paragraphize.safes=[],this.paragraphize.z=0,e=(e=(e=e.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>")).replace(/<\/pre>/gi,"</pre>\n\n")).replace(/<p>\s<br><\/p>/gi,"<p></p>"),e=(e=this.paragraphize.getSafes(e)).replace("<br>","\n"),e=this.paragraphize.convert(e),e=this.paragraphize.clear(e),e=(e=this.paragraphize.restoreSafes(e)).replace(new RegExp("<br\\s?/?>\n?<("+this.opts.paragraphizeBlocks.join("|")+")(.*?[^>])>","gi"),"<p><br /></p>\n<$1$2>"),t.trim(e))},getSafes:function(e){var i=t("<div />").append(e);return i.find("blockquote p").replaceWith(function(){return t(this).append("<br />").contents()}),i.find(this.opts.paragraphizeBlocks.join(", ")).each(t.proxy(function(e,i){return this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=i.outerHTML,t(i).replaceWith("\n#####replace"+this.paragraphize.z+"#####\n\n")},this)),i.find("span.redactor-selection-marker").each(t.proxy(function(e,i){return this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=i.outerHTML,t(i).replaceWith("\n#####replace"+this.paragraphize.z+"#####\n\n")},this)),i.html()},restoreSafes:function(e){return t.each(this.paragraphize.safes,function(t,i){i=void 0!==i?i.replace(/\$/g,"&#36;"):i,e=e.replace("#####replace"+t+"#####",i)}),e},convert:function(e){e=(e=(e=(e=e.replace(/\r\n/g,"xparagraphmarkerz")).replace(/\n/g,"xparagraphmarkerz")).replace(/\r/g,"xparagraphmarkerz")).replace(/\s+/g," ");return(e=(e=(e=(e=(e=(e=(e=(e=(e=(e="<p>"+(e=(e=(e=t.trim(e)).replace(/xparagraphmarkerzxparagraphmarkerz/gi,"</p><p>")).replace(/xparagraphmarkerz/gi,"<br>"))+"</p>").replace("<p></p>","")).replace("\r\n\r\n","")).replace(/<\/p><p>/g,"</p>\r\n\r\n<p>")).replace(new RegExp("<br\\s?/?></p>","g"),"</p>")).replace(new RegExp("<p><br\\s?/?>","g"),"<p>")).replace(new RegExp("<p><br\\s?/?>","g"),"<p>")).replace(new RegExp("<br\\s?/?></p>","g"),"</p>")).replace(/<p>&nbsp;<\/p>/gi,"")).replace(/<p>\s?<br>&nbsp;<\/p>/gi,"")).replace(/<p>\s?<br>/gi,"<p>")},clear:function(t){return(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/<p>(.*?)#####replace(.*?)#####\s?<\/p>/gi,"<p>$1</p>#####replace$2#####")).replace(/(<br\s?\/?>){2,}<\/p>/gi,"</p>")).replace(new RegExp("</blockquote></p>","gi"),"</blockquote>")).replace(new RegExp("<p></blockquote>","gi"),"</blockquote>")).replace(new RegExp("<p><blockquote>","gi"),"<blockquote>")).replace(new RegExp("<blockquote></p>","gi"),"<blockquote>")).replace(new RegExp("<p><p ","gi"),"<p ")).replace(new RegExp("<p><p>","gi"),"<p>")).replace(new RegExp("</p></p>","gi"),"</p>")).replace(new RegExp("<p>\\s?</p>","gi"),"")).replace(new RegExp("\n</p>","gi"),"</p>")).replace(new RegExp("<p>\t?\t?\n?<p>","gi"),"<p>")).replace(new RegExp("<p>\t*</p>","gi"),"")}}},paste:function(){return{init:function(e){this.rtePaste=!0;var i=!("pre"!==this.opts.type&&!this.utils.isCurrentOrParent("pre"));this.detect.isDesktop()&&!this.paste.pre&&this.opts.clipboardImageUpload&&this.opts.imageUpload&&this.paste.detectClipboardUpload(e)?this.detect.isIe()&&setTimeout(t.proxy(this.paste.clipboardUpload,this),100):(this.utils.saveScroll(),this.selection.save(),this.paste.createPasteBox(i),t(window).on("scroll.redactor-freeze",t.proxy(function(){t(window).scrollTop(this.saveBodyScroll)},this)),setTimeout(t.proxy(function(){var e=this.paste.getPasteBoxCode(i);this.buffer.set(),this.selection.restore(),this.utils.restoreScroll();var r=this.clean.getCurrentType(e);e=this.clean.onPaste(e,r);var n=this.core.callback("paste",e);e=void 0===n?e:n,this.paste.insert(e,r),this.rtePaste=!1,i&&this.clean.cleanPre(),t(window).off("scroll.redactor-freeze")},this),1))},getPasteBoxCode:function(t){var e=t?this.$pasteBox.val():this.$pasteBox.html();return this.$pasteBox.remove(),e},createPasteBox:function(e){var i={position:"fixed",width:"1px",top:0,left:"-9999px"};this.$pasteBox=e?t("<textarea>").css(i):t("<div>").attr("contenteditable","true").css(i),this.paste.appendPasteBox(),this.$pasteBox.focus()},appendPasteBox:function(){if(this.detect.isIe())this.core.box().append(this.$pasteBox);else{var e=t(".modal-body:visible");e.length>0?e.append(this.$pasteBox):t("body").prepend(this.$pasteBox)}},detectClipboardUpload:function(e){var i=(e=e.originalEvent||e).clipboardData;if(this.detect.isIe()||this.detect.isFirefox())return!1;if(-1!==i.types.indexOf("public.tiff"))return e.preventDefault(),!1;if(i.items&&i.items.length){var r=i.items[0].getAsFile();if(null===r)return!1;var n=new FileReader;return n.readAsDataURL(r),n.onload=t.proxy(this.paste.insertFromClipboard,this),!0}},clipboardUpload:function(){var e=this.$editor.find("img");t.each(e,t.proxy(function(e,i){if(-1!==i.src.search(/^data\:image/i)){var r=window.FormData?new FormData:null;if(window.FormData){this.upload.direct=!0,this.upload.type="image",this.upload.url=this.opts.imageUpload,this.upload.callback=t.proxy(function(e){if(this.detect.isIe())t(i).wrap(t("<figure />"));else{var r=t(i).parent();this.utils.replaceToTag(r,"figure")}i.src=e.url,this.core.callback("imageUpload",t(i),e)},this);var n=this.utils.dataURItoBlob(i.src);r.append("clipboard",1),r.append(this.opts.imageUploadParam,n),this.progress.show(),this.upload.send(r,!1),this.code.sync(),this.rtePaste=!1}}},this))},insertFromClipboard:function(t){var e=window.FormData?new FormData:null;if(window.FormData){this.upload.direct=!0,this.upload.type="image",this.upload.url=this.opts.imageUpload,this.upload.callback=this.image.insert;var i=this.utils.dataURItoBlob(t.target.result);e.append("clipboard",1),e.append(this.opts.imageUploadParam,i),this.progress.show(),this.upload.send(e,t),this.rtePaste=!1}},insert:function(e,i){i.pre?this.insert.raw(e):i.text?this.insert.text(e):this.insert.html(e,i),this.detect.isFirefox()&&this.opts.imageUpload&&this.opts.clipboardImageUpload&&setTimeout(t.proxy(this.paste.clipboardUpload,this),100)}}},placeholder:function(){return{enable:function(){setTimeout(t.proxy(function(){return this.placeholder.isEditorEmpty()?this.placeholder.show():this.placeholder.hide()},this),5)},show:function(){this.core.editor().addClass("redactor-placeholder")},update:function(t){this.opts.placeholder=t,this.core.editor().attr("placeholder",t)},hide:function(){this.core.editor().removeClass("redactor-placeholder")},is:function(){return this.core.editor().hasClass("redactor-placeholder")},init:function(){this.placeholder.enabled()&&(this.utils.isEditorRelative()||this.utils.setEditorRelative(),this.placeholder.build(),this.placeholder.buildPosition(),this.placeholder.enable(),this.placeholder.enableEvents())},enabled:function(){return this.opts.placeholder?this.core.element().attr("placeholder",this.opts.placeholder):this.placeholder.isAttr()},enableEvents:function(){this.core.editor().on("keydown.redactor-placeholder."+this.uuid,t.proxy(this.placeholder.enable,this))},disableEvents:function(){this.core.editor().off(".redactor-placeholder."+this.uuid)},build:function(){this.core.editor().attr("placeholder",this.core.element().attr("placeholder"))},buildPosition:function(){var e=t("<style />");e.addClass("redactor-placeholder-style-tag"),e.html("#"+this.core.id()+".redactor-placeholder::after "+this.placeholder.getPosition()),t("head").append(e)},getPosition:function(){return"{ top: "+this.core.editor().css("padding-top")+"; left: "+this.core.editor().css("padding-left")+"; }"},isEditorEmpty:function(){var e=t.trim(this.core.editor().html()).replace(/[\t\n]/g,""),i=["","<p>​</p>","<p>​<br></p>",this.opts.emptyHtmlRendered];return-1!==t.inArray(e,i)},isAttr:function(){return void 0!==this.core.element().attr("placeholder")&&""!==this.core.element().attr("placeholder")},destroy:function(){this.core.editor().removeAttr("placeholder"),this.placeholder.hide(),this.placeholder.disableEvents(),t(".redactor-placeholder-style-tag").remove()}}},progress:function(){return{$box:null,$bar:null,target:document.body,show:function(){this.progress.is()?this.progress.$box.show():(this.progress.build(),this.progress.$box.redactorAnimation("fadeIn"))},hide:function(){this.progress.is()&&this.progress.$box.redactorAnimation("fadeOut",{duration:.35},t.proxy(this.progress.destroy,this))},update:function(t){this.progress.show(),this.progress.$bar.css("width",t+"%")},is:function(){return null!==this.progress.$box},build:function(){this.progress.$bar=t("<span />"),this.progress.$box=t('<div id="redactor-progress" />'),this.progress.$box.append(this.progress.$bar),t(this.progress.target).append(this.progress.$box)},destroy:function(){this.progress.is()&&this.progress.$box.remove(),this.progress.$box=null,this.progress.$bar=null}}},selection:function(){return{get:function(){return window.getSelection?window.getSelection():document.selection&&"Control"!==document.selection.type?document.selection:null},range:function(t){return void 0===t&&(t=this.selection.get()),t.getRangeAt&&t.rangeCount?t.getRangeAt(0):null},is:function(){return!this.selection.isCollapsed()},isRedactor:function(){var e=this.selection.range();if(null!==e){var i=e.startContainer.parentNode;if(t(i).hasClass("redactor-in")||0!==t(i).parents(".redactor-in").length)return!0}return!1},isCollapsed:function(){var t=this.selection.get();return null!==t&&t.isCollapsed},update:function(t,e){null!==e&&(t.removeAllRanges(),t.addRange(e))},current:function(){var t=this.selection.get();return null!==t&&t.anchorNode},parent:function(){var t=this.selection.current();return null!==t&&t.parentNode},block:function(e){for(e=e||this.selection.current();e;){if(this.utils.isBlockTag(e.tagName))return!t(e).hasClass("redactor-in")&&e;e=e.parentNode}return!1},inline:function(e){for(e=e||this.selection.current();e;){if(this.utils.isInlineTag(e.tagName))return!t(e).hasClass("redactor-in")&&e;e=e.parentNode}return!1},element:function(e){for(e||(e=this.selection.current());e;){if(1===e.nodeType)return!t(e).hasClass("redactor-in")&&e;e=e.parentNode}return!1},prev:function(){return null!==this.selection.current()&&this.selection.current().previousSibling},next:function(){return null!==this.selection.current()&&this.selection.current().nextSibling},blocks:function(e){var i=[],r=this.selection.nodes(e);t.each(r,t.proxy(function(t,e){this.utils.isBlock(e)&&i.push(e)},this));var n=this.selection.block();return 0===i.length&&!1===n?[]:0===i.length&&!1!==n?[n]:i},inlines:function(e){var i=[],r=this.selection.nodes(e);t.each(r,t.proxy(function(t,e){this.utils.isInline(e)&&i.push(e)},this));var n=this.selection.inline();return 0===i.length&&!1===n?[]:0===i.length&&!1!==n?[n]:i},nodes:function(e){var i=void 0===e?[]:t.isArray(e)?e:[e],r=this.selection.get(),n=this.selection.range(r),o=[],s=[];if(this.utils.isCollapsed())o=[this.selection.current()];else{var a=n.startContainer,l=n.endContainer;if(a===l)return[a];for(;a&&a!==l;)o.push(a=this.selection.nextNode(a));for(a=n.startContainer;a&&a!==n.commonAncestorContainer;)o.unshift(a),a=a.parentNode}return t.each(o,function(e,r){if(r){var n=1===r.nodeType&&r.tagName.toLowerCase();if(t(r).hasClass("redactor-script-tag")||t(r).hasClass("redactor-selection-marker"))return;if(n&&0!==i.length&&-1===t.inArray(n,i))return;s.push(r)}}),0===s.length?[]:s},nextNode:function(t){if(t.hasChildNodes())return t.firstChild;for(;t&&!t.nextSibling;)t=t.parentNode;return t?t.nextSibling:null},save:function(){this.marker.insert(),this.savedSel=this.core.editor().html()},restore:function(t){var e=this.marker.find(1),i=this.marker.find(2);this.detect.isFirefox()&&this.core.editor().focus(),0!==e.length&&0!==i.length?this.caret.set(e,i):0!==e.length?this.caret.start(e):this.core.editor().focus(),!1!==t&&(this.marker.remove(),this.savedSel=!1)},saveInstant:function(){var t=this.core.editor()[0],e=t.ownerDocument.defaultView.getSelection();if(e.getRangeAt&&e.rangeCount){var i=e.getRangeAt(0),r=i.cloneRange();r.selectNodeContents(t),r.setEnd(i.startContainer,i.startOffset);var n=r.toString().length;return this.saved={start:n,end:n+i.toString().length,node:i.startContainer},this.saved}},restoreInstant:function(t){if(void 0!==t||this.saved){this.saved=void 0!==t?t:this.saved;var e=this.core.editor().find(this.saved.node);if(0===e.length||0!==e.text().trim().replace(/\u200B/g,"").length){var i=this.core.editor()[0],r=i.ownerDocument,n=r.defaultView,o=0,s=r.createRange();s.setStart(i,0),s.collapse(!0);for(var a,l=[i],c=!1,d=!1;!d&&(a=l.pop());)if(3==a.nodeType){var h=o+a.length;!c&&this.saved.start>=o&&this.saved.start<=h&&(s.setStart(a,this.saved.start-o),c=!0),c&&this.saved.end>=o&&this.saved.end<=h&&(s.setEnd(a,this.saved.end-o),d=!0),o=h}else for(var u=a.childNodes.length;u--;)l.push(a.childNodes[u]);var p=n.getSelection();p.removeAllRanges(),p.addRange(s)}else try{(s=document.createRange()).setStart(e[0],0),(p=window.getSelection()).removeAllRanges(),p.addRange(s)}catch(t){}}},node:function(e){t(e).prepend(this.marker.get(1)),t(e).append(this.marker.get(2)),this.selection.restore()},all:function(){this.core.editor().focus();var t=this.selection.get(),e=this.selection.range(t);e.selectNodeContents(this.core.editor()[0]),this.selection.update(t,e)},remove:function(){this.selection.get().removeAllRanges()},replace:function(t){this.insert.html(t)},text:function(){return this.selection.get().toString()},html:function(){var t="",e=this.selection.get();if(e.rangeCount){for(var i=document.createElement("div"),r=e.rangeCount,n=0;n<r;++n)i.appendChild(e.getRangeAt(n).cloneContents());t=this.clean.onGet(i.innerHTML)}return t},extractEndOfNode:function(t){var e=this.selection.get(),i=this.selection.range(e),r=i.cloneRange();return r.selectNodeContents(t),r.setStart(i.endContainer,i.endOffset),r.extractContents()},removeMarkers:function(){this.marker.remove()},marker:function(t){return this.marker.get(t)},markerHtml:function(t){return this.marker.html(t)}}},shortcuts:function(){return{hotkeysSpecialKeys:{8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},hotkeysShiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"},init:function(e,i){if(!1===this.opts.shortcuts)return!e.ctrlKey&&!e.metaKey||66!==i&&73!==i||e.preventDefault(),!1;t.each(this.opts.shortcuts,t.proxy(function(t,i){this.shortcuts.build(e,t,i)},this))},build:function(e,i,r){for(var n=t.proxy(function(){this.shortcuts.buildHandler(r)},this),o=i.split(","),s=o.length,a=0;a<s;a++)"string"==typeof o[a]&&this.shortcuts.handler(e,t.trim(o[a]),n)},buildHandler:function(t){var e;"-1"!==t.func.search(/\./)?void 0!==this[(e=t.func.split("."))[0]]&&this[e[0]][e[1]].apply(this,t.params):this[t.func].apply(this,t.params)},handler:function(e,i,r){i=i.toLowerCase().split(" ");var n=this.shortcuts.hotkeysSpecialKeys[e.keyCode],o=String.fromCharCode(e.which).toLowerCase(),s="",a={};t.each(["alt","ctrl","meta","shift"],function(t,i){e[i+"Key"]&&n!==i&&(s+=i+"+")}),n&&(a[s+n]=!0),o&&(a[s+o]=!0,a[s+this.shortcuts.hotkeysShiftNums[o]]=!0,"shift+"===s&&(a[this.shortcuts.hotkeysShiftNums[o]]=!0));for(var l=i.length,c=0;c<l;c++)if(a[i[c]])return e.preventDefault(),r.apply(this,arguments)}}},storage:function(){return{data:[],add:function(t){t.status=!0,t.url=decodeURI(t.url),this.storage.data[t.url]=t},status:function(t,e){this.storage.data[decodeURI(t)].status=e},observe:function(){var e=this;this.core.editor().find("[data-image]").each(function(i,r){e.storage.add({type:"image",node:r,url:r.src,id:t(r).attr("data-image")})}),this.core.editor().find("[data-file]").each(function(i,r){e.storage.add({type:"file",node:r,url:r.href,id:t(r).attr("data-file")})}),this.core.editor().find("[data-s3]").each(function(i,r){var n="IMG"===r.tagName?r.src:r.href;e.storage.add({type:"s3",node:r,url:n,id:t(r).attr("data-s3")})})},changes:function(){for(var t in this.storage.data){var e=this.storage.data[t],i="IMG"===e.node.tagName?"src":"href";0===this.core.editor().find("[data-"+e.type+"]["+i+'="'+e.url+'"]').length?this.storage.status(e.url,!1):this.storage.status(e.url,!0)}return this.storage.data}}},toolbar:function(){return{build:function(){this.button.hideButtons(),this.button.hideButtonsOnMobile(),this.$toolbarBox=t("<div />").addClass("redactor-toolbar-box"),this.$toolbar=this.toolbar.createContainer(),this.$toolbarBox.append(this.$toolbar),this.toolbar.append(),this.button.$toolbar=this.$toolbar,this.button.setFormatting(),this.button.load(this.$toolbar),this.toolbar.setOverflow(),this.toolbar.setFixed()},createContainer:function(){return t("<ul>").addClass("redactor-toolbar").attr({id:"redactor-toolbar-"+this.uuid,role:"toolbar"})},append:function(){this.opts.toolbarExternal?(this.$toolbar.addClass("redactor-toolbar-external"),t(this.opts.toolbarExternal).html(this.$toolbarBox)):"textarea"===this.opts.type?this.$box.prepend(this.$toolbarBox):this.$element.before(this.$toolbarBox)},setOverflow:function(){this.opts.toolbarOverflow&&this.$toolbar.addClass("redactor-toolbar-overflow")},setFixed:function(){if(this.opts.toolbarFixed&&!this.opts.toolbarExternal){if(this.opts.toolbarFixedTarget!==document){var e=t(this.opts.toolbarFixedTarget);this.toolbar.toolbarOffsetTop=0===e.length?0:this.core.box().offset().top-e.offset().top}var i=0!==this.core.box().closest(".modal-body").length?1e3:0;setTimeout(t.proxy(function(){var e=this;this.toolbar.observeScroll(!1),this.detect.isDesktop()?t(this.opts.toolbarFixedTarget).on("scroll.redactor."+this.uuid,function(){e.core.editor().height()<100||e.placeholder.isEditorEmpty()||e.toolbar.observeScroll()}):t(this.opts.toolbarFixedTarget).on("scroll.redactor."+this.uuid,function(){e.core.editor().height()<100||e.placeholder.isEditorEmpty()||(e.core.toolbar().hide(),clearTimeout(t.data(this,"scrollCheck")),t.data(this,"scrollCheck",setTimeout(function(){e.core.toolbar().show(),e.toolbar.observeScroll()},250)))})},this),i)}},setUnfixed:function(){this.toolbar.observeScrollDisable()},getBoxTop:function(){return this.opts.toolbarFixedTarget===document?this.core.box().offset().top:this.toolbar.toolbarOffsetTop},observeScroll:function(e){var i=0;!1!==e&&(i=this.opts.toolbarFixedTarget===document?20:0);var r=t(this.opts.toolbarFixedTarget).scrollTop(),n=this.toolbar.getBoxTop();r!==n&&(r+this.opts.toolbarFixedTopOffset+i>n?this.toolbar.observeScrollEnable(r,n):this.toolbar.observeScrollDisable())},observeScrollResize:function(){this.$toolbar.css({width:this.core.box().innerWidth(),left:this.core.box().offset().left})},observeScrollEnable:function(e,i){if(void 0===this.fullscreen||!1!==this.fullscreen.isOpened){var r=i+this.core.box().outerHeight()-32,n=this.core.box().innerWidth(),o=this.detect.isDesktop()?"fixed":"absolute",s=this.detect.isDesktop()?this.opts.toolbarFixedTopOffset:t(this.opts.toolbarFixedTarget).scrollTop()-i+this.opts.toolbarFixedTopOffset,a=this.detect.isDesktop()?this.core.box().offset().left:0;this.opts.toolbarFixedTarget!==document&&(o="absolute",s=this.opts.toolbarFixedTopOffset+t(this.opts.toolbarFixedTarget).scrollTop()-i,a=0),this.$toolbar.addClass("toolbar-fixed-box"),this.$toolbar.css({position:o,width:n,top:s,left:a}),e>r&&t(".redactor-dropdown-"+this.uuid+":visible").hide(),this.toolbar.setDropdownsFixed(),this.$toolbar.css("visibility",e<r?"visible":"hidden"),t(window).on("resize.redactor-toolbar."+this.uuid,t.proxy(this.toolbar.observeScrollResize,this))}else this.toolbar.observeScrollDisable()},observeScrollDisable:function(){this.$toolbar.css({position:"relative",width:"auto",top:0,left:0,visibility:"visible"}),this.toolbar.unsetDropdownsFixed(),this.$toolbar.removeClass("toolbar-fixed-box"),t(window).off("resize.redactor-toolbar."+this.uuid)},setDropdownsFixed:function(){var t=this.opts.toolbarFixedTarget===document&&this.detect.isDesktop()?"fixed":"absolute";this.toolbar.setDropdownPosition(t)},unsetDropdownsFixed:function(){this.toolbar.setDropdownPosition("absolute")},setDropdownPosition:function(e){var i=this;t(".redactor-dropdown-"+this.uuid).each(function(){var r=t(this),n=i.button.get(r.attr("rel")),o="fixed"===e?i.opts.toolbarFixedTopOffset:n.offset().top;r.css({position:e,top:n.innerHeight()+o+"px"})})}}},upload:function(){return{init:function(e,i,r){this.upload.direct=!1,this.upload.callback=r,this.upload.url=i,this.upload.$el=t(e),this.upload.$droparea=t('<div id="redactor-droparea" />'),this.upload.$placeholdler=t('<div id="redactor-droparea-placeholder" />').text(this.lang.get("upload-label")),this.upload.$input=t('<input type="file" name="file" multiple />'),this.upload.$placeholdler.append(this.upload.$input),this.upload.$droparea.append(this.upload.$placeholdler),this.upload.$el.append(this.upload.$droparea),this.upload.$droparea.off("redactor.upload"),this.upload.$input.off("redactor.upload"),this.upload.$droparea.on("dragover.redactor.upload",t.proxy(this.upload.onDrag,this)),this.upload.$droparea.on("dragleave.redactor.upload",t.proxy(this.upload.onDragLeave,this)),this.upload.$input.on("change.redactor.upload",t.proxy(function(t){t=t.originalEvent||t;for(var e=this.upload.$input[0].files.length,i=0;i<e;i++){var r=e-1-i;this.upload.traverseFile(this.upload.$input[0].files[r],t)}},this)),this.upload.$droparea.on("drop.redactor.upload",t.proxy(function(t){t.preventDefault(),this.upload.$droparea.removeClass("drag-hover").addClass("drag-drop"),this.upload.onDrop(t)},this))},directUpload:function(t,e){this.upload.direct=!0,this.upload.traverseFile(t,e)},onDrop:function(t){var e=(t=t.originalEvent||t).dataTransfer.files;if(this.opts.multipleImageUpload)for(var i=e.length,r=0;r<i;r++)this.upload.traverseFile(e[r],t);else this.upload.traverseFile(e[0],t)},traverseFile:function(t,e){if(this.opts.s3)return this.upload.setConfig(t),void this.uploads3.send(t,e);var i=window.FormData?new FormData:null;if(window.FormData){this.upload.setConfig(t);var r="image"===this.upload.type?this.opts.imageUploadParam:this.opts.fileUploadParam;i.append(r,t)}!1!==this.core.callback("uploadStart",e,i)&&(this.progress.show(),this.upload.send(i,e))},setConfig:function(t){this.upload.getType(t),this.upload.direct&&(this.upload.url="image"===this.upload.type?this.opts.imageUpload:this.opts.fileUpload,this.upload.callback="image"===this.upload.type?this.image.insert:this.file.insert)},getType:function(t){this.upload.type=-1===this.opts.imageTypes.indexOf(t.type)?"file":"image",null===this.opts.imageUpload&&null!==this.opts.fileUpload&&(this.upload.type="file")},getHiddenFields:function(e,i){return!1===e||"object"!=typeof e?i:(t.each(e,t.proxy(function(e,r){null!==r&&0===r.toString().indexOf("#")&&(r=t(r).val()),i.append(e,r)},this)),i)},send:function(e,i){"image"===this.upload.type?(e=this.utils.appendFields(this.opts.imageUploadFields,e),e=this.utils.appendForms(this.opts.imageUploadForms,e),e=this.upload.getHiddenFields(this.upload.imageFields,e)):(e=this.utils.appendFields(this.opts.fileUploadFields,e),e=this.utils.appendForms(this.opts.fileUploadForms,e),e=this.upload.getHiddenFields(this.upload.fileFields,e));var r=new XMLHttpRequest;r.open("POST",this.upload.url),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.onreadystatechange=t.proxy(function(){if(4===r.readyState){var t,e=r.responseText;e=(e=e.replace(/^\[/,"")).replace(/\]$/,"");try{t="string"==typeof e?JSON.parse(e):e}catch(e){t={error:!0}}this.progress.hide(),this.upload.direct||this.upload.$droparea.removeClass("drag-drop"),this.upload.callback(t,this.upload.direct,i)}},this),!1!==this.core.callback("uploadBeforeSend",r)&&r.send(e)},onDrag:function(t){t.preventDefault(),this.upload.$droparea.addClass("drag-hover")},onDragLeave:function(t){t.preventDefault(),this.upload.$droparea.removeClass("drag-hover")},clearImageFields:function(){this.upload.imageFields={}},addImageFields:function(t,e){this.upload.imageFields[t]=e},removeImageFields:function(t){delete this.upload.imageFields[t]},clearFileFields:function(){this.upload.fileFields={}},addFileFields:function(t,e){this.upload.fileFields[t]=e},removeFileFields:function(t){delete this.upload.fileFields[t]}}},uploads3:function(){return{send:function(e,i){this.uploads3.executeOnSignedUrl(e,t.proxy(function(t){this.uploads3.sendToS3(e,t,i)},this))},executeOnSignedUrl:function(t,e){var i=new XMLHttpRequest,r=-1===this.opts.s3.search(/\?/)?"?":"&";i.open("GET",this.opts.s3+r+"name="+t.name+"&type="+t.type,!0),i.overrideMimeType&&i.overrideMimeType("text/plain; charset=x-user-defined");var n=this;i.onreadystatechange=function(t){4===this.readyState&&200===this.status&&(n.progress.show(),e(decodeURIComponent(this.responseText)))},i.send()},createCORSRequest:function(t,e){var i=new XMLHttpRequest;return"withCredentials"in i?i.open(t,e,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest).open(t,e):i=null,i},sendToS3:function(e,i,r){var n=this.uploads3.createCORSRequest("PUT",i);n&&(n.onload=t.proxy(function(){var t;if(this.progress.hide(),200!==n.status)return t={error:!0},void this.upload.callback(t,this.upload.direct,n);var e=i.split("?");if(!e[0])return!1;if(this.upload.direct||this.upload.$droparea.removeClass("drag-drop"),t={url:e[0],id:e[0],s3:!0},"file"===this.upload.type){var o=e[0].split("/");t.name=o[o.length-1]}this.upload.callback(t,this.upload.direct,r)},this),n.onerror=function(){},n.upload.onprogress=function(t){},n.setRequestHeader("Content-Type",e.type),n.setRequestHeader("x-amz-acl","public-read"),n.send(e))}}},utils:function(){return{isEmpty:function(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=void 0===e?this.core.editor().html():e).replace(/[\u200B-\u200D\uFEFF]/g,"")).replace(/&nbsp;/gi,"")).replace(/<\/?br\s?\/?>/g,"")).replace(/\s/g,"")).replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,"")).replace(/<iframe(.*?[^>])>$/i,"iframe")).replace(/<source(.*?[^>])>$/i,"source")).replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")).replace(/<[^\/>][^>]*><\/[^>]+>/gi,""),""===t.trim(e)},isElement:function(t){try{return t instanceof HTMLElement}catch(e){return"object"==typeof t&&1===t.nodeType&&"object"==typeof t.style&&"object"==typeof t.ownerDocument}},strpos:function(t,e,i){var r=t.indexOf(e,i);return r>=0&&r},dataURItoBlob:function(t){var e;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var i=t.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(e.length),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return new Blob([r],{type:i})},getOuterHtml:function(e){return t("<div>").append(t(e).eq(0).clone()).html()},cloneAttributes:function(e,i){e=e[0]||e,i=t(i);for(var r=e.attributes,n=r.length;n--;){var o=r[n];i.attr(o.name,o.value)}return i},breakBlockTag:function(){var e=this.selection.block();if(!e)return!1;var i=this.utils.isEmpty(e.innerHTML),r=e.tagName.toLowerCase();if("pre"===r||"li"===r||"td"===r||"th"===r)return!1;if(!i&&this.utils.isStartOfElement(e))return{$block:t(e),$next:t(e).next(),type:"start"};if(!i&&this.utils.isEndOfElement(e))return{$block:t(e),$next:t(e).next(),type:"end"};var n=this.selection.extractEndOfNode(e),o=t("<"+r+" />").append(n);return o=this.utils.cloneAttributes(e,o),t(e).after(o),{$block:t(e),$next:o,type:"break"}},inBlocks:function(e){e=t.isArray(e)?e:[e];for(var i=this.selection.blocks(),r=i.length,n=!1,o=0;o<r;o++)if(!1!==i[o]){var s=i[o].tagName.toLowerCase();-1!==t.inArray(s,e)&&(n=!0)}return n},inInlines:function(e){e=t.isArray(e)?e:[e];for(var i=this.selection.inlines(),r=i.length,n=!1,o=0;o<r;o++){var s=i[o].tagName.toLowerCase();-1!==t.inArray(s,e)&&(n=!0)}return n},isTag:function(e,i){var r=t(e).closest(i,this.core.editor()[0]);return 1===r.length&&r[0]},isBlock:function(t){return null!==t&&(t=t[0]||t)&&this.utils.isBlockTag(t.tagName)},isBlockTag:function(t){return void 0!==t&&this.reIsBlock.test(t)},isInline:function(t){return(t=t[0]||t)&&this.utils.isInlineTag(t.tagName)},isInlineTag:function(t){return void 0!==t&&this.reIsInline.test(t)},isRedactorParent:function(e){return!!e&&0!==t(e).parents(".redactor-in").length&&!t(e).hasClass("redactor-in")&&e},isCurrentOrParentHeader:function(){return this.utils.isCurrentOrParent(["H1","H2","H3","H4","H5","H6"])},isCurrentOrParent:function(e){var i=this.selection.parent(),r=this.selection.current();if(t.isArray(e)){var n=0;return t.each(e,t.proxy(function(t,e){this.utils.isCurrentOrParentOne(r,i,e)&&n++},this)),0!==n}return this.utils.isCurrentOrParentOne(r,i,e)},isCurrentOrParentOne:function(t,e,i){return i=i.toUpperCase(),e&&e.tagName===i?e:!(!t||t.tagName!==i)&&t},isEditorRelative:function(){var e=this.core.editor().css("position");return-1!==t.inArray(["absolute","fixed","relative"],e)},setEditorRelative:function(){this.core.editor().addClass("redactor-relative")},getScrollTarget:function(){var e=t(this.opts.scrollTarget);return 0!==e.length?e:t(document)},freezeScroll:function(){this.freezeScrollTop=this.utils.getScrollTarget().scrollTop(),this.utils.getScrollTarget().scrollTop(this.freezeScrollTop)},unfreezeScroll:function(){void 0!==this.freezeScrollTop&&this.utils.getScrollTarget().scrollTop(this.freezeScrollTop)},saveScroll:function(){this.tmpScrollTop=this.utils.getScrollTarget().scrollTop()},restoreScroll:function(){void 0!==this.tmpScrollTop&&this.utils.getScrollTarget().scrollTop(this.tmpScrollTop)},isStartOfElement:function(t){return!(void 0===t&&!(t=this.selection.block()))&&0===this.offset.get(t)},isEndOfElement:function(e){if(void 0===e&&!(e=this.selection.block()))return!1;var i=t.trim(t(e).text()).replace(/[\t\n\r\n]/g,"").replace(/\u200B/g,"");return this.offset.get(e)===i.length},removeEmptyAttr:function(e,i){var r=t(e);return void 0===r.attr(i)||""===r.attr(i)&&(r.removeAttr(i),!0)},replaceToTag:function(e,i){var r;return t(e).replaceWith(function(){r=t("<"+i+" />").append(t(this).contents());for(var e=0;e<this.attributes.length;e++)r.attr(this.attributes[e].name,this.attributes[e].value);return r}),r},isSelectAll:function(){return this.selectAll},enableSelectAll:function(){this.selectAll=!0},disableSelectAll:function(){this.selectAll=!1},disableBodyScroll:function(){var e=t("html"),i=window.innerWidth;if(!i){var r=document.documentElement.getBoundingClientRect();i=r.right-Math.abs(r.left)}var n=document.body.clientWidth<i,o=this.utils.measureScrollbar();e.css("overflow","hidden"),n&&e.css("padding-right",o)},measureScrollbar:function(){var e=t("body"),i=document.createElement("div");i.className="redactor-scrollbar-measure",e.append(i);var r=i.offsetWidth-i.clientWidth;return e[0].removeChild(i),r},enableBodyScroll:function(){t("html").css({overflow:"","padding-right":""}),t("body").remove("redactor-scrollbar-measure")},appendFields:function(e,i){if(!e)return i;if("object"==typeof e)return t.each(e,function(e,r){null!==r&&0===r.toString().indexOf("#")&&(r=t(r).val()),i.append(e,r)}),i;var r=t(e);return 0===r.length?i:(r.each(function(){i.append(t(this).attr("name"),t(this).val())}),i)},appendForms:function(e,i){if(!e)return i;var r=t(e);if(0===r.length)return i;var n=r.serializeArray();return t.each(n,function(t,e){i.append(e.name,e.value)}),i},isRgb:function(t){return 0===t.search(/^rgb/i)},rgb2hex:function(t){return(t=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&4===t.length?"#"+("0"+parseInt(t[1],10).toString(16)).slice(-2)+("0"+parseInt(t[2],10).toString(16)).slice(-2)+("0"+parseInt(t[3],10).toString(16)).slice(-2):""},isCollapsed:function(){return this.selection.isCollapsed()},isMobile:function(){return this.detect.isMobile()},isDesktop:function(){return this.detect.isDesktop()},isPad:function(){return this.detect.isIpad()}}},browser:function(){return{webkit:function(){return this.detect.isWebkit()},ff:function(){return this.detect.isFirefox()},ie:function(){return this.detect.isIe()}}}},t(window).on("load.tools.redactor",function(){t('[data-tools="redactor"]').redactor()}),e.prototype.init.prototype=e.prototype}(jQuery),function(t){function e(e,i,r,n){var o={duration:.5,iterate:1,delay:0,prefix:"redactor-",timing:"linear"};this.animation=i,this.slide="slideDown"===this.animation||"slideUp"===this.animation,this.$element=t(e),this.prefixes=["","-moz-","-o-animation-","-webkit-"],this.queue=[],"function"==typeof r?(n=r,this.opts=o):this.opts=t.extend(o,r),this.slide&&this.$element.height(this.$element.height()),this.init(n)}t.fn.redactorAnimation=function(t,i,r){return this.each(function(){new e(this,t,i,r)})},e.prototype={init:function(t){this.queue.push(this.animation),this.clean(),"show"===this.animation?(this.opts.timing="linear",this.$element.removeClass("hide").show(),"function"==typeof t&&t(this)):"hide"===this.animation?(this.opts.timing="linear",this.$element.hide(),"function"==typeof t&&t(this)):this.animate(t)},animate:function(e){this.$element.addClass("redactor-animated").css("display","").removeClass("hide"),this.$element.addClass(this.opts.prefix+this.queue[0]),this.set(this.opts.duration+"s",this.opts.delay+"s",this.opts.iterate,this.opts.timing);var i=this.queue.length>1?null:e;this.complete("AnimationEnd",t.proxy(function(){this.$element.hasClass(this.opts.prefix+this.queue[0])&&(this.clean(),this.queue.shift(),this.queue.length&&this.animate(e))},this),i)},set:function(t,e,i,r){for(var n=this.prefixes.length;n--;)this.$element.css(this.prefixes[n]+"animation-duration",t),this.$element.css(this.prefixes[n]+"animation-delay",e),this.$element.css(this.prefixes[n]+"animation-iteration-count",i),this.$element.css(this.prefixes[n]+"animation-timing-function",r)},clean:function(){this.$element.removeClass("redactor-animated"),this.$element.removeClass(this.opts.prefix+this.queue[0]),this.set("","","","")},complete:function(e,i,r){this.$element.one(e.toLowerCase()+" webkit"+e+" o"+e+" MS"+e,t.proxy(function(){"function"==typeof i&&i(),"function"==typeof r&&r(this);-1!==t.inArray(this.animation,["fadeOut","slideUp","zoomOut","slideOutUp","slideOutRight","slideOutLeft"])&&this.$element.css("display","none"),this.slide&&this.$element.css("height","")},this))}}}(jQuery),function(t){t.Redactor.prototype.table=function(){return{langs:{en:{table:"Table","insert-table":"Insert table","insert-row-above":"Insert row above","insert-row-below":"Insert row below","insert-column-left":"Insert column left","insert-column-right":"Insert column right","add-head":"Add head","delete-head":"Delete head","delete-column":"Delete column","delete-row":"Delete row","delete-table":"Delete table"}},init:function(){var t={};t.insert_table={title:this.lang.get("insert-table"),func:this.table.insert,observe:{element:"table",in:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.insert_row_above={title:this.lang.get("insert-row-above"),func:this.table.addRowAbove,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.insert_row_below={title:this.lang.get("insert-row-below"),func:this.table.addRowBelow,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.insert_column_left={title:this.lang.get("insert-column-left"),func:this.table.addColumnLeft,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.insert_column_right={title:this.lang.get("insert-column-right"),func:this.table.addColumnRight,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.add_head={title:this.lang.get("add-head"),func:this.table.addHead,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.delete_head={title:this.lang.get("delete-head"),func:this.table.deleteHead,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.delete_column={title:this.lang.get("delete-column"),func:this.table.deleteColumn,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.delete_row={title:this.lang.get("delete-row"),func:this.table.deleteRow,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.delete_table={title:this.lang.get("delete-table"),func:this.table.deleteTable,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}};var e=this.button.addBefore("link","table",this.lang.get("table"));this.button.addDropdown(e,t)},insert:function(){if(!this.table.getTable()){this.placeholder.hide();for(var e=t("<div>"),i=t("<table />"),r=0;r<2;r++){for(var n=t("<tr>"),o=0;o<3;o++){var s=t("<td>"+this.opts.invisibleSpace+"</td>");0===r&&0===o&&s.append(this.marker.get()),t(n).append(s)}i.append(n)}e.append(i);var a=e.html();this.buffer.set();var l=this.selection.current();0!==t(l).closest("li").length?t(l).closest("ul, ol").first().after(a):(this.air.collapsed(),this.insert.html(a)),this.selection.restore(),this.core.callback("insertedTable",i)}},getTable:function(){var e=t(this.selection.current()).closest("table");return!!this.utils.isRedactorParent(e)&&(0!==e.size()&&e)},restoreAfterDelete:function(t){this.selection.restore(),t.find("span.redactor-selection-marker").remove()},deleteTable:function(){var t=this.table.getTable();if(t){this.buffer.set();var e=t.next();this.opts.linebreaks||0===e.length?this.caret.after(t):this.caret.start(e),t.remove()}},deleteRow:function(){var e=this.table.getTable();if(e){var i=t(this.selection.current());this.buffer.set();var r=i.closest("tr"),n=r.prev().length?r.prev():r.next();if(n.length){var o=n.children("td, th").first();o.length&&o.prepend(this.marker.get())}r.remove(),this.table.restoreAfterDelete(e)}},deleteColumn:function(){var e=this.table.getTable();if(e){this.buffer.set();var i=t(this.selection.current()).closest("td, th")[0].cellIndex;e.find("tr").each(t.proxy(function(e,r){var n=t(r),o=i-1<0?i+1:i-1;0===e&&n.find("td, th").eq(o).prepend(this.marker.get()),n.find("td, th").eq(i).remove()},this)),this.table.restoreAfterDelete(e)}},addHead:function(){var e=this.table.getTable();if(e)if(this.buffer.set(),0===e.find("thead").size()){var i=e.find("tr").first().clone();i.find("td").replaceWith(t.proxy(function(){return t("<th>").html(this.opts.invisibleSpace)},this)),$thead=t("<thead></thead>").append(i),e.prepend($thead)}else this.table.deleteHead()},deleteHead:function(){var t=this.table.getTable();if(t){var e=t.find("thead");0!==e.size()&&(this.buffer.set(),e.remove())}},addRowAbove:function(){this.table.addRow("before")},addRowBelow:function(){this.table.addRow("after")},addColumnLeft:function(){this.table.addColumn("before")},addColumnRight:function(){this.table.addColumn("after")},addRow:function(e){if(this.table.getTable()){this.buffer.set();var i=t(this.selection.current()).closest("tr"),r=i.clone();r.find("th").replaceWith(function(){var e=t("<td>");return e[0].attributes=this.attributes,e.append(t(this).contents())}),r.find("td").html(this.opts.invisibleSpace),"after"===e?i.after(r):i.before(r)}},addColumn:function(e){var i=this.table.getTable();if(i){var r=0,n=t(this.selection.current());this.buffer.set();var o=n.closest("tr"),s=n.closest("td, th");o.find("td, th").each(t.proxy(function(e,i){t(i)[0]===s[0]&&(r=e)},this)),i.find("tr").each(t.proxy(function(i,n){var o=t(n).find("td, th").eq(r),s=o.clone();s.html(this.opts.invisibleSpace),"after"===e?o.after(s):o.before(s)},this))}}}}}(jQuery),function(t){t.Redactor&&(t.Redactor.prototype.codemirror=function(){return{init:function(){var e=this.button.addFirst("html",'<span class="ews-icon-code"></span>');this.button.addCallback(e,this.codemirror.toggle),this.codemirror.$textarea=t("<textarea />"),this.codemirror.$textarea.hide(),"textarea"===this.opts.type?this.core.box().append(this.codemirror.$textarea):this.core.box().after(this.codemirror.$textarea),this.core.element().on("destroy.callback.redactor",t.proxy(function(){this.codemirror.$textarea.remove()},this));var i=void 0!==this.opts.codemirror?this.opts.codemirror:{lineNumbers:!0};this.codemirror.editor=CodeMirror.fromTextArea(this.codemirror.$textarea[0],i),this.codemirror.$textarea.next(".CodeMirror").hide()},toggle:function(){return this.codemirror.$textarea.hasClass("open")?this.codemirror.hide():this.codemirror.show()},setCaretOnShow:function(){this.codemirror.offset=this.offset.get();t(window).scrollTop(),this.core.editor().innerWidth(),this.core.editor().innerHeight();this.codemirror.start=0,this.codemirror.end=0;var e=t("<div/>").append(t.parseHTML(this.core.editor().html(),document,!0)),i=e.find(".redactor-selection-marker");if(i.length>0){var r=e.html().replace(/&amp;/g,"&");1===i.length?(this.codemirror.start=this.utils.strpos(r,e.find("#selection-marker-1").prop("outerHTML")),this.codemirror.end=this.codemirror.start):2===i.length&&(this.codemirror.start=this.utils.strpos(r,e.find("#selection-marker-1").prop("outerHTML")),this.codemirror.end=this.utils.strpos(r,e.find("#selection-marker-2").prop("outerHTML"))-e.find("#selection-marker-1").prop("outerHTML").toString().length)}},setCaretOnHide:function(){this.codemirror.start=0,this.codemirror.end=0;var t=this,e="";if(this.codemirror.$textarea.next(".CodeMirror").each(function(i,r){t.codemirror.selection=r.CodeMirror.listSelections(),t.codemirror.start=r.CodeMirror.indexFromPos(t.codemirror.selection[0].anchor),t.codemirror.end=r.CodeMirror.indexFromPos(t.codemirror.selection[0].head),e=r.CodeMirror.getValue()}),this.codemirror.start>this.codemirror.end&&this.codemirror.end>0){var i=this.codemirror.end,r=this.codemirror.start;this.codemirror.start=i,this.codemirror.end=r}if(this.codemirror.start=this.codemirror.enlargeOffset(e,this.codemirror.start),this.codemirror.end=this.codemirror.enlargeOffset(e,this.codemirror.end),e=e.substr(0,this.codemirror.start)+this.marker.html(1)+e.substr(this.codemirror.start),this.codemirror.end>this.codemirror.start){var n=this.marker.html(1).toString().length;e=e.substr(0,this.codemirror.end+n)+this.marker.html(2)+e.substr(this.codemirror.end+n)}return e},hide:function(){var t;this.codemirror.$textarea.removeClass("open").next(".CodeMirror").hide(),this.codemirror.$textarea.next(".CodeMirror").off(".redactor-codemirror"),t=this.codemirror.setCaretOnHide(t),t=this.paragraphize.load(t),this.code.start(t),this.button.enableAll(),this.core.editor().show().focus(),this.selection.restore(),this.code.sync()},show:function(){this.selection.save(),this.codemirror.setCaretOnShow();var e=this.core.editor().innerHeight(),i=this.code.get();i=(i=i.replace(/\n\n\n/g,"\n")).replace(/\n\n/g,"\n"),this.core.editor().hide(),this.button.disableAll("html"),this.marker.remove(),this.codemirror.$textarea.val(i).height(e).addClass("open"),this.codemirror.$textarea.next(".CodeMirror").on("keyup.redactor-codemirror",t.proxy(function(){"textarea"===this.opts.type&&this.codemirror.$textarea.next(".CodeMirror").each(t.proxy(function(t,e){this.core.textarea().val(e.CodeMirror.getValue())},this))},this));var r=this;this.codemirror.$textarea.next(".CodeMirror").each(function(n,o){t(o).show(),o.CodeMirror.setValue(i),o.CodeMirror.setSize("100%",e),o.CodeMirror.refresh(),r.codemirror.start===r.codemirror.end?o.CodeMirror.setCursor(o.CodeMirror.posFromIndex(r.codemirror.start).line,o.CodeMirror.posFromIndex(r.codemirror.end).ch):o.CodeMirror.setSelection({line:o.CodeMirror.posFromIndex(r.codemirror.start).line,ch:o.CodeMirror.posFromIndex(r.codemirror.start).ch},{line:o.CodeMirror.posFromIndex(r.codemirror.end).line,ch:o.CodeMirror.posFromIndex(r.codemirror.end).ch}),o.CodeMirror.focus()})},enlargeOffset:function(t,e){var i=t.length,r=0;if(">"===t[e])r++;else for(var n=e;n<=i&&(r++,">"!==t[n]);n++)if("<"===t[n]||n===i){r=0;break}return e+r}}})}(jQuery),EWS.HtmlEdit=function(t,e,i){return i?$(t).redactor({plugins:["codemirror","table","reports"],formatting:["p","blockquote","h1","h2","h3"],focus:!1,minHeight:e,imageUpload:"Controls/FileImport.aspx?Request=UploadRedactor&Directory=Images",imageResizable:!0,imagePosition:!0,codemirror:{lineNumbers:!0,mode:"xml",indentUnit:4}}):$(t).redactor({focus:!1,buttons:["bold","italic","lists"],minHeight:e,maxHeight:e})},function(t){t.Redactor&&(t.Redactor.prototype.reports=function(){return{init(){const t=this.button.add("report","<span class=ews-icon-report></span>");this.button.addCallback(t,this.reports.dialog)},dialog(){const t=this;t.selection.save(),EWS.SavedReport.Select((e,i,r)=>{t.focus.start(),t.selection.restore(),0===Distributor.indexOf("DashMaster")?t.insert.html(`<a href="javascript:EWS.SavedReport.Run(${i}, true);">${r}</a>`):t.insert.html(`<a href="javascript:EWS.SavedReport.Run(${i});">${r}</a>`)})}}})}(jQuery);
//# sourceMappingURL=HtmlEditAll.min.js.map
